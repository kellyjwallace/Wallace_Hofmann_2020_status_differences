---
title: "hofmann_status_differences_summer_2020"
author: "Kelly Wallace"
date: "August 21, 2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#PACKAGES
```{r, echo = FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(plyr)
library(stringr)
library(rmarkdown)
library(knitr)
library(utils)
library(EnvStats)
library(gridExtra)
library(factoextra)
library(GGally)
library(reshape2)
library(ggdendro)
library(pvclust)
library(RColorBrewer)
library(viridis)
library(glmmTMB)
library(gplots)
library(effsize)
library(ISLR)
library(dplyr)
library(readr)
library(tidyr)
library(ggfortify)
library(car)
library(broom)
library(jtools)
library(kableExtra)
library(AICcmodavg)
library(MESS)
library(glue)
library(glmulti)
library(Hmisc)
library(pheatmap)
library(corrr)
library(equalCovs)
library(lavaan)
library(correlation)
#install link:https://github.com/kellyjwallace/cowlogdata
#install_github("kellyjwallace/cowlogdata")
#remember to library(devtools first)
library(cowlogdata)
```

#GET DATAFRAMES
```{r, echo = FALSE, message=FALSE, warning=FALSE}
socadata<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SOCA_master.csv")

kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")

horm<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/hormone_data_master_december_2019.csv")

weight<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/master_data_sheets/weight_SL.csv")



```
#prespa get dataframe: (only  vids over 600)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

spapath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa4"
#clflag(spapath)
cldata(spapath, "prespadata", "spazones", factor = FALSE)
spalist<-list.files(spapath)
prespadata<-prespadata[prespadata$file_name %in% spalist,]
prespadata$fishID<-NA
prespadata$sex<-NA
i<-1
for(i in 1:nrow(prespadata)){
prespadata$fishID[i]<-strsplit(prespadata$file_name, "_")[[i]][1]
prespadata$sex[i]<-strsplit(prespadata$file_name, "_")[[i]][3]
}
prespadata<-prespadata %>% filter(sex == "male")

#########reward preference (corner + platform)
prespadata<-prespadata%>% mutate(reward_preference = (rewarded_corner_prop + rewarded_platform_prop)/(rewarded_corner_prop + rewarded_platform_prop + unrewarded_corner_prop + unrewarded_platform_prop))

##########decision speed (latency to enter either corner)
prespadata$latency_to_enter_either_corner<-NA
i<-1
for(i in 1:nrow(prespadata)){
shortest<- min(c(prespadata$rewarded_corner_first_entry_time[i], prespadata$unrewarded_corner_first_entry_time[i]), na.rm = TRUE)
prespadata$latency_to_enter_either_corner[i]<-shortest}

##########interaction latency (latency to enter either platform)

prespadata$latency_to_enter_either_platform<-NA
i<-1
for(i in 1:nrow(prespadata)){
shortest<- min(c(prespadata$rewarded_platform_first_entry_time[i], prespadata$unrewarded_platform_first_entry_time[i]), na.rm = TRUE)
prespadata$latency_to_enter_either_platform[i]<-shortest}


#########first choice rewarded or unrewarded (corner)
prespadata$first_choice<-NA
i<-1
for(i in 1:nrow(prespadata)){
  if(is.na(prespadata$latency_to_enter_either_corner[i]) == FALSE){
    
  if(is.na(prespadata$rewarded_corner_first_entry_time[i]) == FALSE){  
  if(as.numeric(prespadata$latency_to_enter_either_corner[i]) == as.numeric(prespadata$rewarded_corner_first_entry_time[i])){
  prespadata$first_choice[i]<-"rewarded"}}
    
  if(is.na(prespadata$unrewarded_corner_first_entry_time[i]) == FALSE){  
  if(as.numeric(prespadata$latency_to_enter_either_corner[i]) == as.numeric(prespadata$unrewarded_corner_first_entry_time[i])){
  prespadata$first_choice[i]<-"unrewarded"}}
  }}

#########eror correction speed
prespadata$error_correction_speed<-NA
i<-1
for(i in 1:nrow(prespadata)){
  if(is.na(prespadata$unrewarded_corner_first_entry_time[i]) == FALSE){
  if(is.na(prespadata$rewarded_corner_first_entry_time[i]) == FALSE){
  if(prespadata$unrewarded_corner_first_entry_time[i] < prespadata$rewarded_corner_first_entry_time[i]){
  prespadata$error_correction_speed[i]<-(prespadata$rewarded_corner_first_entry_time[i] - prespadata$unrewarded_corner_first_entry_time[i])}}}}
  
#########prop on reward following solution TBD

  

```
#postspa get dataframe: (only  vids over 600)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

spapath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa8"
cldata(spapath, "postspadata", "spazones", factor = FALSE)
spalist<-list.files(spapath)
postspadata<-postspadata[postspadata$file_name %in% spalist,]
postspadata$fishID<-NA
postspadata$sex<-NA
i<-1
for(i in 1:nrow(postspadata)){
postspadata$fishID[i]<-strsplit(postspadata$file_name, "_")[[i]][1]
postspadata$sex[i]<-strsplit(postspadata$file_name, "_")[[i]][3]
}
postspadata<-postspadata %>% filter(sex == "male")

#########reward preference (corner + platform)
postspadata<-postspadata%>% mutate(reward_preference = (rewarded_corner_prop + rewarded_platform_prop)/(rewarded_corner_prop + rewarded_platform_prop + unrewarded_corner_prop + unrewarded_platform_prop))

##########decision speed (latency to enter either corner)
postspadata$latency_to_enter_either_corner<-NA
i<-1
for(i in 1:nrow(postspadata)){
shortest<- min(c(postspadata$rewarded_corner_first_entry_time[i], postspadata$unrewarded_corner_first_entry_time[i]), na.rm = TRUE)
postspadata$latency_to_enter_either_corner[i]<-shortest}

##########interaction latency (latency to enter either platform)

postspadata$latency_to_enter_either_platform<-NA
i<-1
for(i in 1:nrow(postspadata)){
shortest<- min(c(postspadata$rewarded_platform_first_entry_time[i], postspadata$unrewarded_platform_first_entry_time[i]), na.rm = TRUE)
postspadata$latency_to_enter_either_platform[i]<-shortest}


#########first choice rewarded or unrewarded (corner)
postspadata$first_choice<-NA
i<-1
for(i in 1:nrow(postspadata)){
  if(is.na(postspadata$latency_to_enter_either_corner[i]) == FALSE){
    
  if(is.na(postspadata$rewarded_corner_first_entry_time[i]) == FALSE){  
  if(as.numeric(postspadata$latency_to_enter_either_corner[i]) == as.numeric(postspadata$rewarded_corner_first_entry_time[i])){
  postspadata$first_choice[i]<-"rewarded"}}
    
  if(is.na(postspadata$unrewarded_corner_first_entry_time[i]) == FALSE){  
  if(as.numeric(postspadata$latency_to_enter_either_corner[i]) == as.numeric(postspadata$unrewarded_corner_first_entry_time[i])){
  postspadata$first_choice[i]<-"unrewarded"}}
  }}

#########eror correction speed
postspadata$error_correction_speed<-NA
i<-1
for(i in 1:nrow(postspadata)){
  if(is.na(postspadata$unrewarded_corner_first_entry_time[i]) == FALSE){
  if(is.na(postspadata$rewarded_corner_first_entry_time[i]) == FALSE){
  if(postspadata$unrewarded_corner_first_entry_time[i] < postspadata$rewarded_corner_first_entry_time[i]){
  postspadata$error_correction_speed[i]<-(postspadata$rewarded_corner_first_entry_time[i] - postspadata$unrewarded_corner_first_entry_time[i])}}}}
  
#########prop on reward following solution TBD

  

```
#prenor get dataframe: (only  vids over 600)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

norpath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1"
clflag(norpath)
cldata(norpath, "prenordata", "norzones", factor = FALSE)
norlist<-list.files(norpath)
prenordata<-prenordata[prenordata$file_name %in% norlist,]
prenordata$fishID<-NA
prenordata$sex<-NA
i<-1
for(i in 1:nrow(prenordata)){
prenordata$fishID[i]<-strsplit(prenordata$file_name, "_")[[i]][1]
prenordata$sex[i]<-strsplit(prenordata$file_name, "_")[[i]][3]
}
prenordata<-prenordata %>% filter(sex == "male")

#########familiar preference (corner + interaction)
prenordata<-prenordata%>% mutate(familiar_preference = (upper_familiar_corner_prop + lower_familiar_corner_prop + familiar_interaction_prop)/(upper_familiar_corner_prop + lower_familiar_corner_prop + familiar_interaction_prop + upper_novel_corner_prop + lower_novel_corner_prop + novel_interaction_prop))

##########decision speed (latency to enter either corner)
prenordata$latency_to_enter_either_corner<-NA
i<-1
for(i in 1:nrow(prenordata)){
shortest<- min(c(prenordata$upper_familiar_corner_first_entry_time[i],prenordata$lower_familiar_corner_first_entry_time[i], prenordata$upper_novel_corner_first_entry_time[i], prenordata$lower_novel_corner_first_entry_time[i]), na.rm = TRUE)
prenordata$latency_to_enter_either_corner[i]<-shortest}

##########interaction latency (latency to enter either interaction)

prenordata$latency_to_enter_either_interaction<-NA
i<-1
for(i in 1:nrow(prenordata)){
shortest<- min(c(prenordata$familiar_interaction_first_entry_time[i], prenordata$novel_interaction_first_entry_time[i]), na.rm = TRUE)
prenordata$latency_to_enter_either_interaction[i]<-shortest}


#########first choice familiar or novel (corner)
prenordata$first_choice<-NA
i<-1
for(i in 1:nrow(prenordata)){
  if(is.na(prenordata$latency_to_enter_either_interaction[i]) == FALSE){
    
  if(is.na(prenordata$familiar_interaction_first_entry_time[i]) == FALSE){  
  if(as.numeric(prenordata$latency_to_enter_either_interaction[i]) == as.numeric(prenordata$familiar_interaction_first_entry_time[i])){
  prenordata$first_choice[i]<-"familiar"}}
    
  if(is.na(prenordata$novel_interaction_first_entry_time[i]) == FALSE){  
  if(as.numeric(prenordata$latency_to_enter_either_interaction[i]) == as.numeric(prenordata$novel_interaction_first_entry_time[i])){
  prenordata$first_choice[i]<-"novel"}}
  }}

#########eror correction speed
prenordata$error_correction_speed<-NA
i<-1
for(i in 1:nrow(prenordata)){
  if(is.na(prenordata$novel_interaction_first_entry_time[i]) == FALSE){
  if(is.na(prenordata$familiar_interaction_first_entry_time[i]) == FALSE){
  if(prenordata$novel_interaction_first_entry_time[i] < prenordata$familiar_interaction_first_entry_time[i]){
  prenordata$error_correction_speed[i]<-(prenordata$familiar_interaction_first_entry_time[i] - prenordata$novel_interaction_first_entry_time[i])}}}}
  
########remove upper and lower corners for sums
prenordata<-prenordata %>% mutate(sum_novel_prop = upper_novel_corner_prop + lower_novel_corner_prop+ novel_interaction_prop)
prenordata<-prenordata %>% mutate(sum_familiar_prop = upper_familiar_corner_prop + lower_familiar_corner_prop +familiar_interaction_prop)
prenordata<-prenordata %>% mutate(sum_novel_entries = upper_novel_corner_entries + lower_novel_corner_entries + novel_interaction_entries)
prenordata<-prenordata %>% mutate(sum_familiar_entries = upper_familiar_corner_entries + lower_familiar_corner_entries + familiar_interaction_entries) 


```
#postnor get dataframe: (only  vids over 600)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

norpath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2"
clflag(norpath)
cldata(norpath, "postnordata", "norzones", factor = FALSE)
norlist<-list.files(norpath)
postnordata<-postnordata[postnordata$file_name %in% norlist,]
postnordata$fishID<-NA
postnordata$sex<-NA
i<-1
for(i in 1:nrow(postnordata)){
postnordata$fishID[i]<-strsplit(postnordata$file_name, "_")[[i]][1]
postnordata$sex[i]<-strsplit(postnordata$file_name, "_")[[i]][3]
}
postnordata<-postnordata %>% filter(sex == "male")

#########familiar preference (corner + interaction)
postnordata<-postnordata%>% mutate(familiar_preference = (upper_familiar_corner_prop + lower_familiar_corner_prop + familiar_interaction_prop)/(upper_familiar_corner_prop + lower_familiar_corner_prop + familiar_interaction_prop + upper_novel_corner_prop + lower_novel_corner_prop + novel_interaction_prop))

##########decision speed (latency to enter either corner)
postnordata$latency_to_enter_either_corner<-NA
i<-1
for(i in 1:nrow(postnordata)){
shortest<- min(c(postnordata$upper_familiar_corner_first_entry_time[i],postnordata$lower_familiar_corner_first_entry_time[i], postnordata$upper_novel_corner_first_entry_time[i], postnordata$lower_novel_corner_first_entry_time[i]), na.rm = TRUE)
postnordata$latency_to_enter_either_corner[i]<-shortest}

##########interaction latency (latency to enter either interaction)

postnordata$latency_to_enter_either_interaction<-NA
i<-1
for(i in 1:nrow(postnordata)){
shortest<- min(c(postnordata$familiar_interaction_first_entry_time[i], postnordata$novel_interaction_first_entry_time[i]), na.rm = TRUE)
postnordata$latency_to_enter_either_interaction[i]<-shortest}


#########first choice familiar or novel (corner)
postnordata$first_choice<-NA
i<-1
for(i in 1:nrow(postnordata)){
  if(is.na(postnordata$latency_to_enter_either_interaction[i]) == FALSE){
    
  if(is.na(postnordata$familiar_interaction_first_entry_time[i]) == FALSE){  
  if(as.numeric(postnordata$latency_to_enter_either_interaction[i]) == as.numeric(postnordata$familiar_interaction_first_entry_time[i])){
  postnordata$first_choice[i]<-"familiar"}}
    
  if(is.na(postnordata$novel_interaction_first_entry_time[i]) == FALSE){  
  if(as.numeric(postnordata$latency_to_enter_either_interaction[i]) == as.numeric(postnordata$novel_interaction_first_entry_time[i])){
  postnordata$first_choice[i]<-"novel"}}
  }}

#########eror correction speed
postnordata$error_correction_speed<-NA
i<-1
for(i in 1:nrow(postnordata)){
  if(is.na(postnordata$novel_interaction_first_entry_time[i]) == FALSE){
  if(is.na(postnordata$familiar_interaction_first_entry_time[i]) == FALSE){
  if(postnordata$novel_interaction_first_entry_time[i] < postnordata$familiar_interaction_first_entry_time[i]){
  postnordata$error_correction_speed[i]<-(postnordata$familiar_interaction_first_entry_time[i] - postnordata$novel_interaction_first_entry_time[i])}}}}
  
########remove upper and lower corners for sum corners
postnordata<-postnordata %>% mutate(sum_novel_prop = upper_novel_corner_prop + lower_novel_corner_prop+ novel_interaction_prop)
postnordata<-postnordata %>% mutate(sum_familiar_prop = upper_familiar_corner_prop + lower_familiar_corner_prop +familiar_interaction_prop)
postnordata<-postnordata %>% mutate(sum_novel_entries = upper_novel_corner_entries + lower_novel_corner_entries + novel_interaction_entries)
postnordata<-postnordata %>% mutate(sum_familiar_entries = upper_familiar_corner_entries + lower_familiar_corner_entries + familiar_interaction_entries)

  

```
#get variables lists (based off covariance matrices, removing >0.8 in either pre or post)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

##########SOCA
socavariableslist<-c("number_of_entries_opporutnity","number_of_entires_challenge","number_digging", "number_activity_female_barrier", "number_activity_at_resident_barrier" , "number_activity_at_neural_barrier", "number_reproductive_display" ,"number_lateral_display","number_border_conflict" ,"number_aggressive_behavior_by_resident", "aggression_index","prop_PVC","prop_female_barrier", "prop_resident_barrier","prop_resident_wall","prop_resident_corner","prop_camera_wall",  "prop_female_corner","prop_female_wall", "prop_female_space","prop_resident_space", "number_digging_opportunity","number_activity_female_barrier_opportunity", "number_activity_at_resident_barrier_opportunity","number_activity_at_neural_barrier_opportunity", "number_reproductive_display_opportunity", "number_lateral_display_opportunity", "number_border_conflict_opportunity","prop_PVC_opportunity" , "prop_female_barrier_opportunity", "prop_resident_barrier_opportunity","prop_resident_wall_opportunity", "prop_resident_corner_opportunity" ,"prop_camera_wall_opportunity", "prop_female_corner_opportunity" ,  "prop_female_wall_opportunity", "prop_female_space_opportunity", "prop_resident_space_opportunity", "number_digging_challenge" ,"number_activity_female_barrier_challenge", "number_activity_at_resident_barrier_challenge", "number_activity_at_neural_barrier_challenge", "number_reproductive_display_challenge", "number_lateral_display_challenge", "number_border_conflict_challenge" , "prop_PVC_challenge", "prop_female_barrier_challenge"  ,   "prop_resident_barrier_challenge", "prop_resident_wall_challenge", "prop_resident_corner_challenge", "prop_camera_wall_challenge", "prop_female_corner_challenge", "prop_female_wall_challenge", "prop_female_space_challenge", "prop_resident_space_challenge" , "prop_sum_resident", "prop_sum_female", "prop_sum_corner", "prop_sum_resident_opportunity" , "prop_sum_female_opportunity", "prop_sum_corner_opportunity", "prop_sum_resident_challenge", "prop_sum_female_challenge", "prop_sum_corner_challenge", "change_in_activity_at_female_barrier_opportunity_to_challenge", "change_in_reproductive_display_opportunity_to_challenge", "change_in_lateral_display_opportunity_to_challenge",  "change_in_prop_sum_female_opportunity_to_challenge", "change_in_prop_sum_resident_opportunity_to_challenge")


##############SPA
spavariableslist<-colnames(prespadata)
drops<-c("file_name", "neutral_zone_seconds", "back_wall_seconds", "unrewarded_wall_seconds", "rewarded_corner_seconds","rewarded_platform_seconds", "rewarded_wall_seconds", "unrewarded_corner_seconds", "unrewarded_platform_seconds", "vid_length", "fishID", "sex", "first_choice", "error_correction_speed", "barrier_first_entry_time")
#removing error correction speed because only a couple individuals have it
spavariableslist<-spavariableslist[(spavariableslist %in% drops)== FALSE]

#look for highly correlated varialbes in prespadata
i<-1
j<-1
k<-1
temp<-as.data.frame(vector(length = length(spavariableslist) * length(spavariableslist)))
 for(i in 1:length(spavariableslist)){
  for(j in 1:length(spavariableslist)){
measure1_name<-as.character(spavariableslist[i])
measure2_name<-as.character(spavariableslist[j])
temp$measure1[k]<-measure1_name
temp$measure2[k]<-measure2_name
temptemp<-as.data.frame(vector(length = nrow(prespadata)))
temptemp$measure1<-prespadata%>% select(measure1_name) %>% as.vector()
temptemp$measure2<-prespadata%>% select(measure2_name) %>% as.vector()
temptemp<-temptemp %>% select(c(measure1,measure2))
temptemp<-as.matrix(temptemp)
temptemp<-as.data.frame(temptemp)
temptemp<-temptemp %>% filter(is.na(measure1) == FALSE & is.na(measure2) == FALSE)
pearson<-cor(temptemp$measure1, temptemp$measure2,  method = "pearson")
temp$abspearson[k]<-abs(pearson)
k<-k+1
  }}
temp<-temp%>% select(c(measure1,measure2,abspearson))
temp$abspearson<-as.numeric(temp$abspearson)
temp<-temp%>%filter(abspearson > 0.8 & abspearson< 1)

#now look for highly correlated variables in postspsadata
i<-1
j<-1
k<-1
temp<-as.data.frame(vector(length = length(spavariableslist) * length(spavariableslist)))
 for(i in 1:length(spavariableslist)){
  for(j in 1:length(spavariableslist)){
measure1_name<-as.character(spavariableslist[i])
measure2_name<-as.character(spavariableslist[j])
temp$measure1[k]<-measure1_name
temp$measure2[k]<-measure2_name
temptemp<-as.data.frame(vector(length = nrow(postspadata)))
temptemp$measure1<-postspadata%>% select(measure1_name) %>% as.vector()
temptemp$measure2<-postspadata%>% select(measure2_name) %>% as.vector()
temptemp<-temptemp %>% select(c(measure1,measure2))
temptemp<-as.matrix(temptemp)
temptemp<-as.data.frame(temptemp)
temptemp<-temptemp %>% filter(is.na(measure1) == FALSE & is.na(measure2) == FALSE)
pearson<-cor(temptemp$measure1, temptemp$measure2,  method = "pearson")
temp$abspearson[k]<-abs(pearson)
k<-k+1
  }}
temp<-temp%>% select(c(measure1,measure2,abspearson))
temp$abspearson<-as.numeric(temp$abspearson)
temp<-temp%>%filter(abspearson > 0.8 & abspearson< 1)

#Variables to REMOVE after covariance matrix test:

#PRE
#back wall entries (using neutral wall entries)
#reward platform prop (using reward preference)
#unrewarded wall entries (using unrewarded corner entries)
#rewarded wall entries (using rewarded wall prop)
#rewarded platform first entry time (using rewarded corner first entry time)
#rewarded platform entries (using rewarded corner entries)

#POST
#rewarded platform prop (using unrewarded corner first entry time)
#unrewarded wall entries (using unrewarded corner entries)
#back wall first entry time (using unrewarded platofrm first entry time)
#unrewarded platform prop (using reward preference)
#unrewarded platform first entry time (using unrewarded corner first entry time)
#rewarded platform first entry time (using rewarded corner first entry time)
#rewarded wall prop & rewarded wall entries (using rewarded corner entries)


spacovmatrixlist<-c("back_wall_entries", "rewarded_platform_prop", "unrewarded_wall_entries", "rewarded_wall_entries", "rewarded_platform_first_entry_time", "rewarded_platform_entries", "back_wall_first_entry_time", "unrewarded_platform_prop", "unrewarded_platform_first_entry_time", "rewarded_wall_prop")
spavariableslist<-spavariableslist[(spavariableslist %in% spacovmatrixlist)== FALSE]




#################NOR
norvariableslist<-colnames(prenordata)
drops<-c("file_name", "vid_length", "fishID", "sex", "first_choice", "error_correction_speed", "novel_alley_seconds", "novel_interaction_seconds", "upper_novel_corner_seconds", "lower_novel_corner_seconds","familiar_alley_seconds", "familiar_interaction_seconds", "upper_familiar_corner_seconds", "lower_familiar_corner_seconds", "behind_barrier_seconds", "behind_barrier_prop", "behind_barrier_first_entry_time", "upper_novel_corner_prop", "lower_novel_corner_prop", "upper_familiar_corner_prop", "lower_familiar_corner_prop", "upper_familiar_corner_entries", "lower_familiar_corner_entries", "upper_novel_corner_entries", "lower_novel_corner_entries", "behind_barrier_entries", "upper_novel_corner_first_entry_time", "lower_novel_corner_first_entry_time", "upper_familiar_corner_first_entry_time", "lower_familiar_corner_first_entry_time")

norvariableslist<-norvariableslist[(norvariableslist %in% drops)== FALSE]

#look for highly correlated varialbes in prenordata
i<-1
j<-1
k<-1
temp<-as.data.frame(vector(length = length(norvariableslist) * length(norvariableslist)))
 for(i in 1:length(norvariableslist)){
  for(j in 1:length(norvariableslist)){
measure1_name<-as.character(norvariableslist[i])
measure2_name<-as.character(norvariableslist[j])
temp$measure1[k]<-measure1_name
temp$measure2[k]<-measure2_name
temptemp<-as.data.frame(vector(length = nrow(prenordata)))
temptemp$measure1<-prenordata%>% select(measure1_name) %>% as.vector()
temptemp$measure2<-prenordata%>% select(measure2_name) %>% as.vector()
temptemp<-temptemp %>% select(c(measure1,measure2))
temptemp<-as.matrix(temptemp)
temptemp<-as.data.frame(temptemp)
temptemp<-temptemp %>% filter(is.na(measure1) == FALSE & is.na(measure2) == FALSE)
pearson<-cor(temptemp$measure1, temptemp$measure2,  method = "pearson")
temp$abspearson[k]<-abs(pearson)
k<-k+1
  }}
temp<-temp%>% select(c(measure1,measure2,abspearson))
temp$abspearson<-as.numeric(temp$abspearson)
temp<-temp%>%filter(abspearson > 0.8 & abspearson< 1)

#now look for highly correlated variables in postnordata
i<-1
j<-1
k<-1
temp<-as.data.frame(vector(length = length(norvariableslist) * length(norvariableslist)))
 for(i in 1:length(norvariableslist)){
  for(j in 1:length(norvariableslist)){
measure1_name<-as.character(norvariableslist[i])
measure2_name<-as.character(norvariableslist[j])
temp$measure1[k]<-measure1_name
temp$measure2[k]<-measure2_name
temptemp<-as.data.frame(vector(length = nrow(postnordata)))
temptemp$measure1<-postnordata%>% select(measure1_name) %>% as.vector()
temptemp$measure2<-postnordata%>% select(measure2_name) %>% as.vector()
temptemp<-temptemp %>% select(c(measure1,measure2))
temptemp<-as.matrix(temptemp)
temptemp<-as.data.frame(temptemp)
temptemp<-temptemp %>% filter(is.na(measure1) == FALSE & is.na(measure2) == FALSE)
pearson<-cor(temptemp$measure1, temptemp$measure2,  method = "pearson")
temp$abspearson[k]<-abs(pearson)
k<-k+1
  }}
temp<-temp%>% select(c(measure1,measure2,abspearson))
temp$abspearson<-as.numeric(temp$abspearson)
temp<-temp%>%filter(abspearson > 0.8 & abspearson< 1)


#Variables to REMOVE after covariance matrix test:

#PRE
#novel alley entries (using familiar alley entries)
#novel alley first entry time (using novel interaction first entry time)
#sum novel prop and sum familiar prop(using familiar reference)
#familiar alley first entry time (using familiar interaction first entry time)
#novel interaction entries (using sum novel entries)
#familiar interaction entries (using sum familiar entries)


#POST
#novel interaction entries and sum novel entries (using novel interaction prop)
#novel alley entries (using familiar alley entries)
#familiar interaction prop (using sum familiar entries)
#latency to enter either corner (using latency to enter either interaction)


norcovmatrixlist<-c("novel_alley_entries", "novel_alley_first_entry_time", "sum_novel_prop", "sum_familiar_prop", "familiar_alley_first_entry_time", "novel_interaction_entries", "familiar_interaction_entries", "sum_novel_entries", "familiar_interaction_prop", "latency_to_enter_either_corner")

norvariableslist<-norvariableslist[(norvariableslist %in% norcovmatrixlist)== FALSE]



##########shorter variables list for PCA
preshortlist<-c("CORT_by_weight", "T_by_weight", "reward_preference", "rewarded_corner_first_entry_time", "neutral_zone_entries","familiar_preference","SOCA1prop_female_space_opportunity", "SOCA1prop_female_space_challenge", "SOCA1prop_resident_space_opportunity", "SOCA1prop_resident_space_challenge")

postshortlist<-c("CORT_by_weight", "T_by_weight", "reward_preference", "rewarded_corner_first_entry_time", "neutral_zone_entries","familiar_preference","SOCA2prop_female_space_opportunity", "SOCA2prop_female_space_challenge", "SOCA2prop_resident_space_opportunity", "SOCA2prop_resident_space_challenge")

######SHORT soca variables list
presocavariableslistshort<- c("SOCA1prop_female_space_opportunity", "SOCA1prop_female_space_challenge", "SOCA1prop_resident_space_opportunity", "SOCA1prop_resident_space_challenge")

postsocavariableslistshort<- c("SOCA2prop_female_space_opportunity", "SOCA2prop_female_space_challenge", "SOCA2prop_resident_space_opportunity", "SOCA2prop_resident_space_challenge")


```



#PRESPADATA
#prespa pie charts
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")

df<-left_join(kp, prespadata, by = "fishID")

zones<-c("back_wall", "neutral_zone","rewarded_corner", "rewarded_platform", "rewarded_wall", "unrewarded_corner", "unrewarded_platform", "unrewarded_wall")

#####pie chart all data
print("pre spa space use")
clpie(dataname = df, zonename = zones, factor = FALSE)


#####pie chart by status pre
df<-df %>% filter(is.na(KPstatus_day_15)== FALSE)
df$KPstatus_day_15<-as.factor(df$KPstatus_day_15)
df<-df[, -which(names(df) %in% c("KPprop_dom", "KPprop_sub", "KPprop_int", "KPprop_not_sub"))]
print("pre spa space use by status day 15")
clpie(dataname = df, zonename = zones, factor = TRUE, factorname = "KPstatus_day_15")
print("number of doms day 15")
df %>% filter(KPstatus_day_15 == "dom") %>% nrow()
print("number of ints 15")
df %>% filter(KPstatus_day_15 == "int") %>% nrow()
print("number of sub 15")
df %>% filter(KPstatus_day_15 == "sub") %>% nrow()
        

#####pie chart by did fish then go on to ascend or not
df<-left_join(kp, prespadata, by = "fishID")
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-df[, -which(names(df) %in% c("KPprop_dom", "KPprop_sub", "KPprop_int", "KPprop_not_sub"))]
print("pre spa space use by did then ascend (1 = yes)")
clpie(dataname = df, zonename = zones, factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")
print("number of yes/ascended")
df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>% nrow()
print("number of no/did not ascend")
df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>% nrow()
        

```
#prespa time series
```{r, echo = FALSE, message=FALSE, warning=FALSE}
zones<-c("neutral_zone", "back_wall", "rewarded_wall", "rewarded_corner",  "rewarded_platform", "unrewarded_wall", "unrewarded_corner", "unrewarded_platform")

spapath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa4/sub_pre"


#filelist<-list.files(spapath)
clseries(spapath, zones, seglength = 5, factor = FALSE)
clseries(spapath, zones, seglength = 60, factor = FALSE)




```
#prespa boxplot (asc vs not)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
df<-left_join(kp, prespadata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub")


listforboxplot<-c("neutral_zone_prop", "back_wall_prop", "neutral_zone_entries", "back_wall_entries" ,  "neutral_zone_first_entry_time", "back_wall_first_entry_time","rewarded_wall_prop", "unrewarded_wall_prop", "rewarded_corner_prop",  "unrewarded_corner_prop", "rewarded_platform_prop", "unrewarded_platform_prop" , "rewarded_wall_entries" ,                "unrewarded_wall_entries", "rewarded_corner_entries" , "unrewarded_corner_entries", "rewarded_platform_entries", "unrewarded_platform_entries" , "rewarded_wall_first_entry_time", "unrewarded_wall_first_entry_time", "rewarded_corner_first_entry_time" , "unrewarded_corner_first_entry_time",    "rewarded_platform_first_entry_time", "unrewarded_platform_first_entry_time", "reward_preference", "latency_to_enter_either_corner", "latency_to_enter_either_platform" , "error_correction_speed")

  temp<-df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)
  temp<-temp %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
  temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)

clboxplot(temp,factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")
  

```
#prespa learning category and other
```{r, echo = FALSE, message=FALSE, warning=FALSE}
spalearncat<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_first_choice_four_trials.csv")
colnames(spalearncat)[1] <- "fishID"
df<-left_join(kp, spalearncat, by = "fishID")
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)


#####are subs picking randomly first trial?

a<-df %>% filter(trial1_firstchoice == "correct") %>%nrow
x<-df %>% filter(trial1_firstchoice == "incorrect") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value #first different from random? NO
print("p value chip spa pre picking randomly trial 1")
print(chip)
#φ = sqrt(x2/n)
print("effect size")
print(sqrt(0.54998/23))

#####are subs picking rewarded or unrewarded more than expected by chance by trial 4?
a<-df %>% filter(trial4_firstchoice == "correct") %>%nrow
x<-df %>% filter(trial4_firstchoice == "incorrect") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip spa pre subs on trial 4 (test)")
print(chip)
#φ = sqrt(x2/n)
print("effect size")
print(sqrt(0.7619/24))


#####subs spa learning category:
non<- df %>% filter(SPA_learning_category == "non") %>% nrow()
low<- df %>% filter(SPA_learning_category == "low") %>% nrow()
high<-df %>% filter(SPA_learning_category == "high") %>% nrow()

print(paste("prespa  non learners:", non))
print(paste("prespa  low learners:", low))
print(paste("prespa  high learners:", high))


######error correction speed for those who picked wrong first
print("error correction speed spa4, subs only")
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, prespadata, by = "fishID")
temp<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE) %>% filter(first_choice == "unrewarded")
mean(temp$error_correction_speed, na.rm = TRUE)


```


#POSTSPADATA
#postspa pie chart
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")

df<-left_join(kp, postspadata, by = "fishID")
df<-df %>%filter(KPstatus_day_15 == "sub")
zones<-c("back_wall", "neutral_zone","rewarded_corner", "rewarded_platform", "rewarded_wall", "unrewarded_corner", "unrewarded_platform", "unrewarded_wall")


#####pie chart by did fish then go on to ascend or not
df<-left_join(kp, postspadata, by = "fishID")
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-df[, -which(names(df) %in% c("KPprop_dom", "KPprop_sub", "KPprop_int", "KPprop_not_sub"))]
print("post spa space use by did then ascend (1 = yes)")
clpie(dataname = df, zonename = zones, factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")
print("number of yes/ascended")
df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>% nrow()
print("number of no/did not ascend")
df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>% nrow()
        

```
#postspa time series
```{r, echo = FALSE, message=FALSE, warning=FALSE}
zones<-c("neutral_zone", "back_wall", "rewarded_wall", "rewarded_corner",  "rewarded_platform", "unrewarded_wall", "unrewarded_corner", "unrewarded_platform")

spapath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa8"
clseries(spapath, zones, seglength = 5, factor = TRUE, factorindex = 6, factorname = "did fish ascend")
clseries(spapath, zones, seglength = 60, factor = TRUE, factorindex = 6, factorname = "did fish ascend")

```
#postspa boxplot (asc vs not)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub")


listforboxplot<-c("neutral_zone_prop", "back_wall_prop", "barrier_prop", "neutral_zone_entries", "back_wall_entries" , "barrier_entries", "neutral_zone_first_entry_time", "back_wall_first_entry_time",  "barrier_first_entry_time" , "rewarded_wall_prop", "unrewarded_wall_prop", "rewarded_corner_prop",  "unrewarded_corner_prop", "rewarded_platform_prop", "unrewarded_platform_prop" , "rewarded_wall_entries" ,                "unrewarded_wall_entries", "rewarded_corner_entries" , "unrewarded_corner_entries", "rewarded_platform_entries", "unrewarded_platform_entries" , "rewarded_wall_first_entry_time", "unrewarded_wall_first_entry_time", "rewarded_corner_first_entry_time" , "unrewarded_corner_first_entry_time",    "rewarded_platform_first_entry_time", "unrewarded_platform_first_entry_time", "reward_preference", "latency_to_enter_either_corner", "latency_to_enter_either_platform" , "error_correction_speed")


  temp<-df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)
  temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)
  
clboxplot(temp,factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")




#specifically solution speed (latency to enter rewarded corner)

t_test<-t.test(df$rewarded_corner_first_entry_time~df$KPdid_fish_ascend_days_15_to_18)
p_value_t<-t_test$p.value
print("post SPA solution speed asc vs nonasc")
print(t_test)

  cohen<-cohen.d(df$rewarded_corner_first_entry_time~df$KPdid_fish_ascend_days_15_to_18)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>% nrow()
numberA
numberB<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>% nrow()
numberB

  

```
#postspa regression (asc vs not)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub")

listforboxplot<-c("neutral_zone_prop", "back_wall_prop", "barrier_prop", "neutral_zone_entries", "back_wall_entries" , "barrier_entries", "neutral_zone_first_entry_time", "back_wall_first_entry_time",  "barrier_first_entry_time" , "rewarded_wall_prop", "unrewarded_wall_prop", "rewarded_corner_prop",  "unrewarded_corner_prop", "rewarded_platform_prop", "unrewarded_platform_prop" , "rewarded_wall_entries" ,                "unrewarded_wall_entries", "rewarded_corner_entries" , "unrewarded_corner_entries", "rewarded_platform_entries", "unrewarded_platform_entries" , "rewarded_wall_first_entry_time", "unrewarded_wall_first_entry_time", "rewarded_corner_first_entry_time" , "unrewarded_corner_first_entry_time",    "rewarded_platform_first_entry_time", "unrewarded_platform_first_entry_time", "reward_preference", "latency_to_enter_either_corner", "latency_to_enter_either_platform" , "error_correction_speed")

zones<-c("neutral_zone", "back_wall", "rewarded_wall", "rewarded_corner",  "rewarded_platform", "unrewarded_wall", "unrewarded_corner", "unrewarded_platform")

  temp<-df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)
  temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)
  
clreg(temp,zones, factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")
  

```
#postspa first choice and other
```{r, echo = FALSE, message=FALSE, warning=FALSE}


#####do all  post spa pick more than chance? no
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
a<-df %>% filter(first_choice == "unrewarded") %>%nrow
x<-df %>% filter(first_choice == "rewarded") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip spa8 ")
print(chip)

#φ = sqrt(x2/n)
print("effect size")
print(sqrt(0.99959/25))

#####do ascenders post spa pick more than chance? no
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
df<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
a<-df %>% filter(first_choice == "unrewarded") %>%nrow
x<-df %>% filter(first_choice == "rewarded") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip spa8 ascenders")
print(chip)



#####do nonascenders post spa pick more than chance? no
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
df<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0)
a<-df %>% filter(first_choice == "unrewarded") %>%nrow
x<-df %>% filter(first_choice == "rewarded") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip spa8 nonascenders")
print(chip)




######do ascenders and nonascenders pick differently?
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
a<-df %>% filter(first_choice == "unrewarded")%>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>%nrow
x<-df %>% filter(first_choice == "rewarded")%>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>%nrow
b<-df %>% filter(first_choice == "unrewarded")%>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>%nrow
z<-df %>% filter(first_choice == "rewarded")%>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>%nrow
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip spa8 nonascenders")
print(chip)

#φ = sqrt(x2/n)
print("effect size")
print(sqrt(1.4178/25))



#####switch speed (like error correction speed but not filtering which one picked first)
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postspadata, by = "fishID")
df<- df %>% filter(KPstatus_day_15 == "sub") 
df<- df %>% mutate(switch_speed = abs(unrewarded_corner_first_entry_time - rewarded_corner_first_entry_time))
df<- df %>% select(switch_speed, KPdid_fish_ascend_days_15_to_18)
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
t.test(df$switch_speed ~ df$KPdid_fish_ascend_days_15_to_18)

```




#PRENORDATA
#prenordata pie chart
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")

df<-left_join(kp, prenordata, by = "fishID")
df<-df %>% filter(behind_barrier_prop == 0)

zones<-c("familiar_alley", "familiar_interaction", "upper_familiar_corner", "lower_familiar_corner", "novel_alley", "novel_interaction", "upper_novel_corner", "lower_novel_corner")
#####pie chart all data
print("pre nor space use")
clpie(dataname = df, zonename = zones, factor = FALSE)


#####pie chart by status pre
df<-df %>% filter(is.na(KPstatus_day_15)== FALSE)
df$KPstatus_day_15<-as.factor(df$KPstatus_day_15)
df<-df[, -which(names(df) %in% c("KPprop_dom", "KPprop_sub", "KPprop_int", "KPprop_not_sub"))]
print("pre nor space use by status day 15")
clpie(dataname = df, zonename = zones, factor = TRUE, factorname = "KPstatus_day_15")
print("number of doms day 15")
df %>% filter(KPstatus_day_15 == "dom") %>% nrow()
print("number of ints 15")
df %>% filter(KPstatus_day_15 == "int") %>% nrow()
print("number of sub 15")
df %>% filter(KPstatus_day_15 == "sub") %>% nrow()
        

```
#prenor time series
```{r, echo = FALSE, message=FALSE, warning=FALSE}

zones<-c("familiar_alley", "familiar_interaction", "upper_familiar_corner", "lower_familiar_corner", "novel_alley", "novel_interaction", "upper_novel_corner", "lower_novel_corner")
norpath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1/sub_pre"


#filelist<-list.files(norpath)
clseries(norpath, zones, seglength = 5, factor = FALSE)
clseries(norpath, zones, seglength = 55, factor = FALSE)



```
#prenor boxplot (asc vs not)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, prenordata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub")

listforboxplot<- c("familiar_alley_prop","familiar_interaction_prop","sum_familiar_prop","novel_alley_prop","novel_interaction_prop","sum_novel_prop","familiar_alley_entries","familiar_interaction_entries","sum_familiar_entries","novel_alley_entries","novel_interaction_entries","sum_novel_entries","familiar_alley_first_entry_time","familiar_interaction_first_entry_time" ,"novel_alley_first_entry_time" ,"novel_interaction_first_entry_time",  "familiar_preference","latency_to_enter_either_corner","latency_to_enter_either_interaction","error_correction_speed")
  
  
df<- df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)  
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)

clboxplot(df,factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")


  

```
#prenor other
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, prenordata, by = "fishID")



#####are subs picking familiar/novel more than expected by chance first NOR (of those who are in post dataset)?
df<-df %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
a<-df %>% filter(first_choice == "familiar") %>%nrow
x<-df %>% filter(first_choice == "novel") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value #first different from random? NO
print("p value chip spa pre subs picking familiar/novel more than expected by chance first NOR")
print(chip)

#φ = sqrt(x2/n)
sqrt(2.667/20)


#boxplot prop familiar compared to 50% (across entire length of task)
t_test<-t.test(prenordata$familiar_preference, mu = 0.5)
p_value_t<-t_test$p.value
print("pre NOR familiar preference compared to 50% t test, entire length of task")
print(p_value_t)


######NOR1 preference over time

file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1", pattern = "*.csv")

norfishlist<-kp %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
norfishlist<-as.list(strsplit(as.character(norfishlist$fishID),'_'))

  seg1_preference_familiar_corner_and_interaction<-vector(length = length(norfishlist))
  fullframe<-as.data.frame(vector(length = length(norfishlist)))
  fullframe$trial<-"nor1"
  
  nov_left_list<-c("round1", "round2", "round5", "round6")
  nov_right_list<-c("round3", "round4", "round7", "round8")
  
i<-1
k<-1
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  fullframe[k,1]<-fishid
  fullframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  fullframe$nov_interaction[k]<-seg1_prop_novel_interaction
  fullframe$fam_corners[k]<-seg1_prop_familiar_corners
  fullframe$nov_corners[k]<- seg1_prop_novel_corners
    colnames(fullframe)[1]<-"fishID"
  k<-k+1
}}

fullframe<-fullframe %>% filter(fishid != FALSE)
fullframe<-fullframe %>% mutate(familiar_preference = (fam_interaction + fam_corners)/ (fam_interaction + fam_corners + nov_interaction + nov_corners))
fullframe<-fullframe %>% mutate(fam_corner_and_int = fam_interaction + fam_corners)
fullframe<-left_join(kp, fullframe, by = "fishID")
fullframe$KPdid_fish_ascend_days_15_to_18<-as.factor(fullframe$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(fullframe$familiar_preference, mu = 0.5)
p_value_wilcox<-wilcox_test$p.value
print("nor1 familiar preference compared to 50% t test, first 60 seconds")
print(p_value_wilcox)
wilcox_test<-t.test(fullframe$familiar_preference~ fullframe$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("nor1 familiar preference ascenders vs nonascenders, first 60 seconds")
print(p_value_wilcox)


ggplot(fullframe, aes(x = trial, y = familiar_preference, fill = KPdid_fish_ascend_days_15_to_18)) + geom_boxplot(fill = "white")  + theme_classic() + labs(x = "nor1", y = "familiar preference
compared to 50% p (wilcox test) = 0.06
asc vs non p (wilcox test) p = 0.111") + theme(aspect.ratio = 3) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1)+ scale_fill_manual(values=c("maroon", "turquoise4")) 

wilcox_test<-wilcox.test(fullframe$fam_corner_and_int, mu = 0.5)
p_value_wilcox<-wilcox_test$p.value
print("nor1 fam_corner_and_int compared to 50% t test, first 60 seconds")
print(p_value_wilcox)
wilcox_test<-t.test(fullframe$fam_corner_and_int~ fullframe$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("nor1 fam_corner_and_int ascenders vs nonascenders, first 60 seconds")
print(p_value_wilcox)

ggplot(fullframe, aes(x = trial, y = fam_corner_and_int, fill = KPdid_fish_ascend_days_15_to_18)) + geom_boxplot(fill = "white")  + theme_classic() + labs(x = "nor1", y = "familiar corner and interaction %
asc vs no p (wilcox test) p = 0.029") + theme(aspect.ratio = 3) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1)+ scale_fill_manual(values=c("maroon", "turquoise4")) 



#########all males (including doms) nor1 first minute familiar preference 

file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1", pattern = "*.csv")

norfishlist<-kp
norfishlist<-as.list(strsplit(as.character(norfishlist$fishID),'_'))

  seg1_preference_familiar_corner_and_interaction<-vector(length = length(norfishlist))
  tempframe<-as.data.frame(vector(length = length(norfishlist)))
  tempframe$trial<-"nor1"
  
  nov_left_list<-c("round1", "round2", "round5", "round6")
  nov_right_list<-c("round3", "round4", "round7", "round8")
  
i<-1
k<-1
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  tempframe[k,1]<-fishid
  tempframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  tempframe$nov_interaction[k]<-seg1_prop_novel_interaction
  tempframe$fam_corners[k]<-seg1_prop_familiar_corners
  tempframe$nov_corners[k]<- seg1_prop_novel_corners
    colnames(tempframe)[1]<-"fishID"
  k<-k+1
}}

tempframe<-tempframe %>% filter(fishid != FALSE)
tempframe<-tempframe %>% mutate(familiar_preference = (fam_interaction + fam_corners)/ (fam_interaction + fam_corners + nov_interaction + nov_corners))
tempframe<-tempframe %>% mutate(fam_corner_and_int = fam_interaction + fam_corners)
tempframe<-left_join(kp, tempframe, by = "fishID")
#tempframe<-tempframe %>% filter(KPstatus_day_15 == "dom")
wilcox_test<-t.test(tempframe$familiar_preference, mu = 0.5)
p_value_wilcox<-wilcox_test$p.value
print("NOR1 preference, all fish (including doms)")
print (p_value_wilcox)

tempframe$trial<-as.factor(tempframe$trial)
p<-ggplot(tempframe, aes(x = trial, y = familiar_preference, fill = KPstatus_day_15))+ 
  geom_boxplot(fill = "white")  +
  theme_classic() +
  labs(x = "nor1", y = "familiar preference") +
  theme(aspect.ratio = 3) +
  ggtitle("nor1 preference including 
  doms p (wilcox) 50% =0.048")+
  geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 0.4)
plot(p)




```


#POSTNORDATA
#postnordata pie chart
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")

df<-left_join(kp, postnordata, by = "fishID")
df<-df %>% filter(behind_barrier_prop == 0)

zones<-c("familiar_alley", "familiar_interaction", "upper_familiar_corner", "lower_familiar_corner", "novel_alley", "novel_interaction", "upper_novel_corner", "lower_novel_corner")

#####pie chart all data
print("post nor space use")
clpie(dataname = df, zonename = zones, factor = FALSE)


#####pie chart by status pre
df<-df %>% filter(is.na(KPstatus_day_15)== FALSE)
df$KPstatus_day_15<-as.factor(df$KPstatus_day_15)
df<-df[, -which(names(df) %in% c("KPprop_dom", "KPprop_sub", "KPprop_int", "KPprop_not_sub"))]
print("post nor space use by status day 15")
clpie(dataname = df, zonename = zones, factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")
print("number ascend")
df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>% nrow()
print("number did NOT ascend")
df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>% nrow()

        

```
#postnor time series
```{r, echo = FALSE, message=FALSE, warning=FALSE}

zones<-c("familiar_alley", "familiar_interaction", "upper_familiar_corner", "lower_familiar_corner", "novel_alley", "novel_interaction", "upper_novel_corner", "lower_novel_corner")

norpath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2"

clseries(norpath, zones, seglength = 5, factor = TRUE, factorindex = 6, factorname = "did fish ascend")
clseries(norpath, zones, seglength = 50, factor = TRUE, factorindex = 6, factorname = "did fish ascend") #fix

```
#postnor boxplot (asc vs not)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postnordata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub")

listforboxplot<- c("familiar_alley_prop","familiar_interaction_prop","sum_familiar_prop","novel_alley_prop","novel_interaction_prop","sum_novel_prop","familiar_alley_entries","familiar_interaction_entries","sum_familiar_entries","novel_alley_entries","novel_interaction_entries","sum_novel_entries","familiar_alley_first_entry_time","familiar_interaction_first_entry_time" ,"novel_alley_first_entry_time" ,"novel_interaction_first_entry_time",  "familiar_preference","latency_to_enter_either_corner","latency_to_enter_either_interaction","error_correction_speed")
  
  
df<- df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)  
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)

clboxplot(df,factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")


  

```
#postnor regression (asc vs not)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postnordata, by = "fishID")
df<- df %>% filter(KPstatus_day_15 == "sub")


listforboxplot<- c("familiar_alley_prop","familiar_interaction_prop","sum_familiar_prop","novel_alley_prop","novel_interaction_prop","sum_novel_prop","familiar_alley_entries","familiar_interaction_entries","sum_familiar_entries","novel_alley_entries","novel_interaction_entries","sum_novel_entries","familiar_alley_first_entry_time","familiar_interaction_first_entry_time" ,"novel_alley_first_entry_time" ,"novel_interaction_first_entry_time",  "familiar_preference","latency_to_enter_either_corner","latency_to_enter_either_interaction","error_correction_speed")
  
zones<-c("familiar_alley", "familiar_interaction", "upper_familiar_corner", "lower_familiar_corner", "novel_alley", "novel_interaction", "upper_novel_corner", "lower_novel_corner")

  df<-df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)
  df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
  
clreg(df,zones, factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")
  

```
#postnor other
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postnordata, by = "fishID")
#df<-df %>% filter(KPstatus_day_15 == "sub")


#####are subs picking familiar/novel more than expected by chance second NOR?
a<-df %>% filter(first_choice == "familiar") %>%nrow
x<-df %>% filter(first_choice == "novel") %>%nrow
b<-(a + x) / 2
z<-(a + x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value #first different from random? NO
print("p value chip spa post picking familiar/novel more than expected by chance second NOR")
print(chip)
#φ = sqrt(x2/n)
print("effect size")
print(sqrt(0.92072/20))



####do ascenders pick familiar/novel more than chance?
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postnordata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub") 
df<- df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) 
a<-df %>% filter(first_choice == "familiar") %>%nrow
x<-df %>% filter(first_choice == "novel") %>%nrow
b<-(a+x) / 2
z<-(a+x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip nor2 ascenders vs random")
print(chip)


####do non ascenders pick familiar novel more than chance?
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postnordata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub") 
df<- df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) 
a<-df %>% filter(first_choice == "familiar") %>%nrow
x<-df %>% filter(first_choice == "novel") %>%nrow
b<-(a+x) / 2
z<-(a+x) / 2
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip nor2 nonascenders vs random")
print(chip)


######do ascenders and nonascenders pick differently?
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, postnordata, by = "fishID")
#df<- df %>% filter(KPstatus_day_15 == "sub") 
a<-df %>% filter(first_choice == "familiar")%>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>%nrow
x<-df %>% filter(first_choice == "novel")%>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>%nrow
b<-df %>% filter(first_choice == "familiar")%>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>%nrow
z<-df %>% filter(first_choice == "novel")%>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>%nrow
real = c(a,x)
expected = c(b,z)
temp<-data.frame(real, expected)
chi<-chisq.test(temp, correct=FALSE)
chip<-chi$p.value 
print("p value chip nor2 comparing ascenders and nonascenders")
print(chip)

#φ = sqrt(x2/n)
print("effect size")
print(sqrt(1.431/17))


#boxplot familiar_preference compared to 50% (across entire length of task)
t_test<-t.test(postnordata$familiar_preference, mu = 0.5)
p_value_t<-t_test$p.value
print("post NOR familiar preference compared to 50% t test, entire length of task")
print(p_value_t)


mean <- mean(postnordata$familiar_preference)
mu   <- 0.5
sd   <- sd(postnordata$familiar_preference)
diff <- mean - mu
cohen <- diff / sd
print("cohen")
print(cohen)
length(postnordata$familiar_preference)






######nor2 preference over time

file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2", pattern = "*.csv")

norfishlist<-kp %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
norfishlist<-as.list(strsplit(as.character(norfishlist$fishID),'_'))

  seg1_preference_familiar_corner_and_interaction<-vector(length = length(norfishlist))
  fullframe<-as.data.frame(vector(length = length(norfishlist)))
  fullframe$trial<-"nor2"
  
  nov_left_list<-c("round1", "round2", "round5", "round6")
  nov_right_list<-c("round3", "round4", "round7", "round8")
  
i<-1
k<-1
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  fullframe[k,1]<-fishid
  fullframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  fullframe$nov_interaction[k]<-seg1_prop_novel_interaction
  fullframe$fam_corners[k]<-seg1_prop_familiar_corners
  fullframe$nov_corners[k]<- seg1_prop_novel_corners
    colnames(fullframe)[1]<-"fishID"
  k<-k+1
}}

fullframe<-fullframe %>% filter(fishid != FALSE)
fullframe<-fullframe %>% mutate(familiar_preference = (fam_interaction + fam_corners)/ (fam_interaction + fam_corners + nov_interaction + nov_corners))
fullframe<-fullframe %>% mutate(fam_corner_and_int = fam_interaction + fam_corners)
fullframe<-left_join(kp, fullframe, by = "fishID")
fullframe$KPdid_fish_ascend_days_15_to_18<-as.factor(fullframe$KPdid_fish_ascend_days_15_to_18)

t_test<-t.test(fullframe$familiar_preference, mu = 0.5)
p_value_t<-t_test$p.value
print("nor2 familiar preference compared to 50% t test, first 60 seconds")
print(p_value_t)
mean <- mean(fullframe$familiar_preference, na.rm = TRUE)
mu   <- 0.5
sd   <- sd(fullframe$familiar_preference, na.rm = TRUE)
diff <- mean - mu
cohen <- diff / sd
print("cohen")
print(cohen)
length(na.omit(fullframe$familiar_preference))




wilcox_test<-t.test(fullframe$familiar_preference~ fullframe$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("nor2 familiar preference ascenders vs nonascenders, first 60 seconds")
print(p_value_wilcox)


ggplot(fullframe, aes(x = trial, y = familiar_preference, fill = KPdid_fish_ascend_days_15_to_18)) + geom_boxplot(fill = "white")  + theme_classic() + labs(x = "nor2", y = "familiar preference
everyone compared to 50% p (wilcox test) = 0.33
asc vs non p (wilcox test) p = 0.38") + theme(aspect.ratio = 3) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1)+ scale_fill_manual(values=c("maroon", "turquoise4")) 

wilcox_test<-wilcox.test(fullframe$fam_corner_and_int, mu = 0.5)
p_value_wilcox<-wilcox_test$p.value
print("nor2 fam_corner_and_int compared to 50% t test, first 60 seconds")
print(p_value_wilcox)
wilcox_test<-t.test(fullframe$fam_corner_and_int~ fullframe$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("nor2 fam_corner_and_int ascenders vs nonascenders, first 60 seconds")
print(p_value_wilcox)

ggplot(fullframe, aes(x = trial, y = fam_corner_and_int, fill = KPdid_fish_ascend_days_15_to_18)) + geom_boxplot(fill = "white")  + theme_classic() + labs(x = "nor2", y = "familiar corner and interaction %
everyone compared to 50% p (wilcox test) = 0.05
asc vs no p (wilcox test) p = 0.31") + theme(aspect.ratio = 3) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1)+ scale_fill_manual(values=c("maroon", "turquoise4")) 


tempframe<-fullframe %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)

print("in NOR2, ascenders only, is first minute familiar preference significantly lower than 50%")
wilcox_test<-wilcox.test(tempframe$familiar_preference, mu = 0.5)
p_value_wilcox<-wilcox_test$p.value
print(p_value_wilcox)





```


#SOCADATA
#socadata boxplots
```{r, echo = FALSE, message=FALSE, warning=FALSE}

#get basic info comparing subs to doms
socadata<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SOCA_master.csv")
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, socadata, by = "fishID")

listforboxplot<-c("SOCA1number_of_entries_habituation","SOCA1number_of_entries_opporutnity","SOCA1number_of_entires_challenge","SOCA1number_digging","SOCA1number_activity_female_barrier","SOCA1number_activity_at_resident_barrier","SOCA1number_activity_at_neural_barrier","SOCA1number_reproductive_display","SOCA1number_lateral_display","SOCA1number_border_conflict" ,"SOCA1number_aggressive_behavior_by_resident", "SOCA1aggression_index", "SOCA1prop_PVC", "SOCA1prop_female_barrier" ,"SOCA1prop_resident_barrier" ,"SOCA1prop_resident_wall"  ,"SOCA1prop_resident_corner" ,"SOCA1prop_camera_wall" ,"SOCA1prop_female_corner" ,"SOCA1prop_female_wall" ,"SOCA1prop_female_space" ,"SOCA1prop_resident_space" ,"SOCA1number_digging_opportunity" ,"SOCA1number_activity_female_barrier_opportunity" ,"SOCA1number_activity_at_resident_barrier_opportunity", "SOCA1number_activity_at_neural_barrier_opportunity" ,"SOCA1number_reproductive_display_opportunity" ,"SOCA1number_lateral_display_opportunity", "SOCA1number_border_conflict_opportunity" ,"SOCA1prop_PVC_opportunity" ,"SOCA1prop_female_barrier_opportunity" ,"SOCA1prop_resident_barrier_opportunity" ,"SOCA1prop_resident_wall_opportunity" ,"SOCA1prop_resident_corner_opportunity" ,"SOCA1prop_camera_wall_opportunity" ,"SOCA1prop_female_corner_opportunity" ,"SOCA1prop_female_wall_opportunity" ,"SOCA1prop_female_space_opportunity" ,"SOCA1prop_resident_space_opportunity"  ,"SOCA1number_digging_challenge" ,"SOCA1number_activity_female_barrier_challenge" ,"SOCA1number_activity_at_resident_barrier_challenge" ,"SOCA1number_activity_at_neural_barrier_challenge" ,"SOCA1number_reproductive_display_challenge" ,"SOCA1number_lateral_display_challenge" ,"SOCA1number_border_conflict_challenge" ,"SOCA1prop_PVC_challenge" ,"SOCA1prop_female_barrier_challenge" ,"SOCA1prop_resident_barrier_challenge" ,"SOCA1prop_resident_wall_challenge" ,"SOCA1prop_resident_corner_challenge"  ,"SOCA1prop_camera_wall_challenge" ,"SOCA1prop_female_corner_challenge" ,"SOCA1prop_female_wall_challenge"  ,"SOCA1prop_female_space_challenge" ,"SOCA1prop_resident_space_challenge","SOCA1prop_sum_resident" ,"SOCA1prop_sum_female","SOCA1prop_sum_corner" ,"SOCA1prop_sum_resident_opportunity"  ,"SOCA1prop_sum_female_opportunity","SOCA1prop_sum_corner_opportunity","SOCA1prop_sum_resident_challenge" ,"SOCA1prop_sum_female_challenge" ,"SOCA1prop_sum_corner_challenge","SOCA1change_in_activity_at_female_barrier_opportunity_to_challenge","SOCA1change_in_reproductive_display_opportunity_to_challenge" ,"SOCA1change_in_lateral_display_opportunity_to_challenge" ,"SOCA1change_in_prop_sum_female_opportunity_to_challenge"  ,"SOCA1change_in_prop_sum_resident_opportunity_to_challenge")         

  
df<-df %>% select(KPstatus_day_15, listforboxplot)
#for now excluding ints
#df<- df %>% filter(KPstatus_day_15 == "dom" | KPstatus_day_15 == "sub")
df$KPstatus_day_15<-as.factor(df$KPstatus_day_15)
clboxplot(df,factor = TRUE, factorname = "KPstatus_day_15")




#now for soca2 compare ascenders and nonascenders
socadata<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SOCA_master.csv")
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
df<-left_join(kp, socadata, by = "fishID")

listforboxplot<-c("SOCA2number_of_entries_habituation","SOCA2number_of_entries_opporutnity","SOCA2number_of_entires_challenge","SOCA2number_digging","SOCA2number_activity_female_barrier","SOCA2number_activity_at_resident_barrier","SOCA2number_activity_at_neural_barrier","SOCA2number_reproductive_display","SOCA2number_lateral_display","SOCA2number_border_conflict" ,"SOCA2number_aggressive_behavior_by_resident", "SOCA2aggression_index", "SOCA2prop_PVC", "SOCA2prop_female_barrier" ,"SOCA2prop_resident_barrier" ,"SOCA2prop_resident_wall"  ,"SOCA2prop_resident_corner" ,"SOCA2prop_camera_wall" ,"SOCA2prop_female_corner" ,"SOCA2prop_female_wall" ,"SOCA2prop_female_space" ,"SOCA2prop_resident_space" ,"SOCA2number_digging_opportunity" ,"SOCA2number_activity_female_barrier_opportunity" ,"SOCA2number_activity_at_resident_barrier_opportunity", "SOCA2number_activity_at_neural_barrier_opportunity" ,"SOCA2number_reproductive_display_opportunity" ,"SOCA2number_lateral_display_opportunity", "SOCA2number_border_conflict_opportunity" ,"SOCA2prop_PVC_opportunity" ,"SOCA2prop_female_barrier_opportunity" ,"SOCA2prop_resident_barrier_opportunity" ,"SOCA2prop_resident_wall_opportunity" ,"SOCA2prop_resident_corner_opportunity" ,"SOCA2prop_camera_wall_opportunity" ,"SOCA2prop_female_corner_opportunity" ,"SOCA2prop_female_wall_opportunity" ,"SOCA2prop_female_space_opportunity" ,"SOCA2prop_resident_space_opportunity"  ,"SOCA2number_digging_challenge" ,"SOCA2number_activity_female_barrier_challenge" ,"SOCA2number_activity_at_resident_barrier_challenge" ,"SOCA2number_activity_at_neural_barrier_challenge" ,"SOCA2number_reproductive_display_challenge" ,"SOCA2number_lateral_display_challenge" ,"SOCA2number_border_conflict_challenge" ,"SOCA2prop_PVC_challenge" ,"SOCA2prop_female_barrier_challenge" ,"SOCA2prop_resident_barrier_challenge" ,"SOCA2prop_resident_wall_challenge" ,"SOCA2prop_resident_corner_challenge"  ,"SOCA2prop_camera_wall_challenge" ,"SOCA2prop_female_corner_challenge" ,"SOCA2prop_female_wall_challenge"  ,"SOCA2prop_female_space_challenge" ,"SOCA2prop_resident_space_challenge","SOCA2prop_sum_resident" ,"SOCA2prop_sum_female","SOCA2prop_sum_corner" ,"SOCA2prop_sum_resident_opportunity"  ,"SOCA2prop_sum_female_opportunity","SOCA2prop_sum_corner_opportunity","SOCA2prop_sum_resident_challenge" ,"SOCA2prop_sum_female_challenge" ,"SOCA2prop_sum_corner_challenge","SOCA2change_in_activity_at_female_barrier_opportunity_to_challenge","SOCA2change_in_reproductive_display_opportunity_to_challenge" ,"SOCA2change_in_lateral_display_opportunity_to_challenge" ,"SOCA2change_in_prop_sum_female_opportunity_to_challenge"  ,"SOCA2change_in_prop_sum_resident_opportunity_to_challenge","SOCA1to2change_number_of_entries_opporutnity", "SOCA1to2change_number_of_entires_challenge","SOCA1to2change_number_digging","SOCA1to2change_number_activity_female_barrier","SOCA1to2change_number_activity_at_resident_barrier", "SOCA1to2change_number_reproductive_display","SOCA1to2change_number_lateral_display","SOCA1to2change_number_border_conflict",     "SOCA1to2change_aggression_index","SOCA1to2change_prop_PVC","SOCA1to2change_prop_female_barrier" ,"SOCA1to2change_prop_resident_barrier","SOCA1to2change_number_activity_female_barrier_opportunity" ,"SOCA1to2change_number_reproductive_display_opportunity",   "SOCA1to2change_number_activity_at_resident_barrier_challenge", "SOCA1to2change_number_reproductive_display_challenge", "SOCA1to2change_number_border_conflict_challenge" ,"SOCA1to2change_prop_PVC_challenge","SOCA1to2change_prop_female_barrier_challenge", "SOCA1to2change_prop_sum_resident", "SOCA1to2change_prop_sum_female","SOCA1to2change_prop_sum_corner", "SOCA1to2change_prop_sum_female_opportunity"  , "SOCA1to2change_prop_sum_resident_challenge","SOCA1to2change_prop_sum_female_challenge" , "SOCA1to2change_prop_sum_corner_challenge")  


df<-df %>% select(KPdid_fish_ascend_days_15_to_18, listforboxplot)
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
#for now excluding ints

clboxplot(df,factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")

```
#socadata opportunity to challenge changes
```{r, echo = FALSE, message=FALSE, warning=FALSE}

#######SOCA1 and SOCA2 opporutnity to challenge changes (SPACE)



###### time at female space opportunity to challenge (subs only), not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA1prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA1prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("soca1 female space by phase")
print(p_value_wilcox)
p<- ggplot(data=socatemp, aes(x=phase, y=female_space, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  annotate("text", x=0, y=0, label= glue::glue("p (phase diff overall, wilcox) =
{round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+ theme_classic()+ scale_color_manual(values=c("maroon", "turquoise4")) + ggtitle("SOCA1 female space pre to post")
  plot(p)



#female space ascenders only not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA1prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA1prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 1)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("soca1 female space by phase ascenders only")
print(p_value_wilcox)


  
#female space nonascenders only not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA1prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA1prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 0)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("soca1 female space by phase nonascenders only")
print(p_value_wilcox)


###### time at resident space opportunity to challenge (subs only), not significant
#resident space ascenders only not significant
#resident space nonascenders only not significant


#repeat for SOCA2

###### time at female space opportunity to challenge (subs only), not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)

wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("soca2 female space by phase")
print(p_value_wilcox)

#soca2 female space ascenders only SIG
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 1)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 female space by phase ascenders only")
print(p_value_wilcox)

p<- ggplot(data=socatemp, aes(x=phase, y=female_space, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  scale_color_manual(values=c("turquoise4")) +
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("SOCA2 female space pre to post, ascenders only")
  plot(p)


  
#soca2 female space nonascenders only not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 0)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 female space by phase nonascenders only")
print(p_value_wilcox)

p<- ggplot(data=socatemp, aes(x=phase, y=female_space, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  scale_color_manual(values=c("maroon")) +
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("SOCA2 female space pre to post, NONascenders only")
  plot(p)
  
  
########################female space putting ascenders with boxplot overlaid
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 1)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 female space by phase ascenders only")
print(p_value_wilcox)

socatemp$phase<- as.factor(socatemp$phase)
p<- ggplot(data=socatemp, aes(x=phase, y=female_space)) + geom_boxplot()+
 geom_line(aes(group = fishID), colour = "gray83", size = 1) +
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  scale_color_manual(values=c("turquoise4")) +
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+ 
  ggtitle("SOCA2 female space opp to chall, ascenders only")
  plot(p)
  

socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 0)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 female space by phase ascenders only")
print(p_value_wilcox)

socatemp$phase<- as.factor(socatemp$phase)
p<- ggplot(data=socatemp, aes(x=phase, y=female_space)) + geom_boxplot()+
 geom_line(aes(group = fishID), colour = "gray83", size = 1) +
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  scale_color_manual(values=c("maroon")) +
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+ 
  ggtitle("SOCA2 female space opp to chall, nonascenders only")
  plot(p)
  


###### time at resident space opportunity to challenge (subs only), not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_resident_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "resident_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_resident_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "resident_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
wilcox_test<-wilcox.test(socatemp$resident_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("soca2 resident space by phase")
print(p_value_wilcox)

#soca2 resident space ascenders only not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_resident_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "resident_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_resident_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "resident_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 1)
wilcox_test<-wilcox.test(socatemp$resident_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 resident space by phase ascenders only")
print(p_value_wilcox)
  
# soca2 resident space nonascenders only not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_resident_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "resident_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_resident_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "resident_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 0)
wilcox_test<-wilcox.test(socatemp$resident_space~socatemp$phase)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 resident space by phase nonascenders only")
print(p_value_wilcox)




#SOCA2 boxplot of change in female space opportunity to challenge, ascending vs nonascending
socatemp<-socadata
socatemp<-socatemp %>% mutate (SOCA2change_in_prop_female_space_opportunity_to_challenge = SOCA2prop_female_space_challenge - SOCA2prop_female_space_opportunity)
socatemp<-full_join(socatemp, kp, by = "fishID")
socatemp<-socatemp %>% select(KPdid_fish_ascend_days_15_to_18, SOCA2change_in_prop_female_space_opportunity_to_challenge)
socatemp$KPdid_fish_ascend_days_15_to_18<-as.factor(socatemp$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(socatemp$SOCA2change_in_prop_female_space_opportunity_to_challenge~socatemp$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2change_in_prop_female_space_opportunity_to_challenge by did fish ascend")
print(p_value_wilcox)
p <- ggplot(socatemp, aes(KPdid_fish_ascend_days_15_to_18, SOCA2change_in_prop_female_space_opportunity_to_challenge)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "SOCA2change_in_prop_female_space_opportunity_to_challenge") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=0.1, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)



```




#HORMONES
#hormones boxplot
```{r, echo = FALSE, message=FALSE, warning=FALSE}

horm<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/hormone_data_master_december_2019.csv")
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
zones<-c("back_wall", "neutral_zone","rewarded_corner", "rewarded_platform", "rewarded_wall", "unrewarded_corner", "unrewarded_platform", "unrewarded_wall")

#PRE boxplot hormones by did fish ascend
df<-full_join(kp, weight, by = "fishID")
temphorm<-horm %>% filter(pre_or_post == "pre")
df<-full_join(df, temphorm, by = "fishID")
df<-df %>% mutate(CORT_by_weight = CORT/weight_start)
df<-df %>% mutate(T_by_weight = T/weight_start)
df<- df %>% select("KPdid_fish_ascend_days_15_to_18", "CORT_by_weight", "T_by_weight")
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)

wilcox_test<-wilcox.test(df$CORT_by_weight~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("CORT by weight")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, CORT_by_weight)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "pre cort by weight") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=1000, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(0,1000)
plot(p)

wilcox_test<-wilcox.test(df$T_by_weight~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("T by weight")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, T_by_weight)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "pre T by weight") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=500, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(0,500)
plot(p)

cohen<-cohen.d(df$T_by_weight~df$KPdid_fish_ascend_days_15_to_18)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)


#POST boxplot hormones by did fish ascend
df<-full_join(kp, weight, by = "fishID")
temphorm<-horm %>% filter(pre_or_post == "post")
df<-full_join(df, temphorm, by = "fishID")
df<-df %>% mutate(CORT_by_weight = CORT/weight_start)
df<-df %>% mutate(T_by_weight = T/weight_start)
df<- df %>% select("KPdid_fish_ascend_days_15_to_18", "CORT_by_weight", "T_by_weight")
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)


wilcox_test<-wilcox.test(df$CORT_by_weight~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("CORT by weight")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, CORT_by_weight)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "post cort by weight") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=1000, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(0,1000)
plot(p)

  cohen<-cohen.d(df$CORT_by_weight~df$KPdid_fish_ascend_days_15_to_18)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>% nrow()
numberA
numberB<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>% nrow()
numberB


wilcox_test<-wilcox.test(df$T_by_weight~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("T by weight")
print(p_value_wilcox)
print(wilcox_test)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, T_by_weight)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "post T by weight") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=500, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(0,500)
plot(p)

cohen<-cohen.d(df$T_by_weight~df$KPdid_fish_ascend_days_15_to_18)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 1) %>% nrow()
numberA
numberB<-df %>% filter(KPdid_fish_ascend_days_15_to_18 == 0) %>% nrow()
numberB






```
#correlating CORT to behavioral measures
```{r, echo = FALSE, message=FALSE, warning=FALSE}


##########combine prespadata and CORT
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "pre")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, prespadata, by = "fishID")
fullist<-c(spavariableslist, "CORT_by_weight", "T_by_weight", "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(spavariableslist)) {
				measure1 <- "CORT_by_weight"
				measure2 <- spavariableslist[j]
				temp <- df %>% select("CORT_by_weight", spavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("prespa, preCORT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("prespa")
							plot(p)}}}}

#########combine postspadata and CORT
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "post")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, postspadata, by = "fishID")
fullist<-c(spavariableslist, "CORT_by_weight", "T_by_weight", "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(spavariableslist)) {
				measure1 <- "CORT_by_weight"
				measure2 <- spavariableslist[j]
				temp <- df %>% select("CORT_by_weight", spavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("postspa, postCORT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("postspa")
							plot(p)}}}}

##########combine prenordata and CORT
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "pre")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, prenordata, by = "fishID")
fullist<-c(norvariableslist, "CORT_by_weight", "T_by_weight", "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(norvariableslist)) {
				measure1 <- "CORT_by_weight"
				measure2 <- norvariableslist[j]
				temp <- df %>% select("CORT_by_weight", norvariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("prenor, preCORT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("prenor")
							plot(p)}}}}

#########combine postnordata and CORT
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "post")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, postnordata, by = "fishID")
fullist<-c(norvariableslist, "CORT_by_weight", "T_by_weight", "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(norvariableslist)) {
				measure1 <- "CORT_by_weight"
				measure2 <- norvariableslist[j]
				temp <- df %>% select("CORT_by_weight", norvariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("postnor, postCORT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("postnor")
							plot(p)}}}}


#######combined presocadata and CORT
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "pre")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, socadata, by = "fishID")
presocavariableslist<- paste0("SOCA1", socavariableslist)
fullist<-c(presocavariableslist, "CORT_by_weight", "T_by_weight", "KPdid_fish_ascend_days_15_to_18")

df<-df %>% select(fullist)
j<-1
			for (j in 1:length(presocavariableslist)) {
				measure1 <- "CORT_by_weight"
				measure2 <- presocavariableslist[j]
				temp <- df %>% select("CORT_by_weight", presocavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("soca, preCORT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("soca1")
							plot(p)}}}}

#######combined postsocadata and CORT
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "post")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, socadata, by = "fishID")
postsocavariableslist<- paste0("SOCA2", socavariableslist)
fullist<-c(postsocavariableslist, "CORT_by_weight", "T_by_weight", "KPdid_fish_ascend_days_15_to_18")

df<-df %>% select(fullist)
j<-1
			for (j in 1:length(postsocavariableslist)) {
				measure1 <- "CORT_by_weight"
				measure2 <- postsocavariableslist[j]
				temp <- df %>% select("CORT_by_weight", postsocavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("soca, postCORT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("soca2")
							plot(p)}}}}




```
#correlating T to behavioral measures
```{r, echo = FALSE, message=FALSE, warning=FALSE}


##########combine prespadata and T
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "pre")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, prespadata, by = "fishID")
fullist<-c(spavariableslist, "T_by_weight", "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(spavariableslist)) {
				measure1 <- "T_by_weight"
				measure2 <- spavariableslist[j]
				temp <- df %>% select("T_by_weight", spavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("prespa, preT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("prespa")
							plot(p)}}}}

#########combine postspadata and T
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "post")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, postspadata, by = "fishID")
fullist<-c(spavariableslist, "T_by_weight","KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(spavariableslist)) {
				measure1 <- "T_by_weight"
				measure2 <- spavariableslist[j]
				temp <- df %>% select("T_by_weight", spavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("postspa, postT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("postspa")
							plot(p)}}}}

##########combine prenordata and T
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "pre")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, prenordata, by = "fishID")
fullist<-c(norvariableslist, "T_by_weight", "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(norvariableslist)) {
				measure1 <- "T_by_weight"
				measure2 <- norvariableslist[j]
				temp <- df %>% select("T_by_weight", norvariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("prenor, preT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("prenor")
							plot(p)}}}}

#########combine postnordata and T
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "post")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, postnordata, by = "fishID")
fullist<-c(norvariableslist, "T_by_weight",  "KPdid_fish_ascend_days_15_to_18")
df<-df %>% select(fullist)
j<-1
			for (j in 1:length(norvariableslist)) {
				measure1 <- "T_by_weight"
				measure2 <- norvariableslist[j]
				temp <- df %>% select("T_by_weight", norvariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("postnor, postT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("postnor")
							plot(p)}}}}


#######combined presocadata and T
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "pre")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, socadata, by = "fishID")
presocavariableslist<- paste0("SOCA1", socavariableslist)
fullist<-c(presocavariableslist, "T_by_weight", "KPdid_fish_ascend_days_15_to_18")

df<-df %>% select(fullist)
j<-1
			for (j in 1:length(presocavariableslist)) {
				measure1 <- "T_by_weight"
				measure2 <- presocavariableslist[j]
				temp <- df %>% select("T_by_weight", presocavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("soca, preT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("soca1")
							plot(p)}}}}

#######combined postsocadata and T
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post == "post")
df<-full_join(temphorm, kp, by = "fishID")
df<-full_join(df, socadata, by = "fishID")
postsocavariableslist<- paste0("SOCA2", socavariableslist)
fullist<-c(postsocavariableslist, "T_by_weight", "KPdid_fish_ascend_days_15_to_18")

df<-df %>% select(fullist)
j<-1
			for (j in 1:length(postsocavariableslist)) {
				measure1 <- "T_by_weight"
				measure2 <- postsocavariableslist[j]
				temp <- df %>% select("T_by_weight", postsocavariableslist[j])
				if (ncol(temp) > 1) {
					if (nrow(na.omit(temp)) > 0) {
						colnames(temp) <- c("measure1", "measure2")
						temp$measure1 <- as.character(temp$measure1)
						temp <- temp[temp$measure1 != "Inf", ]
						temp$measure1 <- as.numeric(as.character(temp$measure1))
						temp$measure2 <- as.character(temp$measure2)
						temp <- temp[temp$measure2 != "Inf", ]
						temp$measure2 <- as.numeric(as.character(temp$measure2))
						mod <- lm(temp$measure2 ~ temp$measure1)
						p_value <- summary(mod)$coefficients[8]
						print(paste("soca, postT_by_weight", measure1, measure2, "p value = ", 
							round(p_value, 4)))
						if (is.na(p_value) == TRUE) {
							p_value <- 100
						}
						if (p_value > 0 & p_value < 0.05) {
							p <- ggplot(temp, aes(measure1, measure2)) + 
								geom_point(size = 4) + geom_smooth(method = "lm", 
								se = FALSE, colour = "black") + theme(text = element_text(size = 10)) + 
								labs(x = measure1, y = measure2) + theme_classic() + 
								annotate(geom = "text", label = paste("p value = ", 
									round(p_value, 4)), x = -Inf, y = Inf, 
									hjust = 0, vjust = 1)+
							  ggtitle("soca2")
							plot(p)}}}}




```




#WEIGHT
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#what latent varialbes (e.g. size, condition, differ between ascenders and non-ascenders (pre))

df<-full_join(kp, weight, by = "fishID")
df<- df %>% select("KPdid_fish_ascend_days_15_to_18", "weight_start", "SL_start", "weight_end", "SL_end", "gonad_weight_end", "GSI_end_x1000", "change_weight")
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)

clboxplot(df, factor = TRUE, factorname = "KPdid_fish_ascend_days_15_to_18")



t_test<-t.test(df$SL_start~df$KPdid_fish_ascend_days_15_to_18)
 p_value_t<-t_test$p.value
p<- ggplot(df, aes(x=df$KPdid_fish_ascend_days_15_to_18, y=df$SL_start)) +
   geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
   theme_classic()+
   labs(x= "did fish ascend 15 to 18" ,y="SL start") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x =  element_text(size = 14)) +
   stat_n_text(size = 5) +
  ggtitle("by hand p (t-test) = 0.076")
plot(p)

  cohen<-cohen.d(df$SL_start~df$KPdid_fish_ascend_days_15_to_18)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)


```




#ACROSS ASSAYS -be careful to run the PCA's immediately after the first section (where you get the dataframes/lists) or else they look different!
#pre to post changes
```{r, echo = FALSE, message=FALSE, warning=FALSE}
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")

socadata<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SOCA_master.csv")



##############HORMONES


###CORT all
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp<-hormtemp %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
hormtemp<-hormtemp %>% filter(fishID  != "round2malegreen") #removing one value that doesn't have a match pre/post
wilcox_test<-wilcox.test(hormtemp$CORT_by_weight~hormtemp$pre_or_post, paired = TRUE)
p_value_wilcox<-wilcox_test$p.value
print("CORT_by_weight")
print(p_value_wilcox)
p<- ggplot(data=hormtemp, aes(x=pre_or_post, y=CORT_by_weight, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=hormtemp$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("maroon", "turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("CORT_by_weight all")+
  ylim(0, 1000)
  plot(p)
  
  cohen<-cohen.d(hormtemp$CORT_by_weight~hormtemp$pre_or_post)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberpre<-hormtemp %>% filter(pre_or_post == "pre") %>% nrow()
numberpre
numberpost<-hormtemp %>% filter(pre_or_post == "post") %>% nrow()
numberpost

  
  
  
  ###CORT ascenders only
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
hormtemp<-hormtemp %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
wilcox_test<-wilcox.test(hormtemp$CORT_by_weight~hormtemp$pre_or_post, paired = TRUE)
p_value_wilcox<-wilcox_test$p.value
print("CORT_by_weight")
print(p_value_wilcox)
p<- ggplot(data=hormtemp, aes(x=pre_or_post, y=CORT_by_weight, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=hormtemp$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("CORT_by_weight ascenders only")+
  ylim(0, 1000)
  plot(p)
  
    cohen<-cohen.d(hormtemp$CORT_by_weight~hormtemp$pre_or_post)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberpre<-hormtemp %>% filter(pre_or_post == "pre") %>% nrow()
numberpre
numberpost<-hormtemp %>% filter(pre_or_post == "post") %>% nrow()
numberpost

  
  
    ###CORT nonascenders only
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
hormtemp<-hormtemp %>% filter(KPdid_fish_ascend_days_15_to_18 == 0)
wilcox_test<-wilcox.test(hormtemp$CORT_by_weight~hormtemp$pre_or_post)
p_value_wilcox<-wilcox_test$p.value
print("CORT_by_weight nonascenders only")
print(p_value_wilcox)

  
  
###T all  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
wilcox_test<-wilcox.test(hormtemp$T_by_weight~hormtemp$pre_or_post)
p_value_wilcox<-wilcox_test$p.value
print("T_by_weight all")
print(p_value_wilcox)

  
  ###T ascenders only  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
hormtemp<-hormtemp %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
wilcox_test<-wilcox.test(hormtemp$T_by_weight~hormtemp$pre_or_post)
p_value_wilcox<-wilcox_test$p.value
print("T_by_weight")
print(p_value_wilcox)
p<- ggplot(data=hormtemp, aes(x=pre_or_post, y=T_by_weight, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=hormtemp$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("T_by_weight ascenders only")+
  ylim(0, 500)
  plot(p)

  
###T nonascenders only  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
hormtemp<-hormtemp %>% filter(KPdid_fish_ascend_days_15_to_18 == 0)
wilcox_test<-wilcox.test(hormtemp$T_by_weight~hormtemp$pre_or_post)
p_value_wilcox<-wilcox_test$p.value
print("T_by_weight nonascenders only")
print(p_value_wilcox)


  
  
##############SOCA
socavariableslist<-c("number_of_entries_opporutnity","number_of_entires_challenge","number_digging", "number_activity_female_barrier", "number_activity_at_resident_barrier" , "number_activity_at_neural_barrier", "number_reproductive_display" ,"number_lateral_display","number_border_conflict" ,"number_aggressive_behavior_by_resident", "aggression_index","prop_PVC","prop_female_barrier", "prop_resident_barrier","prop_resident_wall","prop_resident_corner","prop_camera_wall",  "prop_female_corner","prop_female_wall", "prop_female_space","prop_resident_space", "number_digging_opportunity","number_activity_female_barrier_opportunity", "number_activity_at_resident_barrier_opportunity","number_activity_at_neural_barrier_opportunity", "number_reproductive_display_opportunity", "number_lateral_display_opportunity", "number_border_conflict_opportunity","prop_PVC_opportunity" , "prop_female_barrier_opportunity", "prop_resident_barrier_opportunity","prop_resident_wall_opportunity", "prop_resident_corner_opportunity" ,"prop_camera_wall_opportunity", "prop_female_corner_opportunity" ,  "prop_female_wall_opportunity", "prop_female_space_opportunity", "prop_resident_space_opportunity", "number_digging_challenge" ,"number_activity_female_barrier_challenge", "number_activity_at_resident_barrier_challenge", "number_activity_at_neural_barrier_challenge", "number_reproductive_display_challenge", "number_lateral_display_challenge", "number_border_conflict_challenge" , "prop_PVC_challenge", "prop_female_barrier_challenge"  ,   "prop_resident_barrier_challenge", "prop_resident_wall_challenge", "prop_resident_corner_challenge", "prop_camera_wall_challenge", "prop_female_corner_challenge", "prop_female_wall_challenge", "prop_female_space_challenge", "prop_resident_space_challenge" , "prop_sum_resident", "prop_sum_female", "prop_sum_corner", "prop_sum_resident_opportunity" , "prop_sum_female_opportunity", "prop_sum_corner_opportunity", "prop_sum_resident_challenge", "prop_sum_female_challenge", "prop_sum_corner_challenge", "change_in_activity_at_female_barrier_opportunity_to_challenge", "change_in_reproductive_display_opportunity_to_challenge", "change_in_lateral_display_opportunity_to_challenge",  "change_in_prop_sum_female_opportunity_to_challenge", "change_in_prop_sum_resident_opportunity_to_challenge")

i<-1
for(i in 1:length(socavariableslist)){
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)

pretemp<-socadata %>% select(fishID, paste("SOCA1", socavariableslist[i], sep = ""))
colnames(pretemp)<-c("fishID", "behav")
pretemp$phase<-"aPRE"
pretemp<-full_join(pretemp, statustemp)

posttemp<-socadata %>% select(fishID, paste("SOCA2", socavariableslist[i], sep = ""))
colnames(posttemp)<-c("fishID", "behav")
posttemp$phase<-"POST"
posttemp<-full_join(posttemp, statustemp)

consistency<-rbind(pretemp, posttemp)
consistency$KPdid_fish_ascend_days_15_to_18<-as.factor(consistency$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(consistency$behav~consistency$phase)
p_value_wilcox<-wilcox_test$p.value
print(socavariableslist[i])
print(p_value_wilcox)

if(is.na(p_value_wilcox )== FALSE){
 if(p_value_wilcox < 0.05){
p<- ggplot(data=consistency, aes(x=phase, y=behav, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=consistency$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("maroon", "turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle(paste("SOCA", socavariableslist[i], sep = " "))
  plot(p) }}}





##############SPA
spavariableslist<-colnames(prespadata)
drops<-c("file_name", "neutral_zone_seconds", "back_wall_seconds", "unrewarded_wall_seconds", "rewarded_corner_seconds","rewarded_platform_seconds", "rewarded_wall_seconds", "unrewarded_corner_seconds", "unrewarded_platform_seconds", "vid_length", "fishID", "sex", "first_choice", "error_correction_speed", "barrier_first_entry_time")
#removing error correctino speed because only a couple individuals have it
spavariableslist<-spavariableslist[(spavariableslist %in% drops)== FALSE]


i<-1
for(i in 1:length(spavariableslist)){
  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)

pretemp<-prespadata %>% select(fishID, spavariableslist[i])
colnames(pretemp)<-c("fishID", "behav")
pretemp$phase<-"aPRE"
pretemp<-full_join(pretemp, statustemp)

posttemp<-postspadata %>% select(fishID, spavariableslist[i])
colnames(posttemp)<-c("fishID", "behav")
posttemp$phase<-"POST"
posttemp<-full_join(posttemp, statustemp)

consistency<-rbind(pretemp, posttemp)
consistency$KPdid_fish_ascend_days_15_to_18<-as.factor(consistency$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(consistency$behav~consistency$phase)
p_value_wilcox<-wilcox_test$p.value
print(spavariableslist[i])
print(p_value_wilcox)

 if(p_value_wilcox < 0.05){
p<- ggplot(data=consistency, aes(x=phase, y=behav, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=consistency$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("maroon", "turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle(paste("SPA", spavariableslist[i], sep = " "))
  plot(p) }}




###################NOR preference in the first minute

file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1", pattern = "*.csv")
norfishlist<-kp %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
norfishlist<-as.list(strsplit(as.character(norfishlist$fishID),'_'))
  fullframe<-as.data.frame(vector(length = length(norfishlist)*2))
  fullframe$phase<-NA
  nov_left_list<-c("round1", "round2", "round5", "round6")
  nov_right_list<-c("round3", "round4", "round7", "round8")
  
i<-1
k<-1
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  fullframe[k,1]<-fishid
  fullframe$phase[k]<-"nor1"
  fullframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  fullframe$nov_interaction[k]<-seg1_prop_novel_interaction
  fullframe$fam_corners[k]<-seg1_prop_familiar_corners
  fullframe$nov_corners[k]<- seg1_prop_novel_corners
  fullframe$familiar_preference[k]<-seg1_preference_familiar_corner_and_interaction
  fullframe$fam_corner_and_int[k]<-seg1_prop_familiar_corners + seg1_prop_familiar_interaction
    colnames(fullframe)[1]<-"fishID"
  k<-k+1
  }}


file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2", pattern = "*.csv")
i<-1
k<-1+ length(norfishlist)
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  fullframe[k,1]<-fishid
  fullframe$phase[k]<-"nor2"
  fullframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  fullframe$nov_interaction[k]<-seg1_prop_novel_interaction
  fullframe$fam_corners[k]<-seg1_prop_familiar_corners
  fullframe$nov_corners[k]<- seg1_prop_novel_corners
  fullframe$familiar_preference[k]<-seg1_preference_familiar_corner_and_interaction
  fullframe$fam_corner_and_int[k]<-seg1_prop_familiar_corners + seg1_prop_familiar_interaction
    colnames(fullframe)[1]<-"fishID"
  k<-k+1
  }}


fullframe<-full_join(fullframe, kp, by = "fishID")
fullframe$KPdid_fish_ascend_days_15_to_18<-as.factor(fullframe$KPdid_fish_ascend_days_15_to_18)

  #do ASCENDING males switch their preferences before and after perturbation
  tempframe<-fullframe %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
  
 wilcox_test<-wilcox.test(tempframe$familiar_preference~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
p<- ggplot(tempframe, aes(x=tempframe$phase, y=tempframe$familiar_preference)) +
   geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
   theme_classic()+
   labs(x= "ascending males NOR1 to NOR2" ,y="familiar_preference") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x =  element_text(size = 14)) + stat_n_text(size = 5) +
  ggtitle("by hand p (wilcox) = 0.030")
plot(p)

p<- ggplot(data=tempframe, aes(x=phase, y=familiar_preference, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=tempframe$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("nor pre to post familiar preference first minute ascenders only")
  plot(p) 
  
  


 wilcox_test<-wilcox.test(tempframe$fam_corner_and_int~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
 wilcox_test<-wilcox.test(tempframe$fam_corner_and_int~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
p<- ggplot(tempframe, aes(x=tempframe$phase, y=tempframe$fam_corner_and_int)) +
   geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
   theme_classic()+
   labs(x= "ascending males NOR1 to NOR2" ,y="fam_corner_and_int") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x =  element_text(size = 14)) +
   stat_n_text(size = 5) +
  ggtitle("by hand p (wilcox) = 0.007")
plot(p)


p<- ggplot(data=tempframe, aes(x=phase, y=fam_corner_and_int, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=tempframe$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("nor pre to post familiar % (corner + int) first minute ascenders only")
  plot(p) 


#do NONASCENDING males switch their preferences before and after perturbation? no
  tempframe<-fullframe %>% filter(KPdid_fish_ascend_days_15_to_18 == 0)
  
 wilcox_test<-wilcox.test(tempframe$familiar_preference~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
print("do nonasending males change their preference pre to post? no. p = ")
print(p_value_wilcox)


 wilcox_test<-wilcox.test(tempframe$fam_corner_and_int~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
print("do nonasending males change their familiar% pre to post? no. p = ")
print(p_value_wilcox)


```
#all assays PCA PRE
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#includes presoca, prenor, presoca, hormones (NOT GSI)
#filtering by if fish was present in post as well
#for fish with missing data, their value is replaced with the mean of the remaining data (imputing)

presocavariableslistshort<- c("SOCA1prop_female_space_opportunity", "SOCA1prop_female_space_challenge", "SOCA1prop_resident_space_opportunity", "SOCA1prop_resident_space_challenge")

temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

temphorm<-temphorm %>% filter(pre_or_post== "pre")

templist<- c(spavariableslist, norvariableslist, presocavariableslistshort, "CORT_by_weight", "T_by_weight")

tempPCAlist<-c(templist) 
 factor<-c("fishID")
 fulltempPCAlist<-append(tempPCAlist, factor)
 
 allassaydata<-left_join(prespadata, prenordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 temp.allassaydata<-allassaydata[, which(names(allassaydata) %in% fulltempPCAlist)]
 temp.allassaydatanoid<-temp.allassaydata[, -which(names(temp.allassaydata) %in% factor)]
 temp.allassaydatanoid<-temp.allassaydatanoid[, -which(names(temp.allassaydatanoid) == "latency_to_enter_either_platform")] #removing for infinity reasons
 i<-1
 for(i in 1:ncol(temp.allassaydatanoid)){
   colmean<-mean(temp.allassaydatanoid[,i], na.rm = TRUE)
  j<-1
   for(j in 1:nrow(temp.allassaydatanoid)){  
     if(is.na(temp.allassaydatanoid[j,i])== TRUE){
       temp.allassaydatanoid[j,i]<-colmean}}}

 pca <- prcomp(temp.allassaydatanoid, center = TRUE,scale = TRUE)
 summary(pca)
 allassaypca<-as.data.frame(pca$x)
 allassaypca$fishID<-temp.allassaydata$fishID
 allassaypca$sex<-temp.allassaydata$sex
 pca.loadings <- pca$rotation
pca.loadings<-as.data.frame(pca.loadings)


pca.loadings$name<-as.vector(rownames(pca.loadings))
roworder<-c("familiar_alley_entries", "SOCA1prop_female_space_challenge", "rewarded_corner_prop", "rewarded_corner_entries", "neutral_zone_prop", "CORT_by_weight", "reward_preference", "SOCA1prop_resident_space_opportunity", "SOCA1prop_resident_space_challenge", "unrewarded_wall_prop", "unrewarded_corner_prop", "familiar_preference", "back_wall_prop", "neutral_zone_first_entry_time", "unrewarded_wall_first_entry_time", "rewarded_wall_first_entry_time", "novel_interaction_prop", "novel_interaction_first_entry_time", "novel_alley_prop", "familiar_interaction_first_entry_time", "latency_to_enter_either_interaction", "rewarded_corner_first_entry_time", "SOCA1prop_female_space_opportunity", "neutral_zone_entries", "unrewarded_corner_first_entry_time", "T_by_weight", "familiar_alley_prop", "sum_familiar_entries", "unrewarded_corner_entries", "unrewarded_platform_entries") #got this order from the dendrogram, using this to reorder the rows for the heatmap
pca.loadings<-pca.loadings%>%mutate(name =  factor(name, levels = roworder)) %>% arrange(name)
pca.loadings$name<-roworder
row.names(pca.loadings) <- roworder
drops<-"name"
pca.loadings<-pca.loadings[ , !(names(pca.loadings) %in% drops)]


pca.loadings<-as.matrix(pca.loadings)
 plot(fviz_eig(pca, addlabels=TRUE, geom="bar")+ theme_classic())
  Colors=rev(brewer.pal(11,"RdBu"))
  fviz_pca_var(pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),repel = TRUE) #repel avoids overlapping text
 heatmap.2(pca.loadings, Colv = NA, Rowv = NA, col=Colors,trace="none",density.info="none", xlab = "allassaydata loadings",margins = c(8, 18))
 set.seed(1234)
 hc<- pvclust(t(pca.loadings), method.dist = "correlation", 
            method.hclust = "average", nboot = 100)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1)
 pvrect(hc)
 
 temppca.loadings<-as.data.frame(pca.loadings)
 temppca.loadings$name<-rownames(temppca.loadings)
 temppca.loadings$assay<-NA
  i<-1
 for (i in 1:nrow(temppca.loadings)){
   if (temppca.loadings$name[i] %in% spavariableslist){temppca.loadings$assay[i]<-"spa"}
   if (temppca.loadings$name[i] %in% norvariableslist){temppca.loadings$assay[i]<-"nor"}
   if (temppca.loadings$name[i] %in% presocavariableslistshort){temppca.loadings$assay[i]<-"soca"}}
 ggplot(temppca.loadings, aes(x= PC1, y= PC2, label=name, color = assay))+
  geom_point() +geom_text(aes(label=name),hjust=0, vjust=0, size = 3, angle = 90, check_overlap = TRUE,nudge_y = -0.18)+
   scale_color_manual(values=viridis(6)[c(1,3,4)])+theme_classic()
 
###############DO PC's differ by did fish ascend (NOTE ints are considered subs in this)
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
pcadf<-allassaypca
factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_15)
temppcadata<-full_join(pcadf, factordata, by = "fishID")
temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
temppcadata[which(temppcadata$KPstatus_day_15 == "int"), "KPstatus_day_15"]<-"sub"



######by did fish ascend
i<-1
for (i in 1:(ncol(allassaypca)-1)){

pcname<-paste("PC", i, sep = "")
test_column <- vector(length = nrow(temppcadata))
 temp <- data.frame(factor = test_column)
 temp$factor<-temppcadata%>%select(KPdid_fish_ascend_days_15_to_18)
 factor_name<-"did fish ascend"
 temp$measure<-temppcadata%>%select(pcname)
 measure_name<-pcname
 temp<-as.matrix(temp)
 temp<-as.data.frame(temp)
 temp$measure<-as.numeric(as.character(temp$measure))
 temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
 miny<-min(temp$measure)
 shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
 p_value_shapiro<-shapiro_test$p.value
 print(paste("p value shapiro", p_value_shapiro))
 p_value_wilcox<-NA
 wilcox_test<-wilcox.test(temp$measure~temp$factor)
 p_value_wilcox<-wilcox_test$p.value
 p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 4)
 print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value (FDR 4)  = ", round(p_value_wilcoxadj,4)))
  cohen<-cohen.d(temp$measure~temp$factor)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)
 temp$factor<-as.character(temp$factor)

 if(p_value_wilcoxadj < 0.05){
 p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
   geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
   theme_classic()+
   labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
   stat_n_text(size = 5)+
   geom_text(x=1, y=3, label= glue::glue("p(wilcox FDR 4)=
                                          {round(p_value_wilcoxadj,4)}
                                         cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
 plot(p)}}


#specifically PC1
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
pcadf<-allassaypca
factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_15)
temppcadata<-full_join(pcadf, factordata, by = "fishID")
temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
temppcadata[which(temppcadata$KPstatus_day_15 == "int"), "KPstatus_day_15"]<-"sub"

temppcadata$KPdid_fish_ascend_days_15_to_18<-as.factor(temppcadata$KPdid_fish_ascend_days_15_to_18)
p <- ggplot(temppcadata, aes(PC1, PC2, color = KPdid_fish_ascend_days_15_to_18)) + 
								geom_point(size = 4) + theme(text = element_text(size = 10)) + 
								labs(x = "PC1", y = "PC2") + theme_classic() + 
							  ggtitle("pre all assays pca")+
                scale_color_manual(values=c("maroon", "turquoise4"))
plot(p)
shapiro_test<-shapiro.test(temppcadata$PC1) #if this is NOT significant, you can use t test results
 p_value_shapiro<-shapiro_test$p.value
 p_value_wilcox<-NA
 wilcox_test<-wilcox.test(temppcadata$PC1~temppcadata$KPdid_fish_ascend_days_15_to_18)
 p_value_wilcox<-wilcox_test$p.value
 p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 4)
 print(paste("does pc1 differ by ascend? wilcox p value (FDR 4)  = ", round(p_value_wilcoxadj,4)))
  cohen<-cohen.d(temppcadata$PC1~temppcadata$KPdid_fish_ascend_days_15_to_18)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)
p<- ggplot(temp, aes(x=temppcadata$KPdid_fish_ascend_days_15_to_18, y=temppcadata$PC1)) +
   geom_boxplot(lwd=1)+
   theme_classic()+
   labs(x="KPdid_fish_ascend_days_15_to_18",y="PC1") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
   stat_n_text(size = 5)+
   geom_text(x=1, y=5.8, label= glue::glue("p(wilcox FDR 4)=
                                          {round(p_value_wilcoxadj,4)}
                                         cohen's d = {round(cohen,4)}"), size = 2.5, color = "gray27")+ 
  theme(aspect.ratio = 2)
 plot(p)


#double checking box plot of PC2 when removing the three outliers, still significant
# temppcadata<-temppcadata %>% filter(PC2<5)
# temppcadata<-temppcadata %>% filter(PC2>-2)
# p <- ggplot(temppcadata, aes(PC1, PC2, color = KPdid_fish_ascend_days_15_to_18)) + 
# 								geom_point(size = 4) + theme(text = element_text(size = 10)) + 
# 								labs(x = "PC1", y = "PC2") + theme_classic() + 
# 							  ggtitle("pre all assays pca OUTLIERS removed (by hand t FDR adj p = 8e-4")+
#                 scale_color_manual(values=c("maroon", "turquoise4"))
# plot(p)
#  shapiro_test<-shapiro.test(temppcadata$PC1) #if this is NOT significant, you can use t test results
#  p_value_shapiro<-shapiro_test$p.value
#  p_value_t<-NA
#  t_test<-t.test(temppcadata$PC1~temppcadata$KPdid_fish_ascend_days_15_to_18)
#  p_value_t<-t_test$p.value
#  p_value_tadj<-p.adjust(p_value_t, method = "fdr", n = 4)
#  print(paste("does pc1 differ by ascend? OUTLIERS REMOVED t p value (FDR 4)  = ", round(p_value_tadj,4)))
#   cohen<-cohen.d(temppcadata$PC1~temppcadata$KPdid_fish_ascend_days_15_to_18)
#  cohen<-abs(cohen$estimate)
#  print("cohen")
# print(cohen)


```
#all assays PCA POST 
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#includes postsoca, postnor, postsoca, hormones, and GSI 
#filtering by if fish was present in post as well
#for fish with missing data, their value is replaced with the mean of the remaining data (imputing)

postsocavariableslistshort<- c("SOCA2prop_female_space_opportunity", "SOCA2prop_female_space_challenge", "SOCA2prop_resident_space_opportunity", "SOCA2prop_resident_space_challenge")

temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

temphorm<-temphorm %>% filter(pre_or_post== "post")

templist<- c(spavariableslist, norvariableslist, postsocavariableslistshort, "CORT_by_weight", "T_by_weight", "GSI_end_x1000")

tempPCAlist<-c(templist) 
 factor<-c("fishID")
 fulltempPCAlist<-append(tempPCAlist, factor)
 
 allassaydata<-left_join(postspadata, postnordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 temp.allassaydata<-allassaydata[, which(names(allassaydata) %in% fulltempPCAlist)]
 temp.allassaydatanoid<-temp.allassaydata[, -which(names(temp.allassaydata) %in% factor)]
 temp.allassaydatanoid<-temp.allassaydatanoid[, -which(names(temp.allassaydatanoid) == "latency_to_enter_either_platform")] #removing for infinity reasons
 i<-1
 for(i in 1:ncol(temp.allassaydatanoid)){
   colmean<-mean(temp.allassaydatanoid[,i], na.rm = TRUE)
  j<-1
   for(j in 1:nrow(temp.allassaydatanoid)){  
     if(is.na(temp.allassaydatanoid[j,i])== TRUE){
       temp.allassaydatanoid[j,i]<-colmean}}}

 pca <- prcomp(temp.allassaydatanoid, center = TRUE,scale = TRUE)
 summary(pca)
 allassaypca<-as.data.frame(pca$x)
 allassaypca$fishID<-temp.allassaydata$fishID
 allassaypca$sex<-temp.allassaydata$sex
 pca.loadings <- pca$rotation
pca.loadings<-as.data.frame(pca.loadings)
pca.loadings<-as.matrix(pca.loadings)
 plot(fviz_eig(pca, addlabels=TRUE, geom="bar")+ theme_classic())
  Colors=rev(brewer.pal(11,"RdBu"))
    fviz_pca_var(pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),repel = TRUE) #repel avoids overlapping text
 heatmap.2(pca.loadings, Colv = NA, Rowv = NA, col=Colors,trace="none",density.info="none", xlab = "allassaydata loadings",margins = c(8, 18))
 set.seed(1234)
 hc<- pvclust(t(pca.loadings), method.dist = "correlation", 
            method.hclust = "average", nboot = 100)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1)
 pvrect(hc)
 
 
  temppca.loadings<-as.data.frame(pca.loadings)
 temppca.loadings$name<-rownames(temppca.loadings)
 temppca.loadings$assay<-NA
  i<-1
 for (i in 1:nrow(temppca.loadings)){
   if (temppca.loadings$name[i] %in% spavariableslist){temppca.loadings$assay[i]<-"spa"}
   if (temppca.loadings$name[i] %in% norvariableslist){temppca.loadings$assay[i]<-"nor"}
   if (temppca.loadings$name[i] %in% postsocavariableslistshort){temppca.loadings$assay[i]<-"soca"}}
 ggplot(temppca.loadings, aes(x= PC2, y= PC1, label=name, color = assay))+
  geom_point() +geom_text(aes(label=name),hjust=0, vjust=0, size = 3, angle = 90, nudge_y = -0.18)+
   scale_color_manual(values=viridis(6)[c(1,3,4)])+theme_classic()


 
 
###############DO PC's differ by did fish ascend (NOTE ints are considered subs in this)
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
pcadf<-allassaypca
factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_15)
temppcadata<-full_join(pcadf, factordata, by = "fishID")
temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
temppcadata[which(temppcadata$KPstatus_day_15 == "int"), "KPstatus_day_15"]<-"sub"



######by did fish ascend
i<-1
for (i in 1:(ncol(allassaypca)-1)){

pcname<-paste("PC", i, sep = "")
test_column <- vector(length = nrow(temppcadata))
 temp <- data.frame(factor = test_column)
 temp$factor<-temppcadata%>%select(KPdid_fish_ascend_days_15_to_18)
 factor_name<-"did fish ascend"
 temp$measure<-temppcadata%>%select(pcname)
 measure_name<-pcname
 temp<-as.matrix(temp)
 temp<-as.data.frame(temp)
 temp$measure<-as.numeric(as.character(temp$measure))
 temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
 miny<-min(temp$measure)
 shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
 p_value_shapiro<-shapiro_test$p.value
 p_value_wilcox<-NA
 wilcox_test<-wilcox.test(temp$measure~temp$factor)
 p_value_wilcox<-wilcox_test$p.value
 p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 3)
 print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value (with FDR 3)  = ", round(p_value_wilcoxadj,4)))
  cohen<-cohen.d(temp$measure~temp$factor)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)
 temp$factor<-as.character(temp$factor)

 if(p_value_wilcoxadj < 0.05){
 p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
   geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
   theme_classic()+
   labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
   stat_n_text(size = 5)+
   geom_text(x=1, y=0, label= glue::glue("p(wilcox FDR 3)=
                                          {round(p_value_wilcoxadj,4)}
                                         cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
 plot(p)}}


temppcadata$KPdid_fish_ascend_days_15_to_18<-as.factor(temppcadata$KPdid_fish_ascend_days_15_to_18)
p <- ggplot(temppcadata, aes(PC1, PC2, color = KPdid_fish_ascend_days_15_to_18)) + 
								geom_point(size = 4) + theme(text = element_text(size = 10)) + 
								labs(x = "PC1", y = "PC2") + theme_classic() + 
							  ggtitle("post all assays pca")+
                scale_color_manual(values=c("maroon", "turquoise4"))
plot(p)



temppcadata$KPdid_fish_ascend_days_15_to_18<-as.factor(temppcadata$KPdid_fish_ascend_days_15_to_18)
temppcadata <-temppcadata %>% filter(PC2 > -5)
p <- ggplot(temppcadata, aes(PC1, PC2, color = KPdid_fish_ascend_days_15_to_18)) + 
								geom_point(size = 4) + theme(text = element_text(size = 10)) + 
								labs(x = "PC1", y = "PC2") + theme_classic() + 
							  ggtitle("post all assays pca outlier removed")+
                scale_color_manual(values=c("maroon", "turquoise4"))
plot(p)

wilcox_test<-wilcox.test(temppcadata$PC2 ~ temppcadata$KPdid_fish_ascend_days_15_to_18)
 p_value_wilcox<-wilcox_test$p.value
  p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 3)




```




#HEATMAP (are relationships maintained, strengthened, or weakened after perturbation?)
#(FYI, can't really do heatmaps for just ascenders or nonascenders because n's too low)
#heatmaps pre all (bootstrap = 1000)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

#########PRE all fish

temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

temphorm<-temphorm %>% filter(pre_or_post== "pre")
allassaydata<-left_join(prespadata, prenordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, presocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA1prop_resident_space_opportunity"]
 
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)
xCor<-rcorr(x, type = "pearson") #rcorr is used because NAs are removed in a pairwise fashion instead of removing the entire row.
#colnames(xCor$r)<-NULL

x<-na.omit(x)
print(paste("number of fish in heatmap", nrow(x)))
set.seed(1234)
ClusterDend<-pvclust(x,
                     method.dist="cor", 
                     method.hclust="average", 
                     nboot=1000)
ClustRows<-ClusterDend$hclust
rownames(xCor$r)<-rownames(xCor$r)
pheatmap(xCor$r, 
         cluster_rows = ClustRows,
         cluster_cols = ClustRows,
         #treeheight_col = 0, 
         fontsize = 6)
 plot(ClusterDend, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
 plot(ClusterDend, hang = -1, cex = 0.6, lwd = 3:1)
 pvrect(ClusterDend)
 
 
 


```
#heatmap post all (bootstrap = 1000)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

#########POST


temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

temphorm<-temphorm %>% filter(pre_or_post== "post")
allassaydata<-left_join(postspadata, postnordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, postsocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA2prop_resident_space_opportunity"]
 
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)
xCor<-rcorr(x, type = "pearson") #rcorr is used because NAs are removed in a pairwise fashion instead of removing the entire row.
#colnames(xCor$r)<-NULL

#have to manually remove a column because it's all zeroes: SOCA2_prop_resident_space_challenge
x <- x[ , -which(colnames(x) == "SOCA2prop_resident_space_challenge")]

x<-na.omit(x)
print(paste("number of fish in heatmap", nrow(x)))
set.seed(1234)
ClusterDend<-pvclust(x,
                     method.dist="cor", 
                     method.hclust="average", 
                     nboot=1000)
ClustRows<-ClusterDend$hclust
rownames(xCor$r)<-rownames(xCor$r)
pheatmap(xCor$r, 
         cluster_rows = ClustRows,
         cluster_cols = ClustRows,
         #treeheight_col = 0, 
         fontsize = 6)
 plot(ClusterDend, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
 plot(ClusterDend, hang = -1, cex = 0.6, lwd = 3:1)
 pvrect(ClusterDend)
 


```


#EQUALCOVS
#get correlation matrices
```{r, echo = FALSE, message=FALSE, warning=FALSE}

#get pre cor matrix all fish
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post== "pre")
allassaydata<-left_join(prespadata, prenordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, presocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA1prop_resident_space_opportunity"]
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)

pre_all_cor<-x %>%
  corrr::correlate() %>%
  corrr::shave() %>%
  corrr::stretch() %>%
  na.omit()

pre_all_cor_matrix<-x %>%
  corrr::correlate()

pre_all_cov_matrix<-as.data.frame(cov(x, use = "pairwise")) 


pre_all_cov_df<-as.data.frame(cov(x, use = "pairwise")) 
pre_all_cov<-data.frame(matrix(ncol = 3, nrow = (nrow(pre_all_cov_df) *nrow(pre_all_cov_df))))
colnames(pre_all_cov)<-c("x", "y", "cov")
pre_all_cov$y<-rep(colnames(pre_all_cov_df), ncol(pre_all_cov_df))
xlist<-NA
i<-1
for (i in 1:ncol(pre_all_cov_df)){
 temp<- rep(colnames(pre_all_cov_df[i]), ncol(pre_all_cov_df))
 xlist<-append(temp, xlist)}
xlist<-xlist[1:length(xlist)-1]
pre_all_cov$x<-xlist
k<-1
for(k in 1:nrow(pre_all_cov)){
  xval<-pre_all_cov$x[k]
  yval<-pre_all_cov$y[k]  
  temp<-pre_all_cov_df %>% select(xval)
  pre_all_cov$cov[k]<-temp[yval, 1]}
pre_all_cov<-pre_all_cov %>% filter(x != y)
pre_all_cov<-pre_all_cov %>% arrange(cov)
odd_indexes<-seq(1,(nrow(pre_all_cov)),2)
pre_all_cov<-pre_all_cov[odd_indexes,]


pre_all_cortable<-as.data.frame(correlation(as.data.frame(x),include_factors = TRUE, method = "Pearson"))
pre_all_cortable<-pre_all_cortable %>% filter (p < 0.05)






#get pre cor matrix ascenders only
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post== "pre")
allassaydata<-left_join(prespadata, prenordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(KPdid_fish_ascend_days_15_to_18== 1)
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, presocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA1prop_resident_space_opportunity"]
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)

pre_ascenders_cor<-x %>%
  corrr::correlate() %>%
  corrr::shave() %>%
  corrr::stretch() %>%
  na.omit()

pre_ascenders_cor_matrix<-x %>%
  corrr::correlate()

pre_ascenders_cov_matrix<-as.data.frame(cov(x, use = "pairwise")) 


pre_ascenders_cov_df<-as.data.frame(cov(x, use = "pairwise")) 
pre_ascenders_cov<-data.frame(matrix(ncol = 3, nrow = (nrow(pre_ascenders_cov_df) *nrow(pre_ascenders_cov_df))))
colnames(pre_ascenders_cov)<-c("x", "y", "cov")
pre_ascenders_cov$y<-rep(colnames(pre_ascenders_cov_df), ncol(pre_ascenders_cov_df))
xlist<-NA
i<-1
for (i in 1:ncol(pre_ascenders_cov_df)){
 temp<- rep(colnames(pre_ascenders_cov_df[i]), ncol(pre_ascenders_cov_df))
 xlist<-append(temp, xlist)}
xlist<-xlist[1:length(xlist)-1]
pre_ascenders_cov$x<-xlist
k<-1
for(k in 1:nrow(pre_ascenders_cov)){
  xval<-pre_ascenders_cov$x[k]
  yval<-pre_ascenders_cov$y[k]  
  temp<-pre_ascenders_cov_df %>% select(xval)
  pre_ascenders_cov$cov[k]<-temp[yval, 1]}
pre_ascenders_cov<-pre_ascenders_cov %>% filter(x != y)
pre_ascenders_cov<-pre_ascenders_cov %>% arrange(cov)
odd_indexes<-seq(1,(nrow(pre_ascenders_cov)),2)
pre_ascenders_cov<-pre_ascenders_cov[odd_indexes,]







#get pre cor matrix nonascenders only
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post== "pre")
allassaydata<-left_join(prespadata, prenordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(KPdid_fish_ascend_days_15_to_18== 0)
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, presocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA1prop_resident_space_opportunity"]
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)

pre_nonascenders_cor<-x %>%
  corrr::correlate() %>%
  corrr::shave() %>%
  corrr::stretch() %>%
  na.omit()

pre_nonascenders_cor_matrix<-x %>%
  corrr::correlate()

pre_nonascenders_cov_matrix<-as.data.frame(cov(x, use = "pairwise")) 


pre_nonascenders_cov_df<-as.data.frame(cov(x, use = "pairwise")) 
pre_nonascenders_cov<-data.frame(matrix(ncol = 3, nrow = (nrow(pre_nonascenders_cov_df) *nrow(pre_nonascenders_cov_df))))
colnames(pre_nonascenders_cov)<-c("x", "y", "cov")
pre_nonascenders_cov$y<-rep(colnames(pre_nonascenders_cov_df), ncol(pre_nonascenders_cov_df))
xlist<-NA
i<-1
for (i in 1:ncol(pre_nonascenders_cov_df)){
 temp<- rep(colnames(pre_nonascenders_cov_df[i]), ncol(pre_nonascenders_cov_df))
 xlist<-append(temp, xlist)}
xlist<-xlist[1:length(xlist)-1]
pre_nonascenders_cov$x<-xlist
k<-1
for(k in 1:nrow(pre_nonascenders_cov)){
  xval<-pre_nonascenders_cov$x[k]
  yval<-pre_nonascenders_cov$y[k]  
  temp<-pre_nonascenders_cov_df %>% select(xval)
  pre_nonascenders_cov$cov[k]<-temp[yval, 1]}
pre_nonascenders_cov<-pre_nonascenders_cov %>% filter(x != y)
pre_nonascenders_cov<-pre_nonascenders_cov %>% arrange(cov)
odd_indexes<-seq(1,(nrow(pre_nonascenders_cov)),2)
pre_nonascenders_cov<-pre_nonascenders_cov[odd_indexes,]





#get post cor matrix all fish
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post== "post")
allassaydata<-left_join(postspadata, postnordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, postsocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA2prop_resident_space_opportunity"]
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)

post_all_cor<-x %>%
  corrr::correlate() %>%
  corrr::shave() %>%
  corrr::stretch() %>%
  na.omit()


post_all_cor_matrix<-x %>%
  corrr::correlate()

post_all_cov_matrix<-as.data.frame(cov(x, use = "pairwise")) 


post_all_cov_df<-as.data.frame(cov(x, use = "pairwise")) 
post_all_cov<-data.frame(matrix(ncol = 3, nrow = (nrow(post_all_cov_df) *nrow(post_all_cov_df))))
colnames(post_all_cov)<-c("x", "y", "cov")
post_all_cov$y<-rep(colnames(post_all_cov_df), ncol(post_all_cov_df))
xlist<-NA
i<-1
for (i in 1:ncol(post_all_cov_df)){
 temp<- rep(colnames(post_all_cov_df[i]), ncol(post_all_cov_df))
 xlist<-append(temp, xlist)}
xlist<-xlist[1:length(xlist)-1]
post_all_cov$x<-xlist
k<-1
for(k in 1:nrow(post_all_cov)){
  xval<-post_all_cov$x[k]
  yval<-post_all_cov$y[k]  
  temp<-post_all_cov_df %>% select(xval)
  post_all_cov$cov[k]<-temp[yval, 1]}
post_all_cov<-post_all_cov %>% filter(x != y)
post_all_cov<-post_all_cov %>% arrange(cov)
odd_indexes<-seq(1,(nrow(post_all_cov)),2)
post_all_cov<-post_all_cov[odd_indexes,]

post_all_cortable<-as.data.frame(correlation(as.data.frame(x),include_factors = TRUE, method = "Pearson"))
post_all_cortable<-post_all_cortable %>% filter (p < 0.05)





#get post cor matrix ascenders only
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post== "post")
allassaydata<-left_join(postspadata, postnordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(KPdid_fish_ascend_days_15_to_18== 1)
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, postsocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA2prop_resident_space_opportunity"]
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)

post_ascenders_cor<-x %>%
  corrr::correlate() %>%
  corrr::shave() %>%
  corrr::stretch() %>%
  na.omit()

post_ascenders_cor_matrix<-x %>%
  corrr::correlate()


post_ascenders_cov_matrix<-as.data.frame(cov(x, use = "pairwise")) 


post_ascenders_cov_df<-as.data.frame(cov(x, use = "pairwise")) 
post_ascenders_cov<-data.frame(matrix(ncol = 3, nrow = (nrow(post_ascenders_cov_df) *nrow(post_ascenders_cov_df))))
colnames(post_ascenders_cov)<-c("x", "y", "cov")
post_ascenders_cov$y<-rep(colnames(post_ascenders_cov_df), ncol(post_ascenders_cov_df))
xlist<-NA
i<-1
for (i in 1:ncol(post_ascenders_cov_df)){
 temp<- rep(colnames(post_ascenders_cov_df[i]), ncol(post_ascenders_cov_df))
 xlist<-append(temp, xlist)}
xlist<-xlist[1:length(xlist)-1]
post_ascenders_cov$x<-xlist
k<-1
for(k in 1:nrow(post_ascenders_cov)){
  xval<-post_ascenders_cov$x[k]
  yval<-post_ascenders_cov$y[k]  
  temp<-post_ascenders_cov_df %>% select(xval)
  post_ascenders_cov$cov[k]<-temp[yval, 1]}
post_ascenders_cov<-post_ascenders_cov %>% filter(x != y)
post_ascenders_cov<-post_ascenders_cov %>% arrange(cov)
odd_indexes<-seq(1,(nrow(post_ascenders_cov)),2)
post_ascenders_cov<-post_ascenders_cov[odd_indexes,]

post_ascenders_cortable<-as.data.frame(correlation(as.data.frame(x),include_factors = TRUE, method = "Pearson"))
post_ascenders_cortable<-post_ascenders_cortable %>% filter (p < 0.05)





#get post cor matrix nonascenders only
temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)
temphorm<-temphorm %>% filter(pre_or_post== "post")
allassaydata<-left_join(postspadata, postnordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(KPdid_fish_ascend_days_15_to_18== 0)
 #turn inf into NA
 templist<- c(spavariableslist, norvariableslist, postsocavariableslistshort, "CORT_by_weight", "T_by_weight")
 templist2<-templist[templist!= "latency_to_enter_either_corner"]
 #removing some variables because they lose a lot of the individuals (lots of NA's) or all the same value once filtered
 templist2<-templist2[templist2!= "unrewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_corner_first_entry_time"]
 templist2<-templist2[templist2!= "rewarded_wall_first_entry_time"]
 templist2<-templist2[templist2!= "SOCA2prop_resident_space_opportunity"]
 allassaydata<-allassaydata %>% select(templist2, "fishID")
 allassaydata[allassaydata=="Inf"]<-NA
 allassaydata[allassaydata=="NaN"]<-NA
x<-allassaydata[ , -which(names(allassaydata) %in% c("fishID"))]
x<-as.matrix(x)

post_nonascenders_cor<-x %>%
  corrr::correlate() %>%
  corrr::shave() %>%
  corrr::stretch() %>%
  na.omit()

post_nonascenders_cor_matrix<-x %>%
  corrr::correlate()


post_nonascenders_cov_matrix<-as.data.frame(cov(x, use = "pairwise")) 


post_nonascenders_cov_df<-as.data.frame(cov(x, use = "pairwise")) 
post_nonascenders_cov<-data.frame(matrix(ncol = 3, nrow = (nrow(post_nonascenders_cov_df) *nrow(post_nonascenders_cov_df))))
colnames(post_nonascenders_cov)<-c("x", "y", "cov")
post_nonascenders_cov$y<-rep(colnames(post_nonascenders_cov_df), ncol(post_nonascenders_cov_df))
xlist<-NA
i<-1
for (i in 1:ncol(post_nonascenders_cov_df)){
 temp<- rep(colnames(post_nonascenders_cov_df[i]), ncol(post_nonascenders_cov_df))
 xlist<-append(temp, xlist)}
xlist<-xlist[1:length(xlist)-1]
post_nonascenders_cov$x<-xlist
k<-1
for(k in 1:nrow(post_nonascenders_cov)){
  xval<-post_nonascenders_cov$x[k]
  yval<-post_nonascenders_cov$y[k]  
  temp<-post_nonascenders_cov_df %>% select(xval)
  post_nonascenders_cov$cov[k]<-temp[yval, 1]}
post_nonascenders_cov<-post_nonascenders_cov %>% filter(x != y)
post_nonascenders_cov<-post_nonascenders_cov %>% arrange(cov)
odd_indexes<-seq(1,(nrow(post_nonascenders_cov)),2)
post_nonascenders_cov<-post_nonascenders_cov[odd_indexes,]

post_nonascenders_cortable<-as.data.frame(correlation(as.data.frame(x),include_factors = TRUE, method = "Pearson"))
post_nonascenders_cortable<-post_nonascenders_cortable %>% filter (p < 0.05)

```
#is there a strengthening, weakening, or maintenance of overall correlational structure pre to post?
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#pre all/ascend/nonascend  number of fish = 24,9,15
#post all/ascend/nonascend number of fish = 25,10,15

a<-cbind.data.frame(treatment = rep("pre", 
                                 nrow(pre_all_cov)), 
                    pre_all_cov)
b<-cbind.data.frame(treatment = rep("post", 
                                 nrow(post_all_cov)), 
                    post_all_cov)
all_cov<-rbind.data.frame(a, b)

a<-cbind.data.frame(treatment = rep("pre", 
                                 nrow(pre_all_cor)), 
                    pre_all_cor)
b<-cbind.data.frame(treatment = rep("post", 
                                 nrow(post_all_cor)), 
                    post_all_cor)
all_cor<-rbind.data.frame(a, b)


temp1<-as.matrix(pre_all_cov_matrix)
temp2<- as.matrix(post_all_cov_matrix) 

#https://cran.r-project.org/web/packages/equalCovs/equalCovs.pdf
#https://projecteuclid.org/download/pdfview_1/euclid.aos/1338515142

equalcovsresult<-equalCovs(temp1,temp2,24,25)#second number returned is p value
equalcovsresult_stat <-equalcovsresult[1]
equalcovsresult_p <-equalcovsresult[2]

ggplot(all_cov, aes(x=treatment, y=cov)) + 
geom_violin(color = "gray60") + geom_boxplot(width=1) + theme_classic() + labs(x = "pre vs post perturbation ALL fish", y = "pearson covariance") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))

tempall_cov<-all_cov %>% filter(cov > -0.001)
tempall_cov<-tempall_cov %>% filter(cov < 0.001)
ggplot(tempall_cov, aes(x=treatment, y=cov)) + 
geom_violin(color = "gray60") + geom_boxplot(width=1) + theme_classic() + labs(x = "pre vs post perturbation ALL fish", y = "pearson covariance") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))


ggplot(all_cor, aes(x=treatment, y=abs(r))) + 
geom_violin(color = "gray60") + geom_boxplot(width = 0.3) + theme_classic() + labs(x = "pre vs post perturbation ALL fish", y = "pearson correlation coefficient") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))


```
#is there a strengthening, weakening, or maintenance of overall correlational structure pre to post in the ascenders?
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#pre all/ascend/nonascend  number of fish = 24,9,15
#post all/ascend/nonascend number of fish = 25,10,15

a<-cbind.data.frame(treatment = rep("pre", 
                                 nrow(pre_ascenders_cov)), 
                    pre_ascenders_cov)
b<-cbind.data.frame(treatment = rep("post", 
                                 nrow(post_ascenders_cov)), 
                    post_ascenders_cov)
ascenders_cov<-rbind.data.frame(a, b)

a<-cbind.data.frame(treatment = rep("pre", 
                                 nrow(pre_ascenders_cor)), 
                    pre_ascenders_cor)
b<-cbind.data.frame(treatment = rep("post", 
                                 nrow(post_ascenders_cor)), 
                    post_ascenders_cor)
ascenders_cor<-rbind.data.frame(a, b)


temp1<-as.matrix(pre_ascenders_cov_matrix)
temp1<-na.omit(temp1)
temp2<- as.matrix(post_ascenders_cov_matrix) 

#https://cran.r-project.org/web/packages/equalCovs/equalCovs.pdf
#https://projecteuclid.org/download/pdfview_1/euclid.aos/1338515142

equalcovsresult<-equalCovs(temp1,temp2,9,10)#second number returned is p value
equalcovsresult_stat <-equalcovsresult[1]
equalcovsresult_p <-equalcovsresult[2]

ggplot(ascenders_cov, aes(x=treatment, y=cov)) + 
geom_violin(color = "gray60") + geom_boxplot(color = "turquoise4", width=1) + theme_classic() + labs(x = "pre vs post perturbation ascenders fish", y = "pearson covariance") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))

tempascenders_cov<-ascenders_cov %>% filter(cov > -0.001)
tempascenders_cov<-tempascenders_cov %>% filter(cov < 0.001)
ggplot(tempascenders_cov, aes(x=treatment, y=cov)) + 
geom_violin(color = "gray60") + geom_boxplot(color = "turquoise4", width=1) + theme_classic() + labs(x = "pre vs post perturbation ascenders fish", y = "pearson covariance") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))


ggplot(ascenders_cor, aes(x=treatment, y=abs(r))) + 
geom_violin(color = "gray60") + geom_boxplot(color = "turquoise4",width = 0.3) + theme_classic() + labs(x = "pre vs post perturbation ascenders fish", y = "pearson correlation coefficient") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))





```
#is there a strengthening, weakening, or maintenance of overall correlational structure pre to post in the nonscenders?
```{r, echo = FALSE, message=FALSE, warning=FALSE}
a<-cbind.data.frame(treatment = rep("pre", 
                                 nrow(pre_nonascenders_cov)), 
                    pre_nonascenders_cov)
b<-cbind.data.frame(treatment = rep("post", 
                                 nrow(post_nonascenders_cov)), 
                    post_nonascenders_cov)
nonascenders_cov<-rbind.data.frame(a, b)

a<-cbind.data.frame(treatment = rep("pre", 
                                 nrow(pre_nonascenders_cor)), 
                    pre_nonascenders_cor)
b<-cbind.data.frame(treatment = rep("post", 
                                 nrow(post_nonascenders_cor)), 
                    post_nonascenders_cor)
nonascenders_cor<-rbind.data.frame(a, b)


temp1<-as.matrix(pre_nonascenders_cov_matrix)
temp2<- as.matrix(post_nonascenders_cov_matrix) 

#https://cran.r-project.org/web/packages/equalCovs/equalCovs.pdf
#https://projecteuclid.org/download/pdfview_1/euclid.aos/1338515142

equalcovsresult<-equalCovs(temp1,temp2,15,15)#second number returned is p value
equalcovsresult_stat <-equalcovsresult[1]
equalcovsresult_p <-equalcovsresult[2]

ggplot(nonascenders_cov, aes(x=treatment, y=cov)) + 
geom_violin(color = "gray60") + geom_boxplot(color = "maroon", width=1) + theme_classic() + labs(x = "pre vs post perturbation nonascenders fish", y = "pearson covariance") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))

tempnonascenders_cov<-nonascenders_cov %>% filter(cov > -0.001)
tempnonascenders_cov<-tempnonascenders_cov %>% filter(cov < 0.001)
ggplot(tempnonascenders_cov, aes(x=treatment, y=cov)) + 
geom_violin(color = "gray60") + geom_boxplot(color = "maroon", width=1) + theme_classic() + labs(x = "pre vs post perturbation nonascenders fish", y = "pearson covariance") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))



ggplot(nonascenders_cor, aes(x=treatment, y=abs(r))) + 
geom_violin(color = "gray60") + geom_boxplot(color = "maroon",width = 0.3) + theme_classic() + labs(x = "pre vs post perturbation nonascenders fish", y = "pearson correlation coefficient") +
  theme(aspect.ratio = 3) + stat_n_text() + ggtitle (paste("equalcovs p = ", round(equalcovsresult_p, 8), "
stat = ",round(equalcovsresult_stat, 8)))



```


#change score (post minus pre)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
fullist<-c(norvariableslist, spavariableslist, socavariableslist, "CORT_by_weight", "T_by_weight")
temp<-weight %>% filter(sex == "male") %>% select(fishID)
temp2<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
temp<-full_join(temp, temp2, by = "fishID")

i<-1
 for(i in 1:length(fullist)){
   name<-fullist[i]
   prename<-paste("pre", name, sep = "_")
   postname<-paste("post", name, sep = "_")
   changename<-paste("mod", name, sep = "_")
   
  if(name == "CORT_by_weight"){
   pretemp<- horm %>% filter(pre_or_post == "pre") %>% select(fishID, CORT)
   colnames(pretemp)<-c("fishID", "pre")
   posttemp<-horm %>% filter(pre_or_post == "post") %>% select(fishID, CORT)
   colnames(posttemp)<-c("fishID", "post")
   bothtemp<-full_join(pretemp, posttemp, by = "fishID")
   bothtemp<-bothtemp %>% mutate(modscore = post - pre)
   bothtemp<-bothtemp %>% select(fishID, modscore)
   colnames(bothtemp)<-c("fishID", changename)
   temp<-full_join(temp, bothtemp, by = "fishID")} 
   
   
  if(name == "T_by_weight"){
   pretemp<- horm %>% filter(pre_or_post == "pre") %>% select(fishID, T)
   colnames(pretemp)<-c("fishID", "pre")
   posttemp<-horm %>% filter(pre_or_post == "post") %>% select(fishID, T)
   colnames(posttemp)<-c("fishID", "post")
   bothtemp<-full_join(pretemp, posttemp, by = "fishID")
   bothtemp<-bothtemp %>% mutate(modscore = post - pre)
   bothtemp<-bothtemp %>% select(fishID, modscore)
   colnames(bothtemp)<-c("fishID", changename)
   temp<-full_join(temp, bothtemp, by = "fishID")} 
   
  if (name %in% norvariableslist == TRUE){
   pretemp<- prenordata %>% select(fishID,name)
   colnames(pretemp)<-c("fishID", "pre")
   posttemp<-postnordata %>% select(fishID, name)
   colnames(posttemp)<-c("fishID", "post")
   bothtemp<-full_join(pretemp, posttemp, by = "fishID")
   bothtemp<-bothtemp %>% mutate(modscore = post - pre)
   bothtemp<-bothtemp %>% select(fishID, modscore)
   colnames(bothtemp)<-c("fishID", changename)
   temp<-full_join(temp, bothtemp, by = "fishID")}
   
  if (name %in% spavariableslist == TRUE){
   pretemp<- prespadata %>% select(fishID,name)
   colnames(pretemp)<-c("fishID", "pre")
   posttemp<-postspadata %>% select(fishID, name)
   colnames(posttemp)<-c("fishID", "post")
   bothtemp<-full_join(pretemp, posttemp, by = "fishID")
   bothtemp<-bothtemp %>% mutate(modscore = post - pre)
   bothtemp<-bothtemp %>% select(fishID, modscore)
   colnames(bothtemp)<-c("fishID", changename)
   temp<-full_join(temp, bothtemp, by = "fishID")}
   
  if (name %in% socavariableslist == TRUE){
   pretemp<- socadata %>% select(fishID,paste("SOCA1", name, sep = ""))
   colnames(pretemp)<-c("fishID", "pre")
   posttemp<-socadata %>% select(fishID,paste("SOCA2", name, sep = ""))
   colnames(posttemp)<-c("fishID", "post")
   bothtemp<-full_join(pretemp, posttemp, by = "fishID")
   bothtemp<-bothtemp %>% mutate(modscore = post - pre)
   bothtemp<-bothtemp %>% select(fishID, modscore)
   colnames(bothtemp)<-c("fishID", changename)
   temp<-full_join(temp, bothtemp, by = "fishID")}
   }
changescoredata<-temp

changescoredata[changescoredata=="Inf"]<-NA
changescoredata[changescoredata=="-Inf"]<-NA


#ALL different from zero
i<-1
	for (i in 1:(ncol(changescoredata)-2)) {
	  name<-colnames(changescoredata[i+2])
    temp<-changescoredata %>% select(name) 
    colnames(temp)<-c("measure")
		if (nrow(na.omit(temp)) > 0) {
    t_test <- t.test(temp$measure, mu = 0)
    p_value_t <- t_test$p.value
						print(paste(i+2, name, "p value (diff from zero) = ", 
							round(p_value_t, 4)))
						if (is.na(p_value_t) == TRUE) {
							p_value_t <- 100}
						if (p_value_t > 0 & p_value_t < 0.05) {
							p <- ggplot(temp, aes(y = measure)) + 
								geom_boxplot(size = 1) + ggtitle(paste(name, "\n", 
							 "p value diff from zero=\n", round(p_value_t, 4)))+
							  theme_classic() +theme(aspect.ratio = 3)
							plot(p)}}}



#NOR change score all males specifically latency to approach novel object
t_test <- t.test(changescoredata$mod_novel_interaction_first_entry_time, mu = 0)
 p_value_t <- t_test$p.value			
 print(t_test)
mean <- mean(changescoredata$mod_novel_interaction_first_entry_time, na.rm = TRUE)
mu   <- 0
sd   <- sd(changescoredata$mod_novel_interaction_first_entry_time, na.rm = TRUE)
diff <- mean - mu
cohen <- diff / sd
print("cohen")
print(cohen)


#SPA change score all males specifically approach either corner spa
t_test <- t.test(changescoredata$mod_latency_to_enter_either_corner, mu = 0)
 p_value_t <- t_test$p.value			
 print(t_test)
mean <- mean(changescoredata$mod_latency_to_enter_either_corner, na.rm = TRUE)
mu   <- 0
sd   <- sd(changescoredata$mod_latency_to_enter_either_corner, na.rm = TRUE)
diff <- mean - mu
cohen <- diff / sd
print("cohen")
print(cohen)




#ASCENDERS ONLY different from zero
ascchangescoredata<-changescoredata %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
i<-1
	for (i in 1:(ncol(ascchangescoredata)-2)) {
	  name<-colnames(ascchangescoredata[i+2])
    temp<-ascchangescoredata %>% select(name) 
    colnames(temp)<-c("measure")
		if (nrow(na.omit(temp)) > 0) {
    t_test <- t.test(temp$measure, mu = 0)
    p_value_t <- t_test$p.value
						print(paste(i+2, name, "p value (diff from zero) = ", 
							round(p_value_t, 4)))
						if (is.na(p_value_t) == TRUE) {
							p_value_t <- 100}
						if (p_value_t > 0 & p_value_t < 0.05) {
							p <- ggplot(temp, aes(y = measure)) + 
								geom_boxplot(color = "turquoise4", size = 1) + ggtitle(paste(name, "\n", 
							 "p value diff from zero=\n", round(p_value_t, 4)))+
							  theme_classic() +theme(aspect.ratio = 3)
							plot(p)}}}



#NONASCENDERS ONLY different from zero
nonascchangescoredata<-changescoredata %>% filter(KPdid_fish_ascend_days_15_to_18 == 0)
i<-1
	for (i in 1:(ncol(nonascchangescoredata)-2)) {
	  name<-colnames(nonascchangescoredata[i+2])
    temp<-nonascchangescoredata %>% select(name) 
    colnames(temp)<-c("measure")
		if (nrow(na.omit(temp)) > 0) {
    t_test <- t.test(temp$measure, mu = 0)
    p_value_t <- t_test$p.value
						print(paste(i+2, name, "p value (diff from zero) = ", 
							round(p_value_t, 4)))
						if (is.na(p_value_t) == TRUE) {
							p_value_t <- 100}
						if (p_value_t > 0 & p_value_t < 0.05) {
							p <- ggplot(temp, aes(y = measure)) + 
								geom_boxplot(color = "maroon", size = 1) + ggtitle(paste(name, "\n", 
							 "p value diff from zero=\n", round(p_value_t, 4)))+
							  theme_classic() +theme(aspect.ratio = 3)
							plot(p)}}}



#comparing ascenders and nonascenders

i<-1
	for (i in 1:(ncol(changescoredata)-2)) {
	  name<-colnames(changescoredata[i+2])
    temp<-changescoredata %>% select(KPdid_fish_ascend_days_15_to_18, name) 
    colnames(temp)<-c("did_fish_ascend", "measure")
		if (nrow(na.omit(temp)) > 0) {
    t_test <- t.test(temp$measure~temp$did_fish_ascend)
    p_value_t <- t_test$p.value
						print(paste(i+2, name, "p value (asc vs non) = ", 
							round(p_value_t, 4)))
						if (is.na(p_value_t) == TRUE) {
							p_value_t <- 100}
						if (p_value_t > 0 & p_value_t < 0.05) {
						  temp<-na.omit(temp)
						  temp$did_fish_ascend<-as.character(temp$did_fish_ascend)
							p <- ggplot(temp, aes(x = did_fish_ascend, y = measure)) + 
								geom_boxplot(size = 1) + ggtitle(paste(name, "\n", 
							 "p value diff from zero=\n", round(p_value_t, 4)))+
							  theme_classic() +theme(aspect.ratio = 3)
							plot(p)}}}



#specifically resident barrier comparing ascenders and nonascenders
temp<-changescoredata %>% select(KPdid_fish_ascend_days_15_to_18, mod_prop_resident_barrier) 
    colnames(temp)<-c("did_fish_ascend", "measure")
    
    t_test <- t.test(temp$measure~temp$did_fish_ascend)
    p_value_t <- t_test$p.value
						
						  temp<-na.omit(temp)
						  temp$did_fish_ascend<-as.character(temp$did_fish_ascend)
							p <- ggplot(temp, aes(x = did_fish_ascend, y = measure)) + 
								geom_boxplot(size = 1) + ggtitle(paste(name, "\n", 
							 "p value diff from zero=\n", round(p_value_t, 4)))+
							  theme_classic() +theme(aspect.ratio = 3)
							plot(p)
t_test
 cohen<-cohen.d(temp$measure~temp$did_fish_ascend)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)




```
#PCA on just change score data (subset of variables) - no axes differ between asc/non, note only 9 fish!
```{r, echo = FALSE, message=FALSE, warning=FALSE}

changeshortlist<-c("mod_CORT_by_weight", "mod_T_by_weight", "mod_reward_preference", "mod_neutral_zone_entries", "mod_familiar_preference", "mod_prop_female_space_opportunity", "mod_prop_female_space_challenge", "mod_prop_resident_space_opportunity", "mod_prop_resident_space_challenge")

#removing "mod_rewarded_corner_first_entry_time" to have more individuals left in the PCA

changescoredatanoid<- changescoredata %>% select(changeshortlist)
changescoredatapca<- changescoredata %>% select(changeshortlist, "fishID")

changescoredatapca<-na.omit(changescoredatapca)
changescoredatanoid<-na.omit(changescoredatanoid)

 pca <- prcomp(changescoredatanoid, center = TRUE,scale = TRUE)
 summary(pca)
 allassaypca<-as.data.frame(pca$x)
 allassaypca$fishID<-changescoredatapca$fishID
 pca.loadings <- pca$rotation
pca.loadings<-as.data.frame(pca.loadings)
pca.loadings<-as.matrix(pca.loadings)
 plot(fviz_eig(pca, addlabels=TRUE, geom="bar")+ theme_classic())
  Colors=rev(brewer.pal(11,"RdBu"))
  fviz_pca_var(pca,
             col.var = "contrib", # Color by contributions to the PC
             gradient.cols = c("#00AFBB", "#E7B800", "#FC4E07"),repel = TRUE) #repel avoids overlapping text
 heatmap.2(pca.loadings, Colv = NA, Rowv = NA, col=Colors,trace="none",density.info="none", xlab = "allassaydata loadings",margins = c(8, 18))
 set.seed(1234)
 hc<- pvclust(t(pca.loadings), method.dist = "correlation", 
            method.hclust = "average", nboot = 100)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1)
 pvrect(hc)
 
 
 
 
##DO PC's differ by did fish ascend (NOTE ints are considered subs in this)
pcadf<-allassaypca
factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_15)
temppcadata<-full_join(pcadf, factordata, by = "fishID")
temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
temppcadata[which(temppcadata$KPstatus_day_15 == "int"), "KPstatus_day_15"]<-"sub"

i<-1
for (i in 1:(ncol(allassaypca)-1)){

pcname<-paste("PC", i, sep = "")
test_column <- vector(length = nrow(temppcadata))
 temp <- data.frame(factor = test_column)
 temp$factor<-temppcadata%>%select(KPdid_fish_ascend_days_15_to_18)
 factor_name<-"did fish ascend"
 temp$measure<-temppcadata%>%select(pcname)
 measure_name<-pcname
 temp<-as.matrix(temp)
 temp<-as.data.frame(temp)
 temp$measure<-as.numeric(as.character(temp$measure))
 temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
 miny<-min(temp$measure)
 shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
 p_value_shapiro<-shapiro_test$p.value
 print(paste("p value shapiro", p_value_shapiro))
 p_value_wilcox<-NA
 wilcox_test<-wilcox.test(temp$measure~temp$factor)
 p_value_wilcox<-wilcox_test$p.value
 p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 4)
 print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value (FDR 4)  = ", round(p_value_wilcoxadj,4)))
  cohen<-cohen.d(temp$measure~temp$factor)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)
 temp$factor<-as.character(temp$factor)

 if(p_value_wilcoxadj < 0.05){
 p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
   geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
   theme_classic()+
   labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
   stat_n_text(size = 5)+
   geom_text(x=1, y=3, label= glue::glue("p(wilcox FDR 4)=
                                          {round(p_value_wilcoxadj,4)}
                                         cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
 plot(p)}}






```




# OTHER correlating behavior across tasks (pre and then post)- redo this after PCA's to be more specific
```{r, echo = FALSE, message=FALSE, warning=FALSE}
# df<-full_join(prespadata, prenordata, by = "fishID")
# df<-full_join(df, socadata, by = "fishID")
# 
# dropsa<-c("file_name", "neutral_zone_seconds", "back_wall_seconds", "unrewarded_wall_seconds", "rewarded_corner_seconds","rewarded_platform_seconds", "rewarded_wall_seconds", "unrewarded_corner_seconds", "unrewarded_platform_seconds", "vid_length.x", "fishID", "sex", "first_choice", "error_correction_speed.x", "error_correction_speed.y", "barrier_first_entry_time", "vid_length.y", "sex.x", "sex.y", "file_name.x", "file_name.y", "first_choice.x", "first_choice.y", "latency_to_enter_either_corner.y", "novel_alley_seconds", "novel_interaction_seconds", "upper_novel_corner_seconds", "lower_novel_corner_seconds","familiar_alley_seconds", "familiar_interaction_seconds", "upper_familiar_corner_seconds", "lower_familiar_corner_seconds", "behind_barrier_seconds", "behind_barrier_prop", "behind_barrier_first_entry_time", "upper_novel_corner_prop", "lower_novel_corner_prop", "upper_familiar_corner_prop", "lower_familiar_corner_prop", "upper_familiar_corner_entries", "lower_familiar_corner_entries", "upper_novel_corner_entries", "lower_novel_corner_entries", "neutral_zone_seconds", "back_wall_seconds", "unrewarded_wall_seconds", "rewarded_corner_seconds","rewarded_platform_seconds", "rewarded_wall_seconds", "unrewarded_corner_seconds", "unrewarded_platform_seconds", "barrier_first_entry_time", "SOCA2number_of_entries_habituation","SOCA2number_of_entries_opporutnity","SOCA2number_of_entires_challenge","SOCA2number_digging","SOCA2number_activity_female_barrier","SOCA2number_activity_at_resident_barrier","SOCA2number_activity_at_neural_barrier","SOCA2number_reproductive_display","SOCA2number_lateral_display","SOCA2number_border_conflict" ,"SOCA2number_aggressive_behavior_by_resident", "SOCA2aggression_index", "SOCA2prop_PVC", "SOCA2prop_female_barrier" ,"SOCA2prop_resident_barrier" ,"SOCA2prop_resident_wall"  ,"SOCA2prop_resident_corner" ,"SOCA2prop_camera_wall" ,"SOCA2prop_female_corner" ,"SOCA2prop_female_wall" ,"SOCA2prop_female_space" ,"SOCA2prop_resident_space" ,"SOCA2number_digging_opportunity" ,"SOCA2number_activity_female_barrier_opportunity")
#           
# dropsb<-c("SOCA2number_activity_at_resident_barrier_opportunity", "SOCA2number_activity_at_neural_barrier_opportunity" ,"SOCA2number_reproductive_display_opportunity" ,"SOCA2number_lateral_display_opportunity", "SOCA2number_border_conflict_opportunity" ,"SOCA2prop_PVC_opportunity" ,"SOCA2prop_female_barrier_opportunity" ,"SOCA2prop_resident_barrier_opportunity" ,"SOCA2prop_resident_wall_opportunity" ,"SOCA2prop_resident_corner_opportunity" ,"SOCA2prop_camera_wall_opportunity" ,"SOCA2prop_female_corner_opportunity" ,"SOCA2prop_female_wall_opportunity" ,"SOCA2prop_female_space_opportunity" ,"SOCA2prop_resident_space_opportunity"  ,"SOCA2number_digging_challenge" ,"SOCA2number_activity_female_barrier_challenge" ,"SOCA2number_activity_at_resident_barrier_challenge" ,"SOCA2number_activity_at_neural_barrier_challenge" ,"SOCA2number_reproductive_display_challenge" ,"SOCA2number_lateral_display_challenge" ,"SOCA2number_border_conflict_challenge" ,"SOCA2prop_PVC_challenge" ,"SOCA2prop_female_barrier_challenge" ,"SOCA2prop_resident_barrier_challenge" ,"SOCA2prop_resident_wall_challenge" ,"SOCA2prop_resident_corner_challenge"  ,"SOCA2prop_camera_wall_challenge" ,"SOCA2prop_female_corner_challenge" ,"SOCA2prop_female_wall_challenge"  ,"SOCA2prop_female_space_challenge" ,"SOCA2prop_resident_space_challenge","SOCA2prop_sum_resident" ,"SOCA2prop_sum_female","SOCA2prop_sum_corner" ,"SOCA2prop_sum_resident_opportunity"  ,"SOCA2prop_sum_female_opportunity","SOCA2prop_sum_corner_opportunity","SOCA2prop_sum_resident_challenge" ,"SOCA2prop_sum_female_challenge" ,"SOCA2prop_sum_corner_challenge","SOCA2change_in_activity_at_female_barrier_opportunity_to_challenge","SOCA2change_in_reproductive_display_opportunity_to_challenge" ,"SOCA2change_in_lateral_display_opportunity_to_challenge" ,"SOCA2change_in_prop_sum_female_opportunity_to_challenge")
#           
# dropsc<-c("SOCA2change_in_prop_sum_resident_opportunity_to_challenge","SOCA1to2change_number_of_entries_opporutnity", "SOCA1to2change_number_of_entires_challenge","SOCA1to2change_number_digging","SOCA1to2change_number_activity_female_barrier", "SOCA1to2change_number_activity_at_resident_barrier", "SOCA1to2change_number_reproductive_display","SOCA1to2change_number_lateral_display","SOCA1to2change_number_border_conflict",     "SOCA1to2change_aggression_index","SOCA1to2change_prop_PVC","SOCA1to2change_prop_female_barrier", "SOCA1to2change_prop_resident_barrier","SOCA1to2change_number_activity_female_barrier_opportunity" ,"SOCA1to2change_number_reproductive_display_opportunity",   "SOCA1to2change_number_activity_at_resident_barrier_challenge", "SOCA1to2change_number_reproductive_display_challenge", "SOCA1to2change_number_border_conflict_challenge" ,"SOCA1to2change_prop_PVC_challenge","SOCA1to2change_prop_female_barrier_challenge", "SOCA1to2change_prop_sum_resident", "SOCA1to2change_prop_sum_female","SOCA1to2change_prop_sum_corner", "SOCA1to2change_prop_sum_female_opportunity"  , "SOCA1to2change_prop_sum_resident_challenge","SOCA1to2change_prop_sum_female_challenge" , "SOCA1to2change_prop_sum_corner_challenge", "tank", "present_in_both_socas", "focal_standard_length", "tank.y", "SOCA1_length_of_vid", "SOCA1_size_index", "tank.x", "focal_standard_length.x")
# 
# df<-df[ , !(names(df) %in% dropsa)]
# df<-df[ , !(names(df) %in% dropsb)]
# df<-df[ , !(names(df) %in% dropsc)]
# 
# 
# zones<-c("zones")
# clreg(df,zones, factor = FALSE)



```
# OTHER changing/moving csv files so they can be used in the data analysis (only need to do this once at the beginning)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#put original files into the uncombined folder (note add a - to the one that has the word datestamp in the filename in SPA)
#step 1: filter out tube removed (first entry in csv's)
#step 2: combine csv's (instead of part 1 and part 2) and rename, once for SPA and once for NOR
#step 3: change left and right to rewarded/unrewarded for SPA and to  to familiar/novel for NOR
#step 4: filter by over 600
#step 5: within the over 600 group, filter into spa4 and spa8 or nor1 and nor2
#step 6:with those subcategories, filter by only 15subpre (our baseline) 

#STEP 1
######filtering out tube removed and renaming to remove timestamp fom filename, only need to do this the first time
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/uncombined/"
# templist<-list.files(tempath)
# i<-1
# for (i in 1:length(templist)){
#   filename<-templist[i]
#   file<-read.csv(paste(tempath, templist[i], sep = "/"))
#   if (file$code[1] == "tube_removed" | file$code[1] == "tube_removal"| file$code[1] == "tube removed"){
#     file<-file[2:nrow(file),]}
#   write.csv(file, paste(tempath,strsplit(templist[i], "-")[[1]][1], ".csv", sep = ""))}
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/uncombined/"
# templist<-list.files(tempath)
# i<-1
# for (i in 1:length(templist)){
#   filename<-templist[i]
#   file<-read.csv(paste(tempath, templist[i], sep = "/"))
#   if (file$code[1] == "tube_removed" | file$code[1] == "tube_removal"| file$code[1] == "tube removed"){
#     file<-file[2:nrow(file),]}
#   write.csv(file, paste(tempath,strsplit(templist[i], "-")[[1]][1], ".csv", sep = ""))}
# #need to remove originals by hand (can tell originals because of the timestamp)
# 
# #how to check for files that still have a tube removed NOTE: need to do about 10 by hand (returned in the list generated), unsure why!
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/uncombined/"
# templist<-list.files(tempath)
# for (i in 1:length(templist)){
#   filename<-templist[i]
#   file<-read.csv(paste(tempath, templist[i], sep = "/"))
#   row<- file %>% filter(code == "tube_removed" | code == "tube removed" | code == "tube_removal") %>% nrow()
#   if (row>0){print(filename)}}
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/uncombined/"
# templist<-list.files(tempath)
# for (i in 1:length(templist)){
#   filename<-templist[i]
#   file<-read.csv(paste(tempath, templist[i], sep = "/"))
#   row<- file %>% filter(code == "tube_removed" | code == "tube removed" | code == "tube_removal") %>% nrow()
#   if (row>0){print(filename)}}


#####note: in SPA uncombined manually changed spa8 round 5 male green deleted row 15 & 16, negative time difference flagged




#STEP 2
######combining part 1 and part 2 csv's, and changing csv names so that the filename has the factor info (required for clseries)
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/uncombined"
# newpath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/combined_left_right/"
# templist<-list.files(tempath)
# kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
# 
# x<-1
# for(x in 1:length(templist)){
#   if (length(grep(pattern = "part1", templist[x])) + length(grep(pattern = "part2", templist[x])) == 0){
# 
#   file<-read.csv(paste(tempath, templist[x], sep = "/"))
#   filename<-templist[x]
#   tempfishID<-paste(strsplit(filename, "_")[[1]][2], strsplit(filename, "_")[[1]][5],strsplit(filename, "_")[[1]][6],sep = "" )
#   status15<-as.character(kp$KPstatus_day_15[which(kp$fishID == tempfishID)])
#   status15<-paste("15", status15, sep = "")
#   status18<-as.character(kp$KPstatus_day_18[which(kp$fishID == tempfishID)])
#   status18<-paste("18", status18, sep = "")
#   ascend<-as.character(kp$KPdid_fish_ascend_days_15_to_18[which(kp$fishID == tempfishID)])
#   ascend<-paste("ascend", ascend, sep = "")
#   numtrans<-as.character(kp$KPnumber_status_transitions[which(kp$fishID == tempfishID)])
#   numtrans<-paste("numtrans", numtrans, sep = "")
#   sex<-"male"
#   if (length(grep(pattern = "female", templist[x]))==1){sex <- "female"}
#   trial<-NA
#   if (length(grep(pattern = "SPA4", templist[x]))==1){trial <- "SPA4"}
#   if (length(grep(pattern = "SPA8", templist[x]))==1){trial <- "SPA8"}
# 
#   spa4rewardside<-NA
#   spa8rewardside<-NA
#   if ((length(grep(pattern = "round1", templist[x]))+ length(grep(pattern = "round2", templist[x])) + length(grep(pattern = "round5", templist[x])) +
#   length(grep(pattern = "round6", templist[x])))>0){
#     spa4rewardside<-"spa4L"
#     spa8rewardside<-"spa8R"
#     }
#   if ((length(grep(pattern = "round3", templist[x]))+ length(grep(pattern = "round4", templist[x])) + length(grep(pattern = "round7", templist[x])) +
#   length(grep(pattern = "round8", templist[x])))>0){
#     spa4rewardside<-"spa4R"
#     spa8rewardside<-"spa8L"
#     }
#   newfilename<-paste(tempfishID, trial, sex, status15, status18, ascend, numtrans,spa4rewardside,spa8rewardside, sep = "_")
#   file<-as.data.frame(file)
#   file<-file %>% select(time, code, class)
#   write.csv(file, paste(newpath, newfilename, ".csv", sep = ""))}
# 
# if (length(grep(pattern = "part1", templist[x])) == 1){
#   part1<-read.csv(paste(tempath, templist[x], sep = "/"))
#   if(part1$code[nrow(part1)] != "END"){print("NO END, WARNING")}
#   part1length<-part1$time[nrow(part1)]
#   part1<-part1[1:(nrow(part1)-1),]
#   part2<-read.csv(paste(tempath, templist[x+1], sep = "/"))
#   i<-1
#   for(i in 1:nrow(part2)){part2$time[i]<-part2$time[i] + part1length}
#   part1<- part1 %>% select(time, code, class)
#   part2<- part2 %>% select(time, code, class)
#   combined<-rbind(part1, part2)
# 
#   filename<-templist[x]
#   tempfishID<-paste(strsplit(filename, "_")[[1]][2], strsplit(filename, "_")[[1]][5],strsplit(filename, "_")[[1]][6],sep = "" )
#   status15<-as.character(kp$KPstatus_day_15[which(kp$fishID == tempfishID)])
#   status15<-paste("15", status15, sep = "")
#   status18<-as.character(kp$KPstatus_day_18[which(kp$fishID == tempfishID)])
#   status18<-paste("18", status18, sep = "")
#   ascend<-as.character(kp$KPdid_fish_ascend_days_15_to_18[which(kp$fishID == tempfishID)])
#   ascend<-paste("ascend", ascend, sep = "")
#   numtrans<-as.character(kp$KPnumber_status_transitions[which(kp$fishID == tempfishID)])
#   numtrans<-paste("numtrans", numtrans, sep = "")
#   sex<-"male"
#   if (length(grep(pattern = "female", templist[x]))==1){sex <- "female"}
#   trial<-NA
#   if (length(grep(pattern = "SPA4", templist[x]))==1){trial <- "SPA4"}
#   if (length(grep(pattern = "SPA8", templist[x]))==1){trial <- "SPA8"}
# 
#   spa4rewardside<-NA
#   spa8rewardside<-NA
#   if ((length(grep(pattern = "round1", templist[x]))+ length(grep(pattern = "round2", templist[x])) + length(grep(pattern = "round5", templist[x])) +
#   length(grep(pattern = "round6", templist[x])))>0){
#     spa4rewardside<-"spa4L"
#     spa8rewardside<-"spa8R"
#     }
#   if ((length(grep(pattern = "round3", templist[x]))+ length(grep(pattern = "round4", templist[x])) + length(grep(pattern = "round7", templist[x])) +
#   length(grep(pattern = "round8", templist[x])))>0){
#     spa4rewardside<-"spa4R"
#     spa8rewardside<-"spa8L"
#     }
# 
#   newfilename<-paste(tempfishID, trial, sex, status15, status18, ascend, numtrans, spa4rewardside,spa8rewardside, sep = "_")
#   combined<-as.data.frame(combined)
#   combined<-combined %>% select(time, code, class)
#   write.csv(combined, paste(newpath, newfilename, ".csv", sep = ""))}}
# 
# 
# #NOW NOR
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/uncombined"
# newpath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/combined_left_right/"
# templist<-list.files(tempath)
# kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
# 
# x<-1
# for(x in 1:length(templist)){
#   if (length(grep(pattern = "part1", templist[x])) + length(grep(pattern = "part2", templist[x])) == 0){
# 
#   file<-read.csv(paste(tempath, templist[x], sep = "/"))
#   filename<-templist[x]
#   tempfishID<-paste(strsplit(filename, "_")[[1]][2], strsplit(filename, "_")[[1]][5],strsplit(filename, "_")[[1]][6],sep = "" )
#   status15<-as.character(kp$KPstatus_day_15[which(kp$fishID == tempfishID)])
#   status15<-paste("15", status15, sep = "")
#   status18<-as.character(kp$KPstatus_day_18[which(kp$fishID == tempfishID)])
#   status18<-paste("18", status18, sep = "")
#   ascend<-as.character(kp$KPdid_fish_ascend_days_15_to_18[which(kp$fishID == tempfishID)])
#   ascend<-paste("ascend", ascend, sep = "")
#   numtrans<-as.character(kp$KPnumber_status_transitions[which(kp$fishID == tempfishID)])
#   numtrans<-paste("numtrans", numtrans, sep = "")
#   sex<-"male"
#   if (length(grep(pattern = "female", templist[x]))==1){sex <- "female"}
#   trial<-NA
#   if (length(grep(pattern = "NOV1", templist[x]))==1){trial <- "NOR1"}
#   if (length(grep(pattern = "NOV2", templist[x]))==1){trial <- "NOR2"}
# 
#   nor1rewardside<-NA
#   nor2rewardside<-NA
#   if ((length(grep(pattern = "round1", templist[x]))+ length(grep(pattern = "round2", templist[x])) + length(grep(pattern = "round5", templist[x])) +
#   length(grep(pattern = "round6", templist[x])))>0){
#     nor1rewardside<-"nor1R"
#     nor2rewardside<-"nor2L"
#     }
#   if ((length(grep(pattern = "round3", templist[x]))+ length(grep(pattern = "round4", templist[x])) + length(grep(pattern = "round7", templist[x])) +
#   length(grep(pattern = "round8", templist[x])))>0){
#     nor1rewardside<-"nor1L"
#     nor2rewardside<-"nor2R"
#     }
#   newfilename<-paste(tempfishID, trial, sex, status15, status18, ascend, numtrans,nor1rewardside,nor2rewardside, sep = "_")
#   file<-as.data.frame(file)
#   file<-file %>% select(time, code, class)
#   write.csv(file, paste(newpath, newfilename, ".csv", sep = ""))}
# 
# if (length(grep(pattern = "part1", templist[x])) == 1){
#   part1<-read.csv(paste(tempath, templist[x], sep = "/"))
#   if(part1$code[nrow(part1)] != "END"){print("NO END, WARNING")}
#   part1length<-part1$time[nrow(part1)]
#   part1<-part1[1:(nrow(part1)-1),]
#   part2<-read.csv(paste(tempath, templist[x+1], sep = "/"))
#   i<-1
#   for(i in 1:nrow(part2)){part2$time[i]<-part2$time[i] + part1length}
#   part1<- part1 %>% select(time, code, class)
#   part2<- part2 %>% select(time, code, class)
#   combined<-rbind(part1, part2)
# 
#   filename<-templist[x]
#   tempfishID<-paste(strsplit(filename, "_")[[1]][2], strsplit(filename, "_")[[1]][5],strsplit(filename, "_")[[1]][6],sep = "" )
#   status15<-as.character(kp$KPstatus_day_15[which(kp$fishID == tempfishID)])
#   status15<-paste("15", status15, sep = "")
#   status18<-as.character(kp$KPstatus_day_18[which(kp$fishID == tempfishID)])
#   status18<-paste("18", status18, sep = "")
#   ascend<-as.character(kp$KPdid_fish_ascend_days_15_to_18[which(kp$fishID == tempfishID)])
#   ascend<-paste("ascend", ascend, sep = "")
#   numtrans<-as.character(kp$KPnumber_status_transitions[which(kp$fishID == tempfishID)])
#   numtrans<-paste("numtrans", numtrans, sep = "")
#   sex<-"male"
#   if (length(grep(pattern = "female", templist[x]))==1){sex <- "female"}
#   trial<-NA
#   if (length(grep(pattern = "NOV1", templist[x]))==1){trial <- "NOR1"}
#   if (length(grep(pattern = "NOV2", templist[x]))==1){trial <- "NOR2"}
# 
#   nor1rewardside<-NA
#   nor2rewardside<-NA
#   if ((length(grep(pattern = "round1", templist[x]))+ length(grep(pattern = "round2", templist[x])) + length(grep(pattern = "round5", templist[x])) +
#   length(grep(pattern = "round6", templist[x])))>0){
#     nor1rewardside<-"nor1R"
#     nor2rewardside<-"nor2L"
#     }
#   if ((length(grep(pattern = "round3", templist[x]))+ length(grep(pattern = "round4", templist[x])) + length(grep(pattern = "round7", templist[x])) +
#   length(grep(pattern = "round8", templist[x])))>0){
#     nor1rewardside<-"nor1L"
#     nor2rewardside<-"nor2R"
#     }
# 
#   newfilename<-paste(tempfishID, trial, sex, status15, status18, ascend, numtrans, nor1rewardside,nor2rewardside, sep = "_")
#   combined<-as.data.frame(combined)
#   combined<-combined %>% select(time, code, class)
#   write.csv(combined, paste(newpath, newfilename, ".csv", sep = ""))}}




#STEP 3 
#############change right/left to rewarded/unrewarded or familiar/novel(for clseries)

# filelist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/combined_left_right")
# i<-1
# for (i in 1:length(filelist)){
#   file<-read.csv(paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/combined_left_right/",filelist[i], sep = ""))
#   if(length(grep(pattern = "SPA4", filelist[i]))>0){ #note: all caps is which trial this sheet is, and lowercase is rewardside both both trials
#   if(length(grep(pattern = "spa4L", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "unrewarded")
#     codes<- codes %>% str_replace("left", "rewarded")
#     file$code <-codes}
#     if(length(grep(pattern = "spa4R", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "rewarded")
#     codes<- codes %>% str_replace("left", "unrewarded")
#     file$code <-codes}}
#     if(length(grep(pattern = "SPA8", filelist[i]))>0){
#   if(length(grep(pattern = "spa8L", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "unrewarded")
#     codes<- codes %>% str_replace("left", "rewarded")
#     file$code <-codes}
#     if(length(grep(pattern = "spa8R", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "rewarded")
#     codes<- codes %>% str_replace("left", "unrewarded")
#     file$code <-codes}}
#   write.csv(file, paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/",filelist[i], sep = ""))
# }
# 
# 
# filelist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/combined_left_right")
# i<-1
# for (i in 1:length(filelist)){
#   file<-read.csv(paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/combined_left_right/",filelist[i], sep = ""))
#   if(length(grep(pattern = "NOR1", filelist[i]))>0){ #note: all caps is which trial this sheet is, and lowercase is rewardside both both trials
#   if(length(grep(pattern = "nor1L", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "novel")
#     codes<- codes %>% str_replace("left", "familiar")
#     file$code <-codes}
#     if(length(grep(pattern = "nor1R", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "familiar")
#     codes<- codes %>% str_replace("left", "novel")
#     file$code <-codes}}
#     if(length(grep(pattern = "NOR2", filelist[i]))>0){
#   if(length(grep(pattern = "nor2L", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "novel")
#     codes<- codes %>% str_replace("left", "familiar")
#     file$code <-codes}
#     if(length(grep(pattern = "nor2R", filelist[i]))>0){
#     codes<-as.vector(file$code)
#     codes<- codes %>% str_replace("right", "familiar")
#     codes<- codes %>% str_replace("left", "novel")
#     file$code <-codes}}
#   write.csv(file, paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/",filelist[i], sep = ""))
# }



#STEP 4
# #####filter vid length over 600 (post/spa8)
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/", pattern = "*.csv")
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if (file$time[nrow(file)]>= 600){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/", filename, sep = ""))}}
# 
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/", pattern = "*.csv")
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if (file$time[nrow(file)]>= 600){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/", filename, sep = ""))}}



#STEP 5
#####within the over 600 group, filter into spa4 and spa8 or nor1 and nor2
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/", pattern = "*.csv")
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if(length(grep(pattern = "SPA4", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa4/", filename, sep = ""))}
# if(length(grep(pattern = "SPA8", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa8/", filename, sep = ""))}}
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/", pattern = "*.csv")
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if(length(grep(pattern = "NOR1", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1/", filename, sep = ""))}
# if(length(grep(pattern = "NOR2", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2/", filename, sep = ""))}}


#STEP 6
##### with the subcategories in step 5, filter by only 15subpre (the pre baseline group of only subs) 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1")
# templist<-templist[1:(length(templist)-1)]
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if(length(grep(pattern = "15sub", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1/sub_pre/", filename, sep = ""))}}
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2")
# templist<-templist[1:(length(templist)-1)]
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if(length(grep(pattern = "15sub", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2/sub_pre/", filename, sep = ""))}}
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa4/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa4")
# templist<-templist[1:(length(templist)-1)]
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if(length(grep(pattern = "15sub", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa4/sub_pre/", filename, sep = ""))}}
# 
# tempath<-"/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa8/"
# templist<-list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa8")
# templist<-templist[1:(length(templist)-1)]
# i<-1
# for (i in 1:length(templist)){
# file<-read.csv(paste(tempath, templist[i], sep = ""))
# filename<-templist[i]
# if(length(grep(pattern = "15sub", filename))>0){
#   file<- file %>% select(time ,code, class)
#   write.csv(file,paste("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/SPA_sheets/over_600/over_600_spa8/sub_pre/", filename, sep = ""))}}


```
#OTHER prespa PCA (need to fix row order, also should we expect to not see clusters BECAUSE of covariance filtering?)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
# 
# tempPCAlist<-spavariableslist
#  factor<-c("fishID")
#  fulltempPCAlist<-append(tempPCAlist, factor)
#  temp.prespadata<-prespadata[, which(names(prespadata) %in% fulltempPCAlist)]
#  temp.prespadata<-na.omit(temp.prespadata)
#  temp.prespadatanoid<-temp.prespadata[, -which(names(temp.prespadata) %in% factor)]
#  
#  pca <- prcomp(temp.prespadatanoid, center = TRUE,scale = TRUE)
#  summary(pca)
#  prespapca<-as.data.frame(pca$x)
#  prespapca$fishID<-temp.prespadata$fishID
#  prespapca$sex<-temp.prespadata$sex
#  pca.loadings <- pca$rotation
#  
# pca.loadings<-as.data.frame(pca.loadings)
#  # pca.loadings$name<-as.vector(rownames(pca.loadings))
#  #  roworder<-c("neutral_zone_prop", "reward_preference", "back_wall_prop", "unrewarded_platform_prop", "rewarded_wall_first_entry_time", "back_wall_first_entry_time", "rewarded_corner_first_entry_time", "unrewarded_wall_prop", "neutral_zone_entries", "unrewarded_wall_first_entry_time", "unrewarded_corner_first_entry_time", "unrewarded_platform_first_entry_time", "rewarded_corner_prop", "rewarded_corner_entries", "unrewarded_corner_prop", "latency_to_enter_either_corner", "latency_to_enter_either_platform" ,"neutral_zone_first_entry_time", "rewarded_wall_prop", "unrewarded_corner_entries", "unrewarded_platform_entries") #got this order from the dendrogram, using this to reorder the rows for the heatmap
#  # pca.loadings<-pca.loadings%>%mutate(name =  factor(name, levels = roworder)) %>% arrange(name)
#  # pca.loadings$name<-roworder
#  # row.names(pca.loadings) <- roworder
#  # drops<-"name"
#  # pca.loadings<-pca.loadings[ , !(names(pca.loadings) %in% drops)]
# pca.loadings<-as.matrix(pca.loadings)
#  plot(fviz_eig(pca, addlabels=TRUE, geom="bar")+ theme_classic())
#   Colors=rev(brewer.pal(11,"RdBu"))
#  heatmap.2(pca.loadings, Colv = NA, Rowv = NA, col=Colors,trace="none",density.info="none", xlab = "prespadata loadings",margins = c(8, 18))
#  set.seed(1234)
#  hc<- pvclust(t(pca.loadings), method.dist = "correlation", 
#             method.hclust = "average", nboot = 100)
#  plot(hc, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
#  plot(hc, hang = -1, cex = 0.6, lwd = 3:1)
#  pvrect(hc)
# 
#  
#  
# ###############DO PC's differ by status day 15 or by did fish ascend (NOTE ints are considered subs in this)
# kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
# pcadf<-prespapca
# factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_15)
# temppcadata<-full_join(pcadf, factordata, by = "fishID")
# temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
# temppcadata[which(temppcadata$KPstatus_day_15 == "int"), "KPstatus_day_15"]<-"sub"
# 
# ######by status day 15
# i<-1
# for (i in 1:(ncol(prespapca)-1)){
# 
# pcname<-paste("PC", i, sep = "")  
# test_column <- vector(length = nrow(temppcadata))
#  temp <- data.frame(factor = test_column)
#  temp$factor<-temppcadata%>%select(KPstatus_day_15)
#  factor_name<-"status15"
#  temp$measure<-temppcadata%>%select(pcname)
#  measure_name<-pcname
#  temp<-as.matrix(temp)
#  temp<-as.data.frame(temp)
#  temp$measure<-as.numeric(as.character(temp$measure))
#  temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
#  miny<-min(temp$measure)
#  shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
#  p_value_shapiro<-shapiro_test$p.value
#  p_value_wilcox<-NA
#  wilcox_test<-wilcox.test(temp$measure~temp$factor)
#  p_value_wilcox<-wilcox_test$p.value
#  #p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 10)
#  print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value  = ", round(p_value_wilcox,4)))
#   cohen<-cohen.d(temp$measure~temp$factor)
#  cohen<-abs(cohen$estimate)
#  print("cohen")
# print(cohen)
#  temp$factor<-as.character(temp$factor)
#  
#  if(p_value_wilcox < 0.05){
#  p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
#    geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
#    theme_classic()+
#    labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
#    stat_n_text(size = 5)+
#    geom_text(x=1, y=0, label= glue::glue("p(wilcox)= 
#                                           {round(p_value_wilcox,4)}
#                                          cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
#  plot(p)}
#  }




# ######by did fish ascend
# i<-1
# for (i in 1:(ncol(prespapca)-1)){
# 
# pcname<-paste("PC", i, sep = "")  
# test_column <- vector(length = nrow(temppcadata))
#  temp <- data.frame(factor = test_column)
#  temp$factor<-temppcadata%>%select(KPdid_fish_ascend_days_15_to_18)
#  factor_name<-"status15"
#  temp$measure<-temppcadata%>%select(pcname)
#  measure_name<-pcname
#  temp<-as.matrix(temp)
#  temp<-as.data.frame(temp)
#  temp$measure<-as.numeric(as.character(temp$measure))
#  temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
#  miny<-min(temp$measure)
#  shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
#  p_value_shapiro<-shapiro_test$p.value
#  p_value_wilcox<-NA
#  wilcox_test<-wilcox.test(temp$measure~temp$factor)
#  p_value_wilcox<-wilcox_test$p.value
#  #p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 10)
#  print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value  = ", round(p_value_wilcox,4)))
#   cohen<-cohen.d(temp$measure~temp$factor)
#  cohen<-abs(cohen$estimate)
#  print("cohen")
# print(cohen)
#  temp$factor<-as.character(temp$factor)
#  
#  if(p_value_wilcox < 0.05){
#  p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
#    geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
#    theme_classic()+
#    labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
#    stat_n_text(size = 5)+
#    geom_text(x=1, y=0, label= glue::glue("p(wilcox)= 
#                                           {round(p_value_wilcox,4)}
#                                          cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
#  plot(p)}
#  }
# 


```
#OTHER postspa PCA not included (after cov matrix filtering)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
# 
# 
# tempPCAlist<-spavariableslist
#  factor<-c("fishID")
#  fulltempPCAlist<-append(tempPCAlist, factor)
#  temp.postspadata<-postspadata[, which(names(postspadata) %in% fulltempPCAlist)]
#  temp.postspadata<-na.omit(temp.postspadata)
#  temp.postspadatanoid<-temp.postspadata[, -which(names(temp.postspadata) %in% factor)]
#  
#  pca <- prcomp(temp.postspadatanoid, center = TRUE,scale = TRUE)
#  summary(pca)
#  postspapca<-as.data.frame(pca$x)
#  postspapca$fishID<-temp.postspadata$fishID
#  postspapca$sex<-temp.postspadata$sex
#  pca.loadings <- pca$rotation
#  
# pca.loadings<-as.data.frame(pca.loadings)
# pca.loadings$name<-as.vector(rownames(pca.loadings))
# # roworder<-c("unrewarded_platform_entries", "neutral_zone_prop","latency_to_enter_either_platform","unrewarded_platform_prop","latency_to_enter_either_corner","unrewarded_wall_first_entry_time","rewarded_corner_first_entry_time","neutral_zone_first_entry_time","rewarded_wall_first_entry_time",  "unrewarded_corner_entries", "reward_preference", "rewarded_corner_prop","rewarded_wall_prop", "rewarded_corner_entries", "unrewarded_corner_prop", "neutral_zone_entries", "back_wall_prop","unrewarded_corner_first_entry_time","unrewarded_wall_prop","back_wall_first_entry_time","unrewarded_platform_first_entry_time") #got this order from the dendrogram, using this to reorder the rows for the heatmap
# # pca.loadings<-pca.loadings%>%mutate(name =  factor(name, levels = roworder)) %>% arrange(name)
# # pca.loadings$name<-roworder
# # row.names(pca.loadings) <- roworder
# # drops<-"name"
# pca.loadings<-pca.loadings[ , !(names(pca.loadings) %in% drops)]
# pca.loadings<-as.matrix(pca.loadings)
#  plot(fviz_eig(pca, addlabels=TRUE, geom="bar")+ theme_classic())
#   Colors=rev(brewer.pal(11,"RdBu"))
#  heatmap.2(pca.loadings, Colv = NA, Rowv = NA, col=Colors,trace="none",density.info="none", xlab = "postspadata loadings",margins = c(8, 18))
#  set.seed(1234)
#  hc<- pvclust(t(pca.loadings), method.dist = "correlation", 
#             method.hclust = "average", nboot = 100)
#  plot(hc, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
#  plot(hc, hang = -1, cex = 0.6, lwd = 3:1)
#  pvrect(hc)
# 
#  
#  
# ###############DO PC's differ by status day 15 or by did fish ascend (NOTE ints are considered subs in this)
# kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
# pcadf<-postspapca
# factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_18)
# temppcadata<-full_join(pcadf, factordata, by = "fishID")
# temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
# temppcadata[which(temppcadata$KPstatus_day_18 == "int"), "KPstatus_day_18"]<-"sub"
# 
# ######by status day 18
# i<-1
# for (i in 1:(ncol(postspapca)-1)){
# 
# pcname<-paste("PC", i, sep = "")  
# test_column <- vector(length = nrow(temppcadata))
#  temp <- data.frame(factor = test_column)
#  temp$factor<-temppcadata%>%select(KPstatus_day_18)
#  factor_name<-"status18"
#  temp$measure<-temppcadata%>%select(pcname)
#  measure_name<-pcname
#  temp<-as.matrix(temp)
#  temp<-as.data.frame(temp)
#  temp$measure<-as.numeric(as.character(temp$measure))
#  temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
#  miny<-min(temp$measure)
#  shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
#  p_value_shapiro<-shapiro_test$p.value
#  p_value_wilcox<-NA
#  wilcox_test<-wilcox.test(temp$measure~temp$factor)
#  p_value_wilcox<-wilcox_test$p.value
#  #p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 10)
#  print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value  = ", round(p_value_wilcox,4)))
#   cohen<-cohen.d(temp$measure~temp$factor)
#  cohen<-abs(cohen$estimate)
#  print("cohen")
# print(cohen)
#  temp$factor<-as.character(temp$factor)
#  
#  if(p_value_wilcox < 0.05){
#  p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
#    geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
#    theme_classic()+
#    labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
#    stat_n_text(size = 5)+
#    geom_text(x=1, y=0, label= glue::glue("p(wilcox)= 
#                                           {round(p_value_wilcox,4)}
#                                          cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
#  plot(p)}
#  }
# 
# 
# 
# 
# ######by did fish ascend
# i<-1
# for (i in 1:(ncol(postspapca)-1)){
# 
# pcname<-paste("PC", i, sep = "")  
# test_column <- vector(length = nrow(temppcadata))
#  temp <- data.frame(factor = test_column)
#  temp$factor<-temppcadata%>%select(KPdid_fish_ascend_days_15_to_18)
#  factor_name<-"status15"
#  temp$measure<-temppcadata%>%select(pcname)
#  measure_name<-pcname
#  temp<-as.matrix(temp)
#  temp<-as.data.frame(temp)
#  temp$measure<-as.numeric(as.character(temp$measure))
#  temp<- temp %>% filter(is.na(factor)==FALSE) %>% filter(is.na(measure)==FALSE)
#  miny<-min(temp$measure)
#  shapiro_test<-shapiro.test(temp$measure) #if this is NOT significant, you can use t test results
#  p_value_shapiro<-shapiro_test$p.value
#  p_value_wilcox<-NA
#  wilcox_test<-wilcox.test(temp$measure~temp$factor)
#  p_value_wilcox<-wilcox_test$p.value
#  #p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 10)
#  print(paste("does", measure_name ,"differ by", factor_name, "? wilcox p value  = ", round(p_value_wilcox,4)))
#   cohen<-cohen.d(temp$measure~temp$factor)
#  cohen<-abs(cohen$estimate)
#  print("cohen")
# print(cohen)
#  temp$factor<-as.character(temp$factor)
#  
#  if(p_value_wilcox < 0.05){
#  p<- ggplot(temp, aes(x=temp$factor, y=temp$measure)) +
#    geom_boxplot(lwd=1, fill = c("gray75", "gray95"))+
#    theme_classic()+
#    labs(x= factor_name,y=measure_name) + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
#    stat_n_text(size = 5)+
#    geom_text(x=1, y=0, label= glue::glue("p(wilcox)= 
#                                           {round(p_value_wilcox,4)}
#                                          cohen's d = {round(cohen,4)}"), size = 3, color = "gray27", fontface = 'italic')
#  plot(p)}
#  }
# 


```
#comparing covariance matrices (e.g. connectivity) pre to post
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#here I'm only including the same behavioral variables, no hormones or GSI. This is based off the lists that have ALREADY filtered out >0.8 so as to be comparable to the other data analyses


#PRE COR MATRIX
tempnordata<-prenordata
colnames(tempnordata) <- paste("NOR", colnames(prenordata), sep = "")
tempnordata$fishID<-prenordata$fishID                           
tempspadata<-prespadata
colnames(tempspadata) <- paste("SPA", colnames(prespadata), sep = "")
tempspadata$fishID<-prespadata$fishID    
tempspavariableslist <- paste("SPA", spavariableslist, sep = "")
tempnorvariableslist <- paste("NOR", norvariableslist, sep = "")
prelist<- c(tempspavariableslist, tempnorvariableslist, presocavariableslistshort)
postlist<- c(tempspavariableslist, tempnorvariableslist, presocavariableslistshort)
i<-1
j<-1
k<-1
tempdf<-full_join(tempspadata, tempnordata, by = "fishID")
tempdf<-full_join(tempdf, socadata, by = "fishID")
temp<-as.data.frame(vector(length = length(prelist) * length(prelist)))
 for(i in 1:length(prelist)){
  for(j in 1:length(prelist)){
measure1_name<-as.character(prelist[i])
measure2_name<-as.character(prelist[j])
temp$measure1[k]<-measure1_name
temp$measure2[k]<-measure2_name
temptemp<-as.data.frame(vector(length = nrow(tempdf)))
temptemp$measure1<-tempdf%>% select(measure1_name) %>% as.vector()
temptemp$measure2<-tempdf%>% select(measure2_name) %>% as.vector()
temptemp<-temptemp %>% select(c(measure1,measure2))
temptemp<-as.matrix(temptemp)
temptemp<-as.data.frame(temptemp)
temptemp<-temptemp %>% filter(is.na(measure1) == FALSE & is.na(measure2) == FALSE)
pearson<-cor(temptemp$measure1, temptemp$measure2,  method = "pearson")
temp$abspearson[k]<-abs(pearson)
k<-k+1
  }}
temp<-temp%>% select(c(measure1,measure2,abspearson))
temp$abspearson<-as.numeric(temp$abspearson)
prepearson<-temp%>%filter(measure1 != measure2)




#POST COR MATRIX
tempnordata<-postnordata
colnames(tempnordata) <- paste("NOR", colnames(postnordata), sep = "")
tempnordata$fishID<-postnordata$fishID                           
tempspadata<-postspadata
colnames(tempspadata) <- paste("SPA", colnames(postspadata), sep = "")
tempspadata$fishID<-postspadata$fishID    
tempspavariableslist <- paste("SPA", spavariableslist, sep = "")
tempnorvariableslist <- paste("NOR", norvariableslist, sep = "")
postlist<- c(tempspavariableslist, tempnorvariableslist, postsocavariableslistshort)
postlist<- c(tempspavariableslist, tempnorvariableslist, postsocavariableslistshort)
i<-1
j<-1
k<-1
tempdf<-full_join(tempspadata, tempnordata, by = "fishID")
tempdf<-full_join(tempdf, socadata, by = "fishID")
temp<-as.data.frame(vector(length = length(postlist) * length(postlist)))
 for(i in 1:length(postlist)){
  for(j in 1:length(postlist)){
measure1_name<-as.character(postlist[i])
measure2_name<-as.character(postlist[j])
temp$measure1[k]<-measure1_name
temp$measure2[k]<-measure2_name
temptemp<-as.data.frame(vector(length = nrow(tempdf)))
temptemp$measure1<-tempdf%>% select(measure1_name) %>% as.vector()
temptemp$measure2<-tempdf%>% select(measure2_name) %>% as.vector()
temptemp<-temptemp %>% select(c(measure1,measure2))
temptemp<-as.matrix(temptemp)
temptemp<-as.data.frame(temptemp)
temptemp<-temptemp %>% filter(is.na(measure1) == FALSE & is.na(measure2) == FALSE)
pearson<-cor(temptemp$measure1, temptemp$measure2,  method = "pearson")
temp$abspearson[k]<-abs(pearson)
k<-k+1
  }}
temp<-temp%>% select(c(measure1,measure2,abspearson))
temp$abspearson<-as.numeric(temp$abspearson)
postpearson<-temp%>%filter(measure1 != measure2)


comparepre<-as.data.frame(unique(prepearson$abspearson))
comparepre$phase<-"pre"
colnames(comparepre)<-c("pearson", "phase")
comparepost<-as.data.frame(unique(postpearson$abspearson))
comparepost$phase<-"post"
colnames(comparepost)<-c("pearson", "phase")

compare<-rbind(comparepre, comparepost)


wilcox_test<-wilcox.test(compare$pearson~ compare$phase)
p_value_wilcox<-wilcox_test$p.value
print("overall correlation (pearson) pre to post")
print(p_value_wilcox)

ggplot(compare, aes(x = phase, y = pearson)) + geom_boxplot(fill = "white")  + theme_classic() + labs(x = "pre vs post perturbation (NOR, SPA, SOCA)", y = "pearson correlations of all variables
 (same across pre/post), p = 1.3 x 10 -9") +
  theme(aspect.ratio = 3) + stat_n_text()





```
#glmulti model selection based on PRE data (for both PCA and glmulti I'm imputing based on means). using pre short list because other list too long?)
```{r, echo = FALSE, message=FALSE, warning=FALSE}

temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

#change pre to post here if needed
temphorm<-temphorm %>% filter(pre_or_post== "pre")
allassaydata<-left_join(prespadata, prenordata, by = "fishID")
templist<- preshortlist

factor<-"KPdid_fish_ascend_days_15_to_18"
fulltemplist<-c(factor, templist)
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 temp.allassaydata<-allassaydata %>% select(fulltemplist)
 i<-1
 for(i in 1:ncol(temp.allassaydata)){
   colmean<-mean(temp.allassaydata[,i], na.rm = TRUE)
  j<-1
   for(j in 1:nrow(temp.allassaydata)){  
     if(is.na(temp.allassaydata[j,i])== TRUE){
       temp.allassaydata[j,i]<-colmean}}}
temp<- temp.allassaydata
temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)
temp<-na.omit(temp)
print(nrow(temp))
temp<-as.matrix(temp)
temp<-as.data.frame(temp)
temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)

 factors<-templist
res <- glmulti("KPdid_fish_ascend_days_15_to_18", factors, temp,
               level=1, crit="aicc", method = "d", family = binomial,confsetsize=2000, minsize = 1)
print(paste("Number of  models compared:", res[1]))

res <- glmulti("KPdid_fish_ascend_days_15_to_18", factors, temp,
              level=1, crit="aicc", method = "h", family = binomial,confsetsize=100, minsize = 1)
top <- weightable(res)
top <- top[top$aicc <= min(top$aicc) + 2,]
#print(top)
#BEST MODEL (all permutations)
print("BEST  MODEL PRE")
summ(res@objects[[1]])
nullmod <- glm(KPdid_fish_ascend_days_15_to_18~1, family="binomial", data = temp)
 mcfadden<-1-(as.numeric(logLik(res@objects[[1]]))/as.numeric(logLik(nullmod))) #mcfadden's pseudo r squared statistic for logistic regression
 print("McFadden of bestAICc ")
 print(mcfadden)
  print("AICc of best ")
 print(aicc(res@objects[[1]]))
#relative importance of coefficients averaged across all models
plot(res, type="s")
mmi <- as.data.frame(coef(res))
mmi <- mmi%>% select(Importance)
print(mmi)
```
#glmulti model selection based on POST data 
```{r, echo = FALSE, message=FALSE, warning=FALSE}

temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

#change pre to post here if needed
temphorm<-temphorm %>% filter(pre_or_post== "post")
allassaydata<-left_join(postspadata, postnordata, by = "fishID")
templist<- c(postshortlist, "GSI_end_x1000")

factor<-"KPdid_fish_ascend_days_15_to_18"
fulltemplist<-c(factor, templist)
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 temp.allassaydata<-allassaydata %>% select(fulltemplist)
 i<-1
 for(i in 1:ncol(temp.allassaydata)){
   colmean<-mean(temp.allassaydata[,i], na.rm = TRUE)
  j<-1
   for(j in 1:nrow(temp.allassaydata)){  
     if(is.na(temp.allassaydata[j,i])== TRUE){
       temp.allassaydata[j,i]<-colmean}}}
temp<- temp.allassaydata
temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)
temp<-na.omit(temp)
print(nrow(temp))
temp<-as.matrix(temp)
temp<-as.data.frame(temp)
temp$KPdid_fish_ascend_days_15_to_18<-as.character(temp$KPdid_fish_ascend_days_15_to_18)
temp$KPdid_fish_ascend_days_15_to_18<-as.factor(temp$KPdid_fish_ascend_days_15_to_18)

 factors<-templist
res <- glmulti("KPdid_fish_ascend_days_15_to_18", factors, temp,
               level=1, crit="aicc", method = "d", family = binomial,confsetsize=2000, minsize = 1)
print(paste("Number of  models compared:", res[1]))

res <- glmulti("KPdid_fish_ascend_days_15_to_18", factors, temp,
              level=1, crit="aicc", method = "h", family = binomial,confsetsize=100, minsize = 1)
top <- weightable(res)
top <- top[top$aicc <= min(top$aicc) + 2,]
#print(top)
#BEST MODEL (all permutations)
print("BEST  MODEL POST")
summ(res@objects[[1]])
nullmod <- glm(KPdid_fish_ascend_days_15_to_18~1, family="binomial", data = temp)
 mcfadden<-1-(as.numeric(logLik(res@objects[[1]]))/as.numeric(logLik(nullmod))) #mcfadden's pseudo r squared statistic for logistic regression
 print("McFadden of bestAICc ")
 print(mcfadden)
  print("AICc of best ")
 print(aicc(res@objects[[1]]))
#relative importance of coefficients averaged across all models
plot(res, type="s")
mmi <- as.data.frame(coef(res))
mmi <- mmi%>% select(Importance)
print(mmi)
```
#OTHER how many fish ascended per community
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#(all calculated based on the "kp" dataframe) using the following code: View(kp[grep("round1", kp$fishID),])

#ascenders/nonascenders

#round1: 0/0

#round2: 2/2

#round3: 0/3

#round4: 3/1

#round5: 1/3

#round6: 1/3

#round7: 2/2

#round8: 1/3
  



``` 
#OTHER comparing the ascenders that had short vs long SPA2 solve times (size, post CORT, post T)
```{r, echo = FALSE, message=FALSE}


#get "fast" and "slow" SPA2 solver
bitemp<- left_join(kp, postspadata, by = "fishID")
bitemp<-left_join(bitemp, weight, by = "fishID")
temphorm<-horm %>% filter(pre_or_post == "post")
bitemp<-left_join(bitemp, temphorm, by = "fishID")
bitemp<-bitemp %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
bitemp$spa2solvespeedcat<-NA

i<-1
for (i in 1:nrow(bitemp)){
  if(is.na(bitemp$rewarded_corner_first_entry_time[i]) == TRUE){bitemp$spa2solvespeedcat[i]<- NA}
  if(is.na(bitemp$rewarded_corner_first_entry_time[i]) == FALSE){
  if(bitemp$rewarded_corner_first_entry_time[i] > 400){bitemp$spa2solvespeedcat[i]<-"slow"}
  if(bitemp$rewarded_corner_first_entry_time[i] < 400){bitemp$spa2solvespeedcat[i]<-"fast"}}}


#compare size (SL_start)

wilcox_test<-wilcox.test(bitemp$SL_start~bitemp$spa2solvespeedcat)
p_value_wilcox<-wilcox_test$p.value
print("CORT by weight")
print(p_value_wilcox)
p <- ggplot(bitemp, aes(spa2solvespeedcat, SL_start)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "spa2 solve speed (ascenders only)", y = "SL start") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0.5, y=4, label= glue::glue("p wilcox = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(4,5.5)
plot(p)

  cohen<-cohen.d(bitemp$SL_start~bitemp$spa2solvespeedcat)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-nrow(bitemp)



#compare post CORT

wilcox_test<-wilcox.test(bitemp$CORT~bitemp$spa2solvespeedcat)
p_value_wilcox<-wilcox_test$p.value
print("CORT by weight")
print(p_value_wilcox)
p <- ggplot(bitemp, aes(spa2solvespeedcat, CORT)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "spa2 solve speed (ascenders only)", y = "post CORT") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0.5, y=0, label= glue::glue("p wilcox = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)

 cohen<-cohen.d(bitemp$CORT~bitemp$spa2solvespeedcat)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-nrow(bitemp)
numberA


#compare post T

wilcox_test<-wilcox.test(bitemp$T~bitemp$spa2solvespeedcat)
p_value_wilcox<-wilcox_test$p.value
print("T by weight")
print(p_value_wilcox)
p <- ggplot(bitemp, aes(spa2solvespeedcat, T)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "spa2 solve speed (ascenders only)", y = "post T") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0.5, y=0, label= glue::glue("p wilcox = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)

 cohen<-cohen.d(bitemp$T~bitemp$spa2solvespeedcat)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-nrow(bitemp)
numberA


#compare SPA2 latency to explore (neutral area, doing this based off hierarchical clustering pre) not significant!

wilcox_test<-wilcox.test(bitemp$neutral_zone_first_entry_time~bitemp$spa2solvespeedcat)
p_value_wilcox<-wilcox_test$p.value
print("neutral_zone_first_entry_time")
print(p_value_wilcox)
p <- ggplot(bitemp, aes(spa2solvespeedcat, neutral_zone_first_entry_time)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "spa2 solve speed (ascenders only)", y = "post neutral_zone_first_entry_time") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0.5, y=90, label= glue::glue("p wilcox = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)
wilcox_test

 cohen<-cohen.d(bitemp$neutral_zone_first_entry_time~bitemp$spa2solvespeedcat)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-nrow(bitemp)
numberA



```

#some components of figures
#testosterone change in ascenders and post cort by ascended
```{r, echo = FALSE, message=FALSE, warning=FALSE}

 ###T ascenders only  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)
hormtemp<-full_join(horm, statustemp, by = "fishID")
hormtemp<-full_join(hormtemp, weight, by = "fishID")
hormtemp<-hormtemp %>% mutate(CORT_by_weight = CORT/weight_start)
hormtemp<-hormtemp %>% mutate(T_by_weight = T/weight_start)
hormtemp$KPdid_fish_ascend_days_15_to_18<-as.factor(hormtemp$KPdid_fish_ascend_days_15_to_18)
hormtemp$pre_or_post <- factor(hormtemp$pre_or_post , levels=c("pre", "post"))
hormtemp<-hormtemp %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
wilcox_test<-wilcox.test(hormtemp$T_by_weight~hormtemp$pre_or_post, paired = TRUE)
p_value_wilcox<-wilcox_test$p.value
print("T_by_weight")
print(p_value_wilcox)
p<- ggplot(data=hormtemp, aes(x=pre_or_post, y=T_by_weight, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=hormtemp$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("T_by_weight ascenders only")+
  ylim(0, 300)
  plot(p)
cohen<-cohen.d(hormtemp$T_by_weight~hormtemp$pre_or_post)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberpre<-hormtemp %>% filter(pre_or_post == "pre") %>% nrow()
numberpre
numberpost<-hormtemp %>% filter(pre_or_post == "post") %>% nrow()
numberpost



horm<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/hormone_data_master_december_2019.csv")
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
zones<-c("back_wall", "neutral_zone","rewarded_corner", "rewarded_platform", "rewarded_wall", "unrewarded_corner", "unrewarded_platform", "unrewarded_wall")

#post boxplot hormones by did fish ascend
df<-full_join(kp, weight, by = "fishID")
temphorm<-horm %>% filter(pre_or_post == "post")
df<-full_join(df, temphorm, by = "fishID")
df<-df %>% mutate(CORT_by_weight = CORT/weight_start)
df<-df %>% mutate(T_by_weight = T/weight_start)
df<- df %>% select("KPdid_fish_ascend_days_15_to_18", "CORT_by_weight", "T_by_weight")
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)

wilcox_test<-wilcox.test(df$CORT_by_weight~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("CORT by weight")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, CORT_by_weight)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "post cort by weight") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=1000, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(0,1000)
plot(p)





```

#pre by ascend: testosterone, NOR preference, SPA unrewarded latency and SPA back wall entries
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#PRE boxplot hormones by did fish ascend
df<-full_join(kp, weight, by = "fishID")
temphorm<-horm %>% filter(pre_or_post == "pre")
df<-full_join(df, temphorm, by = "fishID")
df<-df %>% mutate(CORT_by_weight = CORT/weight_start)
df<-df %>% mutate(T_by_weight = T/weight_start)
df<- df %>% select("KPdid_fish_ascend_days_15_to_18", "CORT_by_weight", "T_by_weight")
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)


wilcox_test<-wilcox.test(df$T_by_weight~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("T by weight")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, T_by_weight)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "pre T by weight") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=250, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
        ylim(0,250)
plot(p)



#PRE boxplot NOR preference by did fish ascend
df<-left_join(prenordata, kp, by = "fishID")
df<-df %>% select(familiar_preference, KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
wilcox_test<-wilcox.test(df$familiar_preference~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("familiar_preference by did fish ascend")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, familiar_preference)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "familiar_preference") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=1, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)





#PRE boxplot SPA back_wall_entries by did fish ascend
df<-left_join(prespadata, kp, by = "fishID")
df<-df %>% select(back_wall_entries, KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
shapiro.test(df$back_wall_entries)
wilcox_test<-wilcox.test(df$back_wall_entries~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("back_wall_entries by did fish ascend")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, back_wall_entries)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "back_wall_entries") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=11, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)



#PRE boxplot SPA unrewarded_wall_prop by did fish ascend
df<-left_join(prespadata, kp, by = "fishID")
df<-df %>% select(unrewarded_wall_prop, KPdid_fish_ascend_days_15_to_18)
df<-na.omit(df)
df$KPdid_fish_ascend_days_15_to_18<-as.factor(df$KPdid_fish_ascend_days_15_to_18)
shapiro.test(df$unrewarded_wall_prop)
wilcox_test<-wilcox.test(df$unrewarded_wall_prop~df$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("unrewarded_wall_prop by did fish ascend")
print(p_value_wilcox)
p <- ggplot(df, aes(KPdid_fish_ascend_days_15_to_18, unrewarded_wall_prop)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "unrewarded_wall_prop") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=0.9, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)






```

#pre all PCA (yes hormones, no GSI)
```{r, echo = FALSE, message=FALSE, warning=FALSE}
#includes presoca, prenor, presoca, hormones (NOT GSI)
#filtering by if fish was present in post as well
#for fish with missing data, their value is replaced with the mean of the remaining data (imputing)

presocavariableslistshort<- c("SOCA1prop_female_space_opportunity", "SOCA1prop_female_space_challenge", "SOCA1prop_resident_space_opportunity", "SOCA1prop_resident_space_challenge")

temphorm<-full_join(horm, weight, by = "fishID")
temphorm<-temphorm %>% mutate(CORT_by_weight = CORT/weight_start)
temphorm<-temphorm %>% mutate(T_by_weight = T/weight_start)

temphorm<-temphorm %>% filter(pre_or_post== "pre")

templist<- c(spavariableslist, norvariableslist, presocavariableslistshort, "CORT_by_weight", "T_by_weight")

tempPCAlist<-c(templist) 
 factor<-c("fishID")
 fulltempPCAlist<-append(tempPCAlist, factor)
 
 allassaydata<-left_join(prespadata, prenordata, by = "fishID")
 allassaydata<-left_join(allassaydata, kp,  by = "fishID")
 allassaydata<-left_join(allassaydata, temphorm, by = "fishID")
 allassaydata<-left_join(allassaydata, socadata, by = "fishID")
 allassaydata<-allassaydata %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
 temp.allassaydata<-allassaydata[, which(names(allassaydata) %in% fulltempPCAlist)]
 temp.allassaydatanoid<-temp.allassaydata[, -which(names(temp.allassaydata) %in% factor)]
 temp.allassaydatanoid<-temp.allassaydatanoid[, -which(names(temp.allassaydatanoid) == "latency_to_enter_either_platform")] #removing for infinity reasons
 i<-1
 for(i in 1:ncol(temp.allassaydatanoid)){
   colmean<-mean(temp.allassaydatanoid[,i], na.rm = TRUE)
  j<-1
   for(j in 1:nrow(temp.allassaydatanoid)){  
     if(is.na(temp.allassaydatanoid[j,i])== TRUE){
       temp.allassaydatanoid[j,i]<-colmean}}}

 pca <- prcomp(temp.allassaydatanoid, center = TRUE,scale = TRUE)
 summary(pca)
 allassaypca<-as.data.frame(pca$x)
 allassaypca$fishID<-temp.allassaydata$fishID
 allassaypca$sex<-temp.allassaydata$sex
 pca.loadings <- pca$rotation
pca.loadings<-as.data.frame(pca.loadings)
pca.loadings<-as.matrix(pca.loadings)
 plot(fviz_eig(pca, addlabels=TRUE, geom="bar")+ theme_classic())
  Colors=rev(brewer.pal(11,"RdBu"))
 #heatmap.2(pca.loadings, Colv = NA, Rowv = NA, col=Colors,trace="none",density.info="none", xlab = "allassaydata loadings",margins = c(8, 18))
 set.seed(1234)
 hc<- pvclust(t(pca.loadings), method.dist = "correlation", 
            method.hclust = "average", nboot = 100)
 plot(hc, hang = -1, cex = 0.6, lwd = 3:1, labels = F, print.pv=FALSE, print.num=FALSE)
 #plot(hc, hang = -1, cex = 0.6, lwd = 3:1)
 #pvrect(hc)
 
###############DO PC's differ by did fish ascend (NOTE ints are considered subs in this)
kp<-read.csv("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/KP_master.csv")
pcadf<-allassaypca
factordata<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, KPstatus_day_15)
temppcadata<-full_join(pcadf, factordata, by = "fishID")
temppcadata<-temppcadata %>% filter(is.na(PC1)== FALSE)
temppcadata[which(temppcadata$KPstatus_day_15 == "int"), "KPstatus_day_15"]<-"sub"


temppcadata$KPdid_fish_ascend_days_15_to_18<-as.factor(temppcadata$KPdid_fish_ascend_days_15_to_18)
p <- ggplot(temppcadata, aes(PC1, PC2, color = KPdid_fish_ascend_days_15_to_18)) + 
								geom_point(size = 4) + theme(text = element_text(size = 10)) + 
								labs(x = "PC1", y = "PC2") + theme_classic() + 
							  ggtitle("pre all assays pca")+
                scale_color_manual(values=c("maroon", "turquoise4"))
plot(p)


shapiro_test<-shapiro.test(temppcadata$PC1) #if this is NOT significant, you can use t test results
 p_value_shapiro<-shapiro_test$p.value
 p_value_wilcox<-NA
 wilcox_test<-wilcox.test(temppcadata$PC1~temppcadata$KPdid_fish_ascend_days_15_to_18)
 p_value_wilcox<-wilcox_test$p.value
 p_value_wilcoxadj<-p.adjust(p_value_wilcox, method = "fdr", n = 4)
 print(paste("does pc1 differ by ascend? wilcox p value (FDR 4)  = ", round(p_value_wilcoxadj,4)))
  cohen<-cohen.d(temppcadata$PC1~temppcadata$KPdid_fish_ascend_days_15_to_18)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)

p<- ggplot(temppcadata, aes(x=temppcadata$KPdid_fish_ascend_days_15_to_18, y=temppcadata$PC1)) +
   geom_boxplot(lwd=1)+
   theme_classic()+
   labs(x="KPdid_fish_ascend_days_15_to_18",y="PC1") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x = element_text(size = 14)) +
   stat_n_text(size = 5)+
   geom_text(x=1, y=2.5, label= glue::glue("p(wilcox FDR 4)=
                                          {round(p_value_wilcoxadj,4)}
                                         cohen's d = {round(cohen,4)}"), size = 3)+ 
  theme(aspect.ratio = 2)
 plot(p)


```

#change and boxplot in NOR pref pre to post ascenders only then nonascenders only
```{r, echo = FALSE, message=FALSE, warning=FALSE}
###################NOR preference in the first minute

file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1", pattern = "*.csv")
norfishlist<-kp %>% filter(is.na(KPdid_fish_ascend_days_15_to_18) == FALSE)
norfishlist<-as.list(strsplit(as.character(norfishlist$fishID),'_'))
  fullframe<-as.data.frame(vector(length = length(norfishlist)*2))
  fullframe$phase<-NA
  nov_left_list<-c("round1", "round2", "round5", "round6")
  nov_right_list<-c("round3", "round4", "round7", "round8")
  
i<-1
k<-1
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor1")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  fullframe[k,1]<-fishid
  fullframe$phase[k]<-"nor1"
  fullframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  fullframe$nov_interaction[k]<-seg1_prop_novel_interaction
  fullframe$fam_corners[k]<-seg1_prop_familiar_corners
  fullframe$nov_corners[k]<- seg1_prop_novel_corners
  fullframe$familiar_preference[k]<-seg1_preference_familiar_corner_and_interaction
  fullframe$fam_corner_and_int[k]<-seg1_prop_familiar_corners + seg1_prop_familiar_interaction
    colnames(fullframe)[1]<-"fishID"
  k<-k+1
  }}


file_list <- list.files("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2", pattern = "*.csv")
i<-1
k<-1+ length(norfishlist)
for(i in 1:length(file_list)){
  setwd("/stor/work/Hofmann/projects/aburtoni_cognition_social_competence/Analysis scripts and excel sheets/status differences summer 2020/data/NOR_sheets/over_600/over_600_nor2")
  fil <- read_csv(file_list[i], col_names = TRUE, col_types = NULL)
  filename <- file_list[i]
  fishid<-strsplit(filename, "_")[[1]][1]

  segment_length<-60
  stamp1<-fil$time[1]
  stamp2<-fil$time[1] + segment_length
  
  if(fishid %in% norfishlist){
  
  segment1<-fil[1:max(which(fil$time<stamp2)),]
  segment1$time[1]<-stamp1
  segment1<-mutate(segment1, time.difference = -(time -lead(time)))
  segment1$time.difference[nrow(segment1)]<- (segment_length + segment1$time[1]) - segment1$time[nrow(segment1)]

  
  seg1_prop_familiar_alley<- segment1 %>% filter(code == "familiar_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_alley<-segment1 %>% filter(code == "novel_alley") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_corners<-segment1 %>% filter(code == "upper_familiar_corner"|code == "lower_familiar_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_corners<-segment1 %>% filter(code == "upper_novel_corner"|code =="lower_novel_corner") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_familiar_interaction<- segment1 %>% filter(code == "familiar_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_prop_novel_interaction<- segment1 %>% filter(code == "novel_interaction") %>% pull(time.difference) %>% sum()/segment_length
  seg1_preference_familiar_corner_and_interaction<-(seg1_prop_familiar_corners + seg1_prop_familiar_interaction) / (seg1_prop_familiar_corners + seg1_prop_familiar_interaction + seg1_prop_novel_corners + seg1_prop_novel_interaction)
 
  fullframe[k,1]<-fishid
  fullframe$phase[k]<-"nor2"
  fullframe$fam_interaction[k]<-seg1_prop_familiar_interaction
  fullframe$nov_interaction[k]<-seg1_prop_novel_interaction
  fullframe$fam_corners[k]<-seg1_prop_familiar_corners
  fullframe$nov_corners[k]<- seg1_prop_novel_corners
  fullframe$familiar_preference[k]<-seg1_preference_familiar_corner_and_interaction
  fullframe$fam_corner_and_int[k]<-seg1_prop_familiar_corners + seg1_prop_familiar_interaction
    colnames(fullframe)[1]<-"fishID"
  k<-k+1
  }}


fullframe<-full_join(fullframe, kp, by = "fishID")
fullframe$KPdid_fish_ascend_days_15_to_18<-as.factor(fullframe$KPdid_fish_ascend_days_15_to_18)

  #do ASCENDING males switch their preferences before and after perturbation (keepign unpaired because I have some only pre and some only post fish)
  tempframe<-fullframe %>% filter(KPdid_fish_ascend_days_15_to_18 == 1)
  
 wilcox_test<-wilcox.test(tempframe$familiar_preference~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
p<- ggplot(tempframe, aes(x=tempframe$phase, y=tempframe$familiar_preference)) +
   geom_boxplot(lwd=1)+
   theme_classic()+
   labs(x= "ascending males NOR1 to NOR2" ,y="familiar_preference first minute") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x =  element_text(size = 14)) + stat_n_text(size = 5) +
  ggtitle("by hand p (wilcox paired) = 0.030") + theme(aspect.ratio = 2.5) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, fill = "turquoise4")
plot(p)

p<- ggplot(data=tempframe, aes(x=phase, y=familiar_preference, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=tempframe$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.05, width = 0.01) + 
  scale_color_manual(values=c("turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("nor pre to post familiar preference first minute ascenders only")
  plot(p) 
  
  
cohen<-cohen.d(tempframe$familiar_preference~tempframe$phase)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-tempframe %>% filter(phase == "nor1") %>% nrow()
numberA
numberB<-tempframe %>% filter(phase == "nor2") %>% nrow()
numberB

  

  
  
  
   #do NONASCENDING males switch their preferences before and after perturbation
  tempframe<-fullframe %>% filter(KPdid_fish_ascend_days_15_to_18 == 0)
  
 wilcox_test<-wilcox.test(tempframe$familiar_preference~tempframe$phase)
 p_value_wilcox<-wilcox_test$p.value
p<- ggplot(tempframe, aes(x=tempframe$phase, y=tempframe$familiar_preference)) +
   geom_boxplot(lwd=1)+
   theme_classic()+
   labs(x= "nonascending males NOR1 to NOR2" ,y="familiar_preference first minute") + theme(axis.text.y = element_text(size = 14)) + theme(axis.text.x =  element_text(size = 14)) + stat_n_text(size = 5) +
  ggtitle("by hand p (wilcox) = 0.0785") + theme(aspect.ratio = 1.5) + geom_dotplot(binaxis = "y", stackdir = "center", dotsize = 1, fill = "maroon")
plot(p)

p<- ggplot(data=tempframe, aes(x=phase, y=familiar_preference, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=tempframe$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.05, width = 0.01) + 
  scale_color_manual(values=c("maroon")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("nor pre to post familiar preference first minute nonascenders only")
  plot(p) 
  
  cohen<-cohen.d(tempframe$familiar_preference~tempframe$phase)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberA<-tempframe %>% filter(phase == "nor1") %>% nrow()
numberA
numberB<-tempframe %>% filter(phase == "nor2") %>% nrow()
numberB



```

#pre to post SPA solve speed, rewarded entries, neutral zone first entry, dif asc/non post solve speed
```{r, echo = FALSE, message=FALSE, warning=FALSE}

##############SPA
spavariableslist<-colnames(prespadata)
drops<-c("file_name", "neutral_zone_seconds", "back_wall_seconds", "unrewarded_wall_seconds", "rewarded_corner_seconds","rewarded_platform_seconds", "rewarded_wall_seconds", "unrewarded_corner_seconds", "unrewarded_platform_seconds", "vid_length", "fishID", "sex", "first_choice", "error_correction_speed", "barrier_first_entry_time")
#removing error correctino speed because only a couple individuals have it
spavariableslist<-spavariableslist[(spavariableslist %in% drops)== FALSE]


i<-1
for(i in 1:length(spavariableslist)){
  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)

pretemp<-prespadata %>% select(fishID, spavariableslist[i])
colnames(pretemp)<-c("fishID", "behav")
pretemp$phase<-"aPRE"
pretemp<-full_join(pretemp, statustemp)

posttemp<-postspadata %>% select(fishID, spavariableslist[i])
colnames(posttemp)<-c("fishID", "behav")
posttemp$phase<-"POST"
posttemp<-full_join(posttemp, statustemp)

consistency<-rbind(pretemp, posttemp)
consistency$KPdid_fish_ascend_days_15_to_18<-as.factor(consistency$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(consistency$behav~consistency$phase)
p_value_wilcox<-wilcox_test$p.value
print(spavariableslist[i])
print(p_value_wilcox)

 if(p_value_wilcox < 0.05){
p<- ggplot(data=consistency, aes(x=phase, y=behav, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=consistency$KPdid_fish_ascend_days_15_to_18), size=4, height = 0.001, width = 0) + 
  scale_color_manual(values=c("maroon", "turquoise4")) + 
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle(paste("SPA", spavariableslist[i], sep = " "))
  plot(p) }}







#specifically SPA latency to explore (neutral area) all fish
  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)

pretemp<-prespadata %>% select(fishID, neutral_zone_first_entry_time)
colnames(pretemp)<-c("fishID", "behav")
pretemp$phase<-"aPRE"
pretemp<-full_join(pretemp, statustemp)

posttemp<-postspadata %>% select(fishID, neutral_zone_first_entry_time)
colnames(posttemp)<-c("fishID", "behav")
posttemp$phase<-"POST"
posttemp<-full_join(posttemp, statustemp)

consistency<-rbind(pretemp, posttemp)
consistency<-consistency %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
consistency$KPdid_fish_ascend_days_15_to_18<-as.factor(consistency$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(consistency$behav~consistency$phase)
p_value_wilcox<-wilcox_test$p.value
print("neutral_zone_first_entry_time")
print(p_value_wilcox)

  cohen<-cohen.d(consistency$behav~consistency$phase)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberpre<-consistency %>% filter(phase == "aPRE") %>% nrow()
numberpre
numberpost<-consistency %>% filter(phase == "POST") %>% nrow()
numberpost





#specifically SPA reward corner entries all fish
  
statustemp<-kp %>% select(fishID, KPdid_fish_ascend_days_15_to_18)

pretemp<-prespadata %>% select(fishID, rewarded_corner_entries)
colnames(pretemp)<-c("fishID", "behav")
pretemp$phase<-"aPRE"
pretemp<-full_join(pretemp, statustemp)

posttemp<-postspadata %>% select(fishID, rewarded_corner_entries)
colnames(posttemp)<-c("fishID", "behav")
posttemp$phase<-"POST"
posttemp<-full_join(posttemp, statustemp)

consistency<-rbind(pretemp, posttemp)
consistency<-consistency %>% filter(is.na(KPdid_fish_ascend_days_15_to_18)== FALSE)
consistency$KPdid_fish_ascend_days_15_to_18<-as.factor(consistency$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(consistency$behav~consistency$phase)
p_value_wilcox<-wilcox_test$p.value
print("rewarded_corner_entries")
print(p_value_wilcox)

  cohen<-cohen.d(consistency$behav~consistency$phase)
cohen<-abs(cohen$estimate)
print("cohen")
print(cohen)
numberpre<-consistency %>% filter(phase == "aPRE") %>% nrow()
numberpre
numberpost<-consistency %>% filter(phase == "POST") %>% nrow()
numberpost


```

#soca opp to challenge female space ascenders and nonascenders
```{r, echo = FALSE, message=FALSE, warning=FALSE}

#soca2 female space ascenders only significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 1)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase, paired = TRUE)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 female space by phase ascenders only")
print(p_value_wilcox)

p<- ggplot(data=socatemp, aes(x=phase, y=female_space*100, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  scale_color_manual(values=c("turquoise4")) +
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("SOCA2 female space pre to post, ascenders only")
  plot(p)
  
  
   cohen<-cohen.d(socatemp$female_space~socatemp$phase)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)

  
#soca2 female space nonascenders only not significant
socatempopp<-full_join(socadata, kp, by = "fishID")
socatempopp<-socatempopp %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_opportunity)
colnames(socatempopp)<- c("fishID", "ascend", "female_space")
socatempopp$phase<-"aopportunity"
socatempchall<-full_join(socadata, kp, by = "fishID")
socatempchall<-socatempchall %>% select(fishID, KPdid_fish_ascend_days_15_to_18, SOCA2prop_female_space_challenge)
colnames(socatempchall)<- c("fishID", "ascend", "female_space")
socatempchall$phase<-"challenge"
socatemp<-rbind(socatempopp, socatempchall)
socatemp$phase<-as.factor(socatemp$phase)
socatemp$ascend<-as.factor(socatemp$ascend)
socatemp <- socatemp %>% filter(ascend == 0)
wilcox_test<-wilcox.test(socatemp$female_space~socatemp$phase, paired = TRUE)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2 female space by phase nonascenders only")
print(p_value_wilcox)

p<- ggplot(data=socatemp, aes(x=phase, y=female_space*100, group=fishID)) +
 geom_line(color="gray83", size=1)+
  geom_jitter(aes(colour=socatemp$ascend), size=4, height = 0.001, width = 0) +
  scale_color_manual(values=c("maroon")) +
  annotate("text", x=0, y=0, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)+
  theme_classic()+
  ggtitle("SOCA2 female space pre to post, NONascenders only")
  plot(p)
  
     cohen<-cohen.d(socatemp$female_space~socatemp$phase)
 cohen<-abs(cohen$estimate)
 print("cohen")
print(cohen)
  

#SOCA2 boxplot of change in female space opportunity to challenge, ascending vs nonascending
socatemp<-socadata
socatemp<-socatemp %>% mutate (SOCA2change_in_prop_female_space_opportunity_to_challenge = SOCA2prop_female_space_challenge - SOCA2prop_female_space_opportunity)
socatemp<-full_join(socatemp, kp, by = "fishID")
socatemp<-socatemp %>% select(KPdid_fish_ascend_days_15_to_18, SOCA2change_in_prop_female_space_opportunity_to_challenge)
socatemp$KPdid_fish_ascend_days_15_to_18<-as.factor(socatemp$KPdid_fish_ascend_days_15_to_18)

wilcox_test<-wilcox.test(socatemp$SOCA2change_in_prop_female_space_opportunity_to_challenge~socatemp$KPdid_fish_ascend_days_15_to_18)
p_value_wilcox<-wilcox_test$p.value
print("SOCA2change_in_prop_female_space_opportunity_to_challenge by did fish ascend")
print(p_value_wilcox)
p <- ggplot(socatemp, aes(KPdid_fish_ascend_days_15_to_18, SOCA2change_in_prop_female_space_opportunity_to_challenge)) + geom_boxplot() + 
				geom_dotplot(binaxis = "y", stackdir = "center", 
				dotsize = 0.5) + theme_classic() + labs(x = "did fish ascend", y = "SOCA2change_in_prop_female_space_opportunity_to_challenge") + 
				theme(aspect.ratio = 3)+ 
        annotate("text", x=0, y=0.1, label= glue::glue("p = {round(p_value_wilcox,4)}"), size = 4, color = "maroon", hjust = 0)
plot(p)




```

#pearson correlations distributions pre to post
```{r, echo = FALSE, message=FALSE, warning=FALSE}


```









